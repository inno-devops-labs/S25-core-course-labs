
    name: CI Workflow
    
    on:
      push:
        branches: [ main ]
      pull_request:
        branches: [ main ]
    
    jobs:
      build-and-test:
        runs-on: ubuntu-latest
        steps:
          - name: Checkout code
            uses: actions/checkout@v3
    
          - name: Set up Python
            uses: actions/setup-python@v4
            with:
              python-version: '3.9'
    
          - name: Install dependencies
            run: |
              cd app_python
              python -m pip install --upgrade pip
              pip install -r requirements.txt
              pip install pytest flake8
    
          - name: Lint Code Base
            run: |
              flake8 .
    
          - name: Run Tests
            run: |
              pytest
    
          - name: Log in to Docker Hub
            uses: docker/login-action@v2
            with:
              username: ${{ secrets.DOCKER_USERNAME }}
              password: ${{ secrets.DOCKER_PASSWORD }}
    
          - name: Build Docker Image
            run: |
              docker build -t my-flask-app:${{ github.sha }} .
    
          - name: Push Docker Image
            run: |
              docker push my-flask-app:${{ github.sha }}
    
          - name: Snyk Security Scan
            uses: snyk/actions@master
            env:
              SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
            with:
              args: test --all-projects
    