# ArgoCD

## Deploy and Configure ArgoCD

```bash
PS E:\Documents\Innop\C3\S2\devops\S25-core-course-labs\k8s> kubectl apply -f ArgoCD/argocd-python-app.yaml
application.argoproj.io/moscow-time-py created
PS E:\Documents\Innop\C3\S2\devops\S25-core-course-labs\k8s> argocd app sync moscow-time-py          
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME    STATUS   HEALTH        HOOK  MESSAGE
2025-03-09T17:30:44+03:00          ConfigMap         default         py-app-config    Synced
2025-03-09T17:30:44+03:00             Secret         default              password    Synced
2025-03-09T17:30:44+03:00            Service         default        moscow-time-py    Synced  Healthy
2025-03-09T17:30:44+03:00         ServiceAccount     default        moscow-time-py    Synced
2025-03-09T17:30:44+03:00   apps  Deployment         default        moscow-time-py    Synced  Healthy
2025-03-09T17:30:45+03:00                Pod     default       preinstall-hook
2025-03-09T17:30:47+03:00                Pod     default       preinstall-hook   Running   Synced     PreSync  pod/preinstall-hook created
2025-03-09T17:31:09+03:00             Secret         default              password    Synced                        secret/password unchanged
2025-03-09T17:31:09+03:00          ConfigMap         default         py-app-config    Synced                        configmap/py-app-config unchanged
2025-03-09T17:31:09+03:00            Service         default        moscow-time-py    Synced   Healthy              service/moscow-time-py unchanged
2025-03-09T17:31:09+03:00   apps  Deployment         default        moscow-time-py    Synced   Healthy              deployment.apps/moscow-time-py unchanged   
2025-03-09T17:31:09+03:00                Pod         default       preinstall-hook  Succeeded   Synced     PreSync  pod/preinstall-hook created
2025-03-09T17:31:09+03:00         ServiceAccount     default        moscow-time-py    Synced                        serviceaccount/moscow-time-py unchanged    
2025-03-09T17:31:09+03:00                Pod     default      postinstall-hook   Running   Synced    PostSync  pod/postinstall-hook created
2025-03-09T17:31:35+03:00                Pod     default      postinstall-hook  Succeeded   Synced    PostSync  pod/postinstall-hook created

Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/moscow-time-py
Source:
- Repo:             https://github.com/yeaphm/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/moscow-time-py
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (0591315)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      0591315d41813a4e48d01a2b820887aa16d40777
Phase:              Succeeded
Start:              2025-03-09 17:30:44 +0300 MSK
Finished:           2025-03-09 17:31:34 +0300 MSK
Duration:           50s
Message:            successfully synced (no more tasks)

GROUP  KIND            NAMESPACE  NAME              STATUS     HEALTH   HOOK      MESSAGE
       Pod             default    preinstall-hook   Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  default    moscow-time-py    Synced                        serviceaccount/moscow-time-py unchanged
       Secret          default    password          Synced                        secret/password unchanged
       ConfigMap       default    py-app-config     Synced                        configmap/py-app-config unchanged
       Service         default    moscow-time-py    Synced     Healthy            service/moscow-time-py unchanged
apps   Deployment      default    moscow-time-py    Synced     Healthy            deployment.apps/moscow-time-py unchanged
```

```bash
PS E:\Documents\Innop\C3\S2\devops\S25-core-course-labs\k8s> argocd app get moscow-time-py
Name:               argocd/moscow-time-py
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/moscow-time-py
Source:
- Repo:             https://github.com/yeaphm/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/moscow-time-py
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (0591315)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME              STATUS     HEALTH   HOOK      MESSAGE
       Pod             default    preinstall-hook   Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  default    moscow-time-py    Synced                        serviceaccount/moscow-time-py unchanged
       Secret          default    password          Synced                        secret/password unchanged
       ConfigMap       default    py-app-config     Synced                        configmap/py-app-config unchanged
       Service         default    moscow-time-py    Synced     Healthy            service/moscow-time-py unchanged
apps   Deployment      default    moscow-time-py    Synced     Healthy            deployment.apps/moscow-time-py unchanged
       Pod             default    postinstall-hook  Succeeded           PostSync  pod/postinstall-hook created
```

Pods before values.yaml change:

```bash
PS E:\Documents\Innop\C3\S2\devops\S25-core-course-labs\k8s> kubectl get po                   
NAME                              READY   STATUS    RESTARTS   AGE
moscow-time-py-76b45bfc5f-5wsd8   1/1     Running   0          11m
```

Then number of pods was increased to 2, after updating the repo:

```bash
PS E:\Documents\Innop\C3\S2\devops\S25-core-course-labs\k8s> argocd app get moscow-time-py
Name:               argocd/moscow-time-py
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/moscow-time-py
Source:
- Repo:             https://github.com/yeaphm/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/moscow-time-py
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (83270d6)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME              STATUS     HEALTH   HOOK      MESSAGE
       Pod             default    preinstall-hook   Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  default    moscow-time-py    Synced                        serviceaccount/moscow-time-py unchanged
       Secret          default    password          Synced                        secret/password unchanged
       ConfigMap       default    py-app-config     Synced                        configmap/py-app-config unchanged
       Service         default    moscow-time-py    Synced     Healthy            service/moscow-time-py unchanged
apps   Deployment      default    moscow-time-py    Synced     Healthy            deployment.apps/moscow-time-py configured
       Pod             default    postinstall-hook  Succeeded           PostSync  pod/postinstall-hook created
PS E:\Documents\Innop\C3\S2\devops\S25-core-course-labs\k8s> kubectl get po
NAME                              READY   STATUS    RESTARTS   AGE
moscow-time-py-76b45bfc5f-5wsd8   1/1     Running   0          14m
moscow-time-py-76b45bfc5f-bkgtb   1/1     Running   0          73s
```