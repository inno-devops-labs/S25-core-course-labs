# Lab 13

## Task 1

```bash
[~/innop/spr2025/dev-ops/S25-core-course-labs]$ argocd app sync app-python
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME          STATUS   HEALTH        HOOK  MESSAGE
2025-03-06T13:20:51+03:00          ConfigMap         default            app-config          Synced
2025-03-06T13:20:51+03:00             Secret         default                 token          Synced
2025-03-06T13:20:51+03:00            Service         default  app-python-helm-python-app    Synced  Healthy
2025-03-06T13:20:51+03:00         ServiceAccount     default  app-python-helm-python-app    Synced
2025-03-06T13:20:51+03:00   apps  Deployment         default  app-python-helm-python-app    Synced  Healthy
2025-03-06T13:20:51+03:00  batch         Job     default      pre-install-hook
2025-03-06T13:20:53+03:00  batch         Job     default      pre-install-hook   Running   Synced     PreSync  job.batch/pre-install-hook created
2025-03-06T13:21:18+03:00            Service         default  app-python-helm-python-app    Synced   Healthy              service/app-python-helm-python-app unchanged
2025-03-06T13:21:18+03:00   apps  Deployment         default  app-python-helm-python-app    Synced   Healthy              deployment.apps/app-python-helm-python-app unchanged
2025-03-06T13:21:18+03:00  batch         Job         default      pre-install-hook        Succeeded   Synced     PreSync  Reached expected number of succeeded pods
2025-03-06T13:21:18+03:00         ServiceAccount     default  app-python-helm-python-app    Synced                        serviceaccount/app-python-helm-python-app unchanged
2025-03-06T13:21:18+03:00             Secret         default                 token          Synced                        secret/token unchanged
2025-03-06T13:21:18+03:00          ConfigMap         default            app-config          Synced                        configmap/app-config unchanged
2025-03-06T13:21:19+03:00  batch         Job     default     post-install-hook   Running   Synced    PostSync  job.batch/post-install-hook created
2025-03-06T13:21:44+03:00  batch         Job     default     post-install-hook  Succeeded   Synced    PostSync  Reached expected number of succeeded pods

Name:               argocd/app-python
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/app-python
Source:
- Repo:             https://github.com/deeprecession/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/helm-python-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (826d433)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      826d43357d8bf8471dd7153234d88d4c4a315539
Phase:              Succeeded
Start:              2025-03-06 13:20:50 +0300 MSK
Finished:           2025-03-06 13:21:44 +0300 MSK
Duration:           54s
Message:            successfully synced (no more tasks)

GROUP  KIND            NAMESPACE  NAME                        STATUS     HEALTH   HOOK      MESSAGE
batch  Job             default    pre-install-hook            Succeeded           PreSync   Reached expected number of succeeded pods
       ServiceAccount  default    app-python-helm-python-app  Synced                        serviceaccount/app-python-helm-python-app unchanged
       Secret          default    token                       Synced                        secret/token unchanged
       ConfigMap       default    app-config                  Synced                        configmap/app-config unchanged
       Service         default    app-python-helm-python-app  Synced     Healthy            service/app-python-helm-python-app unchanged
apps   Deployment      default    app-python-helm-python-app  Synced     Healthy            deployment.apps/app-python-helm-python-app unchanged
batch  Job             default    post-install-hook           Succeeded           PostSync  Reached expected number of succeeded pods


[~/innop/spr2025/dev-ops/S25-core-course-labs]$ argocd app get app-python
Name:               argocd/app-python
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/app-python
Source:
- Repo:             https://github.com/deeprecession/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/helm-python-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (826d433)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                        STATUS     HEALTH   HOOK      MESSAGE
batch  Job             default    pre-install-hook            Succeeded           PreSync   Reached expect
ed number of succeeded pods
       ServiceAccount  default    app-python-helm-python-app  Synced                        serviceaccount/app-python-helm-python-app unchanged
       Secret          default    token                       Synced                        secret/token unchanged
       ConfigMap       default    app-config                  Synced                        configmap/app-config unchanged
       Service         default    app-python-helm-python-app  Synced     Healthy            service/app-python-helm-python-app unchanged
apps   Deployment      default    app-python-helm-python-app  Synced     Healthy            deployment.apps/app-python-helm-python-app unchanged
batch  Job             default    post-install-hook           Succeeded           PostSync  Reached expected number of succeeded pods

[~/innop/spr2025/dev-ops/S25-core-course-labs]$ kubectl get po
NAME                                         READY   STATUS    RESTARTS      AGE
app-python-helm-python-app-65594db68-bkmfs   1/1     Running   0             7m18s
helm-python-app-74685b895f-zxwpd             1/1     Running   1 (82m ago)   94m
vault-0                                      1/1     Running   1 (82m ago)   23h
vault-agent-injector-bbd76949d-zvnk8         1/1     Running   1 (82m ago)   23h
```

after increasing the number of replicas to 3

```bash
[~/innop/spr2025/dev-ops/S25-core-course-labs]$ argocd app sync app-python
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME          STATUS   HEALTH        HOOK  MESSAGE
2025-03-06T13:25:48+03:00         ServiceAccount     default  app-python-helm-python-app    Synced
2025-03-06T13:25:48+03:00   apps  Deployment         default  app-python-helm-python-app    Synced  Healthy
2025-03-06T13:25:48+03:00          ConfigMap         default            app-config          Synced
2025-03-06T13:25:48+03:00             Secret         default                 token          Synced
2025-03-06T13:25:48+03:00            Service         default  app-python-helm-python-app    Synced  Healthy
2025-03-06T13:25:49+03:00   apps  Deployment     default  app-python-helm-python-app  OutOfSync  Healthy
2025-03-06T13:25:49+03:00  batch         Job     default      pre-install-hook
2025-03-06T13:25:51+03:00  batch         Job     default      pre-install-hook   Running   Synced     PreSync  job.batch/pre-install-hook created
2025-03-06T13:26:15+03:00   apps  Deployment     default  app-python-helm-python-app    Synced  Progressing
2025-03-06T13:26:17+03:00   apps  Deployment     default  app-python-helm-python-app    Synced  Healthy
2025-03-06T13:26:17+03:00   apps  Deployment         default  app-python-helm-python-app    Synced   Healthy              deployment.apps/app-python-helm-python-app configured
2025-03-06T13:26:17+03:00  batch         Job         default      pre-install-hook        Succeeded   Synced     PreSync  Reached expected number of succeeded pods
2025-03-06T13:26:17+03:00         ServiceAccount     default  app-python-helm-python-app    Synced                        serviceaccount/app-python-helm-python-app unchanged
2025-03-06T13:26:17+03:00             Secret         default                 token          Synced                        secret/token unchanged
2025-03-06T13:26:17+03:00          ConfigMap         default            app-config          Synced                        configmap/app-config unchanged
2025-03-06T13:26:17+03:00            Service         default  app-python-helm-python-app    Synced   Healthy              service/app-python-helm-python-app unchanged
2025-03-06T13:26:17+03:00  batch         Job     default     post-install-hook   Running   Synced    PostSync  job.batch/post-install-hook created
2025-03-06T13:26:44+03:00  batch         Job     default     post-install-hook  Succeeded   Synced    PostSync  Reached expected number of succeeded pods

Name:               argocd/app-python
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/app-python
Source:
- Repo:             https://github.com/deeprecession/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/helm-python-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (4247a77)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      4247a77acdfb50d6ce0dc38eb144978aeb2fd4cc
Phase:              Succeeded
Start:              2025-03-06 13:25:49 +0300 MSK
Finished:           2025-03-06 13:26:44 +0300 MSK
Duration:           55s
Message:            successfully synced (no more tasks)

GROUP  KIND            NAMESPACE  NAME                        STATUS     HEALTH   HOOK      MESSAGE
batch  Job             default    pre-install-hook            Succeeded           PreSync   Reached expected number of succeeded pods
       ServiceAccount  default    app-python-helm-python-app  Synced                        serviceaccount/app-python-helm-python-app unchanged
       Secret          default    token                       Synced                        secret/token unchanged
       ConfigMap       default    app-config                  Synced                        configmap/app-config unchanged
       Service         default    app-python-helm-python-app  Synced     Healthy            service/app-python-helm-python-app unchanged
apps   Deployment      default    app-python-helm-python-app  Synced     Healthy            deployment.apps/app-python-helm-python-app configured
batch  Job             default    post-install-hook           Succeeded           PostSync  Reached expected number of succeeded pods


[~/innop/spr2025/dev-ops/S25-core-course-labs]$ argocd app get app-python
Name:               argocd/app-python
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/app-python
Source:
- Repo:             https://github.com/deeprecession/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/helm-python-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (4247a77)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                        STATUS     HEALTH   HOOK      MESSAGE
batch  Job             default    pre-install-hook            Succeeded           PreSync   Reached expected number of succeeded pods
       ServiceAccount  default    app-python-helm-python-app  Synced                        serviceaccount/app-python-helm-python-app unchanged
       Secret          default    token                       Synced                        secret/token unchanged
       ConfigMap       default    app-config                  Synced                        configmap/app-config unchanged
       Service         default    app-python-helm-python-app  Synced     Healthy            service/app-python-helm-python-app unchanged
apps   Deployment      default    app-python-helm-python-app  Synced     Healthy            deployment.apps/app-python-helm-python-app configured
batch  Job             default    post-install-hook           Succeeded           PostSync  Reached expected number of succeeded pods


[~/innop/spr2025/dev-ops/S25-core-course-labs]$ kubectl get po
NAME                                         READY   STATUS    RESTARTS      AGE
app-python-helm-python-app-65594db68-8r2tz   1/1     Running   0             34s
app-python-helm-python-app-65594db68-bkmfs   1/1     Running   0             10m
app-python-helm-python-app-65594db68-pbhlk   1/1     Running   0             34s
helm-python-app-74685b895f-zxwpd             1/1     Running   1 (85m ago)   97m
vault-0                                      1/1     Running   1 (85m ago)   23h
vault-agent-injector-bbd76949d-zvnk8         1/1     Running   1 (85m ago)   23h
```

## Task 2

### Test 1

before patch

![image](https://github.com/user-attachments/assets/4c4534c5-fc69-4fad-8a55-9d85643ca405)

after patch

![image](https://github.com/user-attachments/assets/6b119a40-d34a-431d-a106-ed50595df8c2)

running sync

```bash
[~/innop/spr2025/dev-ops/S25-core-course-labs/k8s]$ argocd app sync app-python-prod
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME               STATUS    HEALTH        HOOK  MESSAGE
2025-03-06T14:06:46+03:00   apps  Deployment            prod  app-python-prod-helm-python-app  OutOfSync  Healthy
2025-03-06T14:06:46+03:00          ConfigMap         default            app-config             OutOfSync
2025-03-06T14:06:46+03:00             Secret            prod                 token               Synced
2025-03-06T14:06:46+03:00            Service            prod  app-python-prod-helm-python-app    Synced   Healthy
2025-03-06T14:06:46+03:00         ServiceAccount        prod  app-python-prod-helm-python-app    Synced
2025-03-06T14:06:47+03:00  batch         Job        prod      pre-install-hook
2025-03-06T14:06:49+03:00  batch         Job        prod      pre-install-hook   Running   Synced     PreSync  job.batch/pre-install-hook created
2025-03-06T14:07:12+03:00          ConfigMap     default            app-config    Synced
2025-03-06T14:07:12+03:00   apps  Deployment        prod  app-python-prod-helm-python-app    Synced  Progressing
2025-03-06T14:07:14+03:00   apps  Deployment        prod  app-python-prod-helm-python-app    Synced  Healthy
2025-03-06T14:07:14+03:00  batch         Job            prod      pre-install-hook             Succeeded   Synced     PreSync  Reached expected number of succeeded pods
2025-03-06T14:07:14+03:00         ServiceAccount        prod  app-python-prod-helm-python-app    Synced                        serviceaccount/app-python-prod-helm-python-app unchanged
2025-03-06T14:07:14+03:00             Secret            prod                 token               Synced                        secret/token unchanged
2025-03-06T14:07:14+03:00          ConfigMap         default            app-config               Synced                        configmap/app-config configured
2025-03-06T14:07:14+03:00            Service            prod  app-python-prod-helm-python-app    Synced   Healthy              service/app-python-prod-helm-python-app unchanged
2025-03-06T14:07:14+03:00   apps  Deployment            prod  app-python-prod-helm-python-app    Synced   Healthy              deployment.apps/app-python-prod-helm-python-app configured
2025-03-06T14:07:15+03:00  batch         Job        prod     post-install-hook   Running   Synced    PostSync  job.batch/post-install-hook created
2025-03-06T14:07:40+03:00  batch         Job        prod     post-install-hook  Succeeded   Synced    PostSync  Reached expected number of succeeded pods

Name:               argocd/app-python-prod
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          prod
URL:                https://argocd.example.com/applications/app-python-prod
Source:
- Repo:             https://github.com/deeprecession/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/helm-python-app
  Helm Values:      values-prod.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (22e3264)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      22e3264f682d9df51faf691649feac1d9d50bb52
Phase:              Succeeded
Start:              2025-03-06 14:06:46 +0300 MSK
Finished:           2025-03-06 14:07:40 +0300 MSK
Duration:           54s
Message:            successfully synced (no more tasks)

GROUP  KIND            NAMESPACE  NAME                             STATUS     HEALTH   HOOK      MESSAGE
batch  Job             prod       pre-install-hook                 Succeeded           PreSync   Reached expected number of succeeded pods
       ServiceAccount  prod       app-python-prod-helm-python-app  Synced                        serviceaccount/app-python-prod-helm-python-app unchanged
       Secret          prod       token                            Synced                        secret/token unchanged
       ConfigMap       default    app-config                       Synced                        configmap/app-config configured
       Service         prod       app-python-prod-helm-python-app  Synced     Healthy            service/app-python-prod-helm-python-app unchanged
apps   Deployment      prod       app-python-prod-helm-python-app  Synced     Healthy            deployment.apps/app-python-prod-helm-python-app configured
batch  Job             prod       post-install-hook                Succeeded           PostSync  Reached expected number of succeeded pods
```

![image](https://github.com/user-attachments/assets/a6d2eaf3-1360-4c59-ad19-ec89fc775450)


### Test 2

deleting a pod

```bash
[~/innop/spr2025/dev-ops/S25-core-course-labs/k8s]$ kubectl delete pod -n prod app-python-prod-helm-python-app-996c86d5b-2d96m
pod "app-python-prod-helm-python-app-996c86d5b-2d96m" deleted

[~/innop/spr2025/dev-ops/S25-core-course-labs/k8s]$ kubectl get pods -n prod -w
NAME                                              READY   STATUS    RESTARTS   AGE
app-python-prod-helm-python-app-996c86d5b-cvs7q   1/1     Running   0          14s
app-python-prod-helm-python-app-996c86d5b-hlrgk   1/1     Running   0          11m
app-python-prod-helm-python-app-996c86d5b-lj84b   1/1     Running   0          11m
^C%

[~/innop/spr2025/dev-ops/S25-core-course-labs/k8s]$ argocd app diff app-python-prod
```

![image](https://github.com/user-attachments/assets/d317bcff-8a5c-4659-9887-00cb3a26f21d)

### explanation

ArgoCD regularly checks your app and compares it to what’s in the repo. If something changes, the app might not work as expected until ArgoCD syncs it back to the correct state. k8s by itself doesn’t do this kind of automatic syncing

but, if you manually delete a resource, k8s will recreate it on its own. k8s has a built-in way to keep things running. So, if you delete a pod in plain k8s, a new one will automatically appear.
