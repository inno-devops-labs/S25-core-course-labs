# ArgoCD

## Task 1

For this task I will show you the state of the app before and after I changed the `replicasCount` from 1 to 2

---

Before:

![task1-before-push](/k8s/media/task1_before_push.png)

---

After:

![task1-after-push](/k8s/media/task1_after_push.png)

## Task 2

Since on `values-prod.yaml` I have already set the number of replicas to be 3, here I used the following command to check if anything will change:

```bash
kubectl patch deployment python-app-prod-app-python -n prod --patch '{"spec":{"replicas": 5}}'
```

As you may see on the screenshot, nothing has really changed, since `ArgoCD` has reverted the local state to the repo's state.

![prod](/k8s/media/prod1.png)

You may also verify that here:

```bash
$ kubectl get pods -n prod
NAME                                          READY   STATUS    RESTARTS   AGE
python-app-prod-app-python-68d44d6f88-2schs   1/1     Running   0          17m
python-app-prod-app-python-68d44d6f88-gszzw   1/1     Running   0          17m
python-app-prod-app-python-68d44d6f88-l8dsb   1/1     Running   0          17m
```

Then I proceeded with deleting one of the pods:

```bash
$ kubectl delete pod -n prod python-app-prod-app-python-68d44d6f88-gszzw
pod "python-app-prod-app-python-68d44d6f88-gszzw" deleted
```

You may see how a pod was deleted and a new one has replaced it:

```bash
$ kubectl get pods -n prod -w
NAME                                          READY   STATUS    RESTARTS   AGE
python-app-prod-app-python-68d44d6f88-gszzw   1/1     Running   0          25m
python-app-prod-app-python-68d44d6f88-l8dsb   1/1     Running   0          25m
python-app-prod-app-python-68d44d6f88-xvzql   1/1     Running   0          4m44s
python-app-prod-app-python-68d44d6f88-gszzw   1/1     Terminating   0          25m
python-app-prod-app-python-68d44d6f88-p4bch   0/1     Pending       0          0s
python-app-prod-app-python-68d44d6f88-p4bch   0/1     Pending       0          1s
python-app-prod-app-python-68d44d6f88-p4bch   0/1     ContainerCreating   0          1s
python-app-prod-app-python-68d44d6f88-p4bch   1/1     Running             0          32s
```

And, this commands output is empty as it was expected:

```bash
$ argocd app diff python-app-prod
//empty output
```

As requested, here is the output of `get pods` after the deletion:

```bash
$  kubectl get pods -n prod
NAME                                          READY   STATUS    RESTARTS   AGE
python-app-prod-app-python-68d44d6f88-l8dsb   1/1     Running   0          27m
python-app-prod-app-python-68d44d6f88-p4bch   1/1     Running   0          2m1s
python-app-prod-app-python-68d44d6f88-xvzql   1/1     Running   0          7m16s
```

And here is the screenshot, on which you may also see that one of the pods is way younger than others:

![prod2](/k8s/media/prod2.png)

---

If I understood correctly `ArgoCD` is constantly comparing the live state with the repo. I assume that sync policy is automated

### When a drift Occurs

1. It marks the app as `OutOfSync`
2. Reverts manual changes
3. Prunes resources (e. g. If a resource has been deleted manually but is defined in Git, ArgoCD will restore it.)
4. Attempts to restore the state of the failing resources

### Runtime events

Here it simply monitors the state, and if some pod is, for example, in a crash loop, all the repair process will be done by kubernetes handlers

## Bonus task

It was not difficult to configure cd for the bonus task as well:

![go](/k8s/media/go.png)

And here is the output of `get pods`:

```bash
$  kubectl get pods -n default
NAME                                     READY   STATUS     RESTARTS      AGE
go-app-app-go-6fbdf9b65d-ks4lz           1/1     Running    0             11m
```
