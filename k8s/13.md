# ArgoCD for GitOps Deployment

## Deploy and Configure ArgoCD

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl apply -f ArgoCD/argocd-python-app.yaml
application.argoproj.io/python-web-app created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app sync python-app
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME    STATUS   HEALTH        HOOK  MESSAGE
2025-03-16T18:04:06+03:00          ConfigMap         default         py-app-config    Synced
2025-03-16T18:04:06+03:00             Secret         default              password    Synced
2025-03-16T18:04:06+03:00            Service         default        python-web-app    Synced  Healthy
2025-03-16T18:04:06+03:00         ServiceAccount     default        python-web-app    Synced
2025-03-16T18:04:06+03:00   apps  Deployment         default        python-web-app    Synced  Healthy
2025-03-16T18:04:07+03:00                Pod     default       preinstall-hook
2025-03-16T18:04:09+03:00                Pod     default       preinstall-hook   Running   Synced     PreSync  pod/preinstall-hook created
2025-03-16T18:04:31+03:00             Secret         default              password    Synced                        secret/password unchanged
2025-03-16T18:04:31+03:00          ConfigMap         default         py-app-config    Synced                        configmap/py-app-config unchanged
2025-03-16T18:04:31+03:00            Service         default        python-web-app    Synced   Healthy              service/python-web-app unchanged
2025-03-16T18:04:31+03:00   apps  Deployment         default        python-web-app    Synced   Healthy              deployment.apps/python-web-app unchanged   
2025-03-16T18:04:31+03:00                Pod         default       preinstall-hook  Succeeded   Synced     PreSync  pod/preinstall-hook created
2025-03-16T18:04:31+03:00         ServiceAccount     default        python-web-app    Synced                        serviceaccount/python-web-app unchanged    
2025-03-16T18:04:31+03:00                Pod     default      postinstall-hook   Running   Synced    PostSync  pod/postinstall-hook created
2025-03-16T18:04:57+03:00                Pod     default      postinstall-hook  Succeeded   Synced    PostSync  pod/postinstall-hook created

Name:               argocd/python-web-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-web-app
Source:
- Repo:             https://github.com/NetPo4ki/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/python-web-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to Lab-13 (e38c63e)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      e38c63e2dcaa8923fdce10c76e8b7818cba0fbe0
Phase:              Succeeded
Start:              2025-03-16 18:04:06 +0300 MSK
Finished:           2025-03-16 18:04:57 +0300 MSK
Duration:           51s
Message:            successfully synced (no more tasks)

GROUP  KIND            NAMESPACE  NAME              STATUS     HEALTH   HOOK      MESSAGE
       Pod             default    preinstall-hook   Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  default    python-web-app    Synced                        serviceaccount/python-web-app unchanged
       Secret          default    password          Synced                        secret/password unchanged
       ConfigMap       default    py-app-config     Synced                        configmap/py-app-config unchanged
       Service         default    python-web-app    Synced     Healthy            service/python-web-app unchanged
apps   Deployment      default    python-web-app    Synced     Healthy            deployment.apps/python-web-app unchanged
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app get python-web-app
Name:               argocd/python-web-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-web-app
Source:
- Repo:             https://github.com/NetPo4ki/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/python-web-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to Lab-13 (e38c63e)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME              STATUS     HEALTH   HOOK      MESSAGE
       Pod             default    preinstall-hook   Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  default    python-web-app    Synced                        serviceaccount/python-web-app unchanged
       Secret          default    password          Synced                        secret/password unchanged
       ConfigMap       default    py-app-config     Synced                        configmap/py-app-config unchanged
       Service         default    python-web-app    Synced     Healthy            service/python-web-app unchanged
apps   Deployment      default    python-web-app    Synced     Healthy            deployment.apps/python-web-app unchanged
       Pod             default    postinstall-hook  Succeeded           PostSync  pod/postinstall-hook created
```

Before changes in `values.yaml`:

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po
NAME                              READY   STATUS    RESTARTS   AGE
python-web-app-49d65jdu5e-4ghf8   1/1     Running   0          16s
```

Now `replicaCount: 2`:

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app get python-web-app
Name:               argocd/python-web-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-web-app
Source:
- Repo:             https://github.com/NetPo4ki/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/python-web-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to Lab-13 (7fd238a)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME              STATUS     HEALTH   HOOK      MESSAGE
       Pod             default    preinstall-hook   Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  default    python-web-app    Synced                        serviceaccount/python-web-app unchanged
       Secret          default    password          Synced                        secret/password unchanged
       ConfigMap       default    py-app-config     Synced                        configmap/py-app-config unchanged
       Service         default    python-web-app    Synced     Healthy            service/python-web-app unchanged
apps   Deployment      default    python-web-app    Synced     Healthy            deployment.apps/python-web-app configured
       Pod             default    postinstall-hook  Succeeded           PostSync  pod/postinstall-hook created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po
NAME                              READY   STATUS    RESTARTS   AGE
python-web-app-49d65jdu5e-4ghf8   1/1     Running   0          26m
python-web-app-84g85jdi7d-6sfo9   1/1     Running   0          31s
```

## Multi-Environment Deployment & Auto-Sync

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl apply -f ArgoCD/argocd-python-prod.yaml
application.argoproj.io/python-web-app-prod created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app sync pytho-web-app-prod
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME    STATUS   HEALTH        HOOK  MESSAGE
2025-03-16T19:02:04+03:00         ServiceAccount        prod   python-web-app-prod    Synced
2025-03-16T19:02:04+03:00   apps  Deployment            prod   python-web-app-prod    Synced  Healthy
2025-03-16T19:02:04+03:00            Service            prod   python-web-app-prod    Synced  Healthy
2025-03-16T19:02:04+03:00                Pod        prod       preinstall-hook
2025-03-16T19:02:06+03:00                Pod        prod       preinstall-hook   Running   Synced     PreSync  pod/preinstall-hook created
2025-03-16T19:02:28+03:00                Pod            prod       preinstall-hook  Succeeded   Synced     PreSync  pod/preinstall-hook created
2025-03-16T19:02:28+03:00         ServiceAccount        prod   python-web-app-prod    Synced                        serviceaccount/python-web-app-prod unchanged
2025-03-16T19:02:28+03:00            Service            prod   python-web-app-prod    Synced   Healthy              service/python-web-app-prod unchanged      
2025-03-16T19:02:28+03:00   apps  Deployment            prod   python-web-app-prod    Synced   Healthy              deployment.apps/python-web-app-prod unchanged
2025-03-16T19:02:29+03:00                Pod        prod      postinstall-hook   Running   Synced    PostSync  pod/postinstall-hook created
2025-03-16T19:02:54+03:00                Pod        prod      postinstall-hook  Succeeded   Synced    PostSync  pod/postinstall-hook created

Name:               argocd/python-web-app-prod
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          prod
Source:
- Repo:             https://github.com/NetPo4ki/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/python-web-app
  Helm Values:      values-prod.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to Lab-13 (d3a0196)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      d3a0196d0f5f12cef388f01593385082a3d99778
Phase:              Succeeded
Start:              2025-03-16 19:02:04 +0300 MSK
Finished:           2025-03-16 19:02:54 +0300 MSK
Duration:           50s
Message:            successfully synced (no more tasks)

GROUP  KIND            NAMESPACE  NAME                 STATUS     HEALTH   HOOK      MESSAGE
       Pod             prod       preinstall-hook      Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  prod       python-web-app-prod  Synced                        serviceaccount/python-web-app-prod unchanged
       Service         prod       python-web-app-prod  Synced     Healthy            service/python-web-app-prod unchanged
apps   Deployment      prod       python-web-app-prod  Synced     Healthy            deployment.apps/python-web-app-prod unchanged
       Pod             prod       postinstall-hook     Succeeded           PostSync  pod/postinstall-hook created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app get python-web-app-prod
Name:               argocd/python-web-app-prod
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          prod
URL:                https://argocd.example.com/applications/python-web-app-prod
Source:
- Repo:             https://github.com/yeaphm/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/python-web-app
  Helm Values:      values-prod.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to Lab-13 (d3a0196)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                 STATUS     HEALTH   HOOK      MESSAGE
       Pod             prod       preinstall-hook      Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  prod       python-web-app-prod  Synced                        serviceaccount/python-web-app-prod unchanged
       Service         prod       python-web-app-prod  Synced     Healthy            service/python-web-app-prod unchanged
apps   Deployment      prod       python-web-app-prod  Synced     Healthy            deployment.apps/python-web-app-prod unchanged
       Pod             prod       postinstall-hook     Succeeded           PostSync  pod/postinstall-hook created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po -n prod
NAME                                   READY   STATUS    RESTARTS   AGE
python-web-app-prod-67od565d7h-8fyhi   1/1     Running   0          32s
python-web-app-prod-67od565d7h-fdo2k   1/1     Running   0          32s
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app get python-web-app-prod
Name:               argocd/python-web-app-prod
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          prod
URL:                https://argocd.example.com/applications/python-web-app-prod
Source:
- Repo:             https://github.com/yeaphm/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/python-web-app
  Helm Values:      values-prod.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to Lab-13 (73ed397)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                 STATUS     HEALTH   HOOK      MESSAGE
       Pod             prod       preinstall-hook      Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  prod       python-web-app-prod  Synced                        serviceaccount/python-web-app-prod unchanged
       Service         prod       python-web-app-prod  Synced     Healthy            service/python-web-app-prod unchanged
apps   Deployment      prod       python-web-app-prod  Synced     Healthy            deployment.apps/python-web-app-prod configured
       Pod             prod       postinstall-hook     Succeeded           PostSync  pod/postinstall-hook created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po -n prod
NAME                                   READY   STATUS    RESTARTS   AGE
python-web-app-prod-67od565d7h-fdo2k   1/1     Running   0          6m52s
```

### Self-Heal Testing

#### Test 1

```txt
(venv) ➜  k8s git:(Lab-13) ✗ @"
{
  "spec": {
    "replicas": 3
  }
}
"@ | Out-File -FilePath patch.json -Encoding utf8
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl patch deployment python-web-app-prod -n prod --patch-file patch.json
deployment.apps/python-web-app-prod patched
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po -n prod
NAME                                   READY   STATUS    RESTARTS   AGE
python-web-app-prod-67od565d7h-53j8d   1/1     Running   0          2m
python-web-app-prod-67od565d7h-fdo2k   1/1     Running   0          15m
python-web-app-prod-67od565d7h-gd9h4   1/1     Running   0          2m
```

Return to 1 pod:

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app get python-web-app-prod
Name:               argocd/python-web-app-prod
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          prod
URL:                https://argocd.example.com/applications/python-web-app-prod
Source:
- Repo:             https://github.com/yeaphm/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/python-web-app
  Helm Values:      values-prod.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to Lab-13 (73ed397)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                 STATUS     HEALTH   HOOK      MESSAGE
       Pod             prod       preinstall-hook      Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  prod       python-web-app-prod  Synced                        serviceaccount/python-web-app-prod unchanged
       Service         prod       python-web-app-prod  Synced     Healthy            service/python-web-app-prod unchanged
apps   Deployment      prod       python-web-app-prod  Synced     Healthy            deployment.apps/python-web-app-prod configured
       Pod             prod       postinstall-hook     Succeeded           PostSync  pod/postinstall-hook created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po -n prod
NAME                                   READY   STATUS    RESTARTS   AGE
python-web-app-prod-67od565d7h-fdo2k   1/1     Running   0          21m
```

#### Test 2

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po -n prod
NAME                                   READY   STATUS    RESTARTS   AGE
python-web-app-prod-67od565d7h-fdo2k   1/1     Running   0          22m
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl delete pods -n prod python-web-app-prod-67od565d7h-fdo2k
pod "python-web-app-prod-67od565d7h-fdo2k" deleted
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po -n prod
NAME                                   READY   STATUS    RESTARTS   AGE
python-web-app-prod-67od565d7h-6hf8d   0/1     Running   0          16s
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app diff python-web-app-prod
(venv) ➜  k8s git:(Lab-13) ✗ 
```

Unfortunately, I was unable to capture screenshots of the ArgoCD UI due to browser security restrictions.

## Sync Your Bonus App with ArgoCD

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl apply -f ArgoCD/argocd-cs-app.yaml
application.argoproj.io/go-web-app created
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ kubectl get po -n default
NAME                              READY   STATUS    RESTARTS   AGE
go-web-app-84h648635-hg8g7        1/1     Running   0          36s
python-web-app-h6g854gh8-65g06    1/1     Running   0          45m
python-web-app-h6g854gh8-546h0    1/1     Running   0          44m
```

```txt
(venv) ➜  k8s git:(Lab-13) ✗ argocd app get go-web-app
Name:               argocd/go-web-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/go-web-app
Source:
- Repo:             https://github.com/NetPo4ki/S25-core-course-labs.git
  Target:           Lab-13
  Path:             k8s/go-web-app
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated (Prune)
Sync Status:        Synced to Lab-13 (73ed397)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME              STATUS     HEALTH   HOOK      MESSAGE
       Pod             default    preinstall-hook   Succeeded           PreSync   pod/preinstall-hook created
       ServiceAccount  default    go-web-app        Synced                        serviceaccount/go-web-app created
       Service         default    go-web-app        Synced     Healthy            service/go-web-app created
apps   Deployment      default    go-web-app        Synced     Healthy            deployment.apps/go-web-app created
       Pod             default    postinstall-hook  Succeeded           PostSync  pod/postinstall-hook created
```