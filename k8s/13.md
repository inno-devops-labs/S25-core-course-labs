
# ArgoCD

## Set up

Get service name

```bash
kubectl get svc -n argocd
NAME                                    TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
argo-argocd-applicationset-controller   ClusterIP   10.108.203.238   <none>        7000/TCP            22m
argo-argocd-dex-server                  ClusterIP   10.105.162.36    <none>        5556/TCP,5557/TCP   22m
argo-argocd-redis                       ClusterIP   10.98.102.101    <none>        6379/TCP            22m
argo-argocd-repo-server                 ClusterIP   10.107.79.248    <none>        8081/TCP            22m
argo-argocd-server                      ClusterIP   10.97.212.74     <none>        80/TCP,443/TCP      22m
```

provide it here

```bash
$ kubectl port-forward svc/argo-argocd-server -n argocd 8089:443
Forwarding from 127.0.0.1:8089 -> 8080
Forwarding from [::1]:8089 -> 8080

$ kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 --decode
toAJxIGpHORL41MO

~$ argocd login localhost:8089 --insecure
Username: admin
Password: toAJxIGpHORL41MO

'admin:login' logged in successfully
Context 'localhost:8089' updated


$ kubectl apply -f ArgoCD/argocd-python-app.yaml
application.argoproj.io/python-app created


$ argocd app sync python-app
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME           STATUS   HEALTH            HOOK  MESSAGE
2025-03-13T00:30:10+03:00          ConfigMap         default     app-python-config           Synced
2025-03-13T00:30:10+03:00            Service         default  python-app-chart-app-python    Synced  Healthy
2025-03-13T00:30:10+03:00         ServiceAccount     default            app-python           Synced
2025-03-13T00:30:10+03:00   apps  Deployment         default  python-app-chart-app-python    Synced  Progressing
2025-03-13T00:30:11+03:00         ServiceAccount     default            app-python           Synced                           serviceaccount/app-python unchanged
2025-03-13T00:30:11+03:00          ConfigMap         default     app-python-config           Synced                           configmap/app-python-config unchanged
2025-03-13T00:30:11+03:00            Service         default  python-app-chart-app-python    Synced  Healthy                  service/python-app-chart-app-python unchanged
2025-03-13T00:30:11+03:00   apps  Deployment         default  python-app-chart-app-python    Synced  Progressing              deployment.apps/python-app-chart-app-python unchanged

Name:               argocd/python-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app
Source:
- Repo:             https://github.com/Processor228/S25-core-course-labs.git
  Target:           lab-13
  Path:             k8s/chart-app-python
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab-13 (c9844a7)
Health Status:      Progressing

Operation:          Sync
Sync Revision:      c9844a7be9552d8a3cb2cccbc99db61c2ed33e0a
Phase:              Succeeded
Start:              2025-03-13 00:30:10 +0300 MSK
Finished:           2025-03-13 00:30:10 +0300 MSK
Duration:           0s
Message:            successfully synced (all tasks run)

GROUP  KIND            NAMESPACE  NAME                         STATUS  HEALTH       HOOK  MESSAGE
       ServiceAccount  default    app-python                   Synced                     serviceaccount/app-python unchanged
       ConfigMap       default    app-python-config            Synced                     configmap/app-python-config unchanged
       Service         default    python-app-chart-app-python  Synced  Healthy            service/python-app-chart-app-python unchanged
apps   Deployment      default    python-app-chart-app-python  Synced  Progressing        deployment.apps/python-app-chart-app-python unchanged
```

when updating the replica count, i get to see this:

![replica count upd](../images/resync-argocd-update-replica-count.png)

## Part 2

```bash
$ kubectl create namespace dev
namespace/dev created

$ kubectl create namespace prod
namespace/prod created
```

lets patch replica count

observe that patch applied and we have just one pod in the replica
![before sync](../images/patch-before-sync.png)

and make sync:

![after sync ](../images/sync-after-patch.png)

lets delete pods

```bash
$ kubectl delete pod -n prod -l app.kubernetes.io/instance=python-app-prod,app.kubernetes.io/managed-by=Helm,app.kubernetes.io/version=1.16.0,pod-template-hash=6cc87565d4
pod "python-app-prod-chart-app-python-6cc87565d4-89fxf" deleted
pod "python-app-prod-chart-app-python-6cc87565d4-sznfj" deleted

$ kubectl get pods -n prod --show-labels
NAME                                                READY   STATUS    RESTARTS   AGE   LABELS
python-app-prod-chart-app-python-6cc87565d4-qj2g4   0/1     Pending   0          6s    app.kubernetes.io/instance=python-app-prod,app.kubernetes.io/managed-by=Helm,app.kubernetes.io/version=1.16.0,pod-template-hash=6cc87565d4
python-app-prod-chart-app-python-6cc87565d4-sbrwl   0/1     Running   0          6s    app.kubernetes.io/instance=python-app-prod,app.kubernetes.io/managed-by=Helm,app.kubernetes.io/version=1.16.0,pod-template-hash=6cc87565d4
```

confirm automatic recovery with UI:

![automatic recovery](../images/set-up-deleted-nodes.png)

## Bonus


