# ArgoCD for GitOps Deployment

## Task 1: Deploy and Configure ArgoCD

### 1. Install ArgoCD via Helm

I have added ArgoCD Helm repository, installed ArgoCD and verified installation. It was successful.

![Step 1, point 1: successfully added ArgoCD Helm repository](./img/lab13/lab13_task1_1.png)
![Step 1, point 2: successfully installed ArgoCD](./img/lab13/lab13_task1_2.png)
![Step 1, point 3: successfully verified installation](./img/lab13/lab13_task1_3.png)

### 2. Install ArgoCD CLI

I have installed the ArgoCD CLI tool and verified its installation.

![Step 2, point 1 and 2: successfully installed ArgoCD CLI tool and verified its installation](./img/lab13/lab13_task1_4.png)

### 3. Access the ArgoCD UI

I have forwarded the ArgoCD server port and successfully logged in using initial admin password.

![Step 3, point 1: successfully forwarded the ArgoCD server port](./img/lab13/lab13_task1_5.png)
![Step 3, point 2: successfully logged in using initial admin password](./img/lab13/lab13_task1_6.png)

### 4. Configure Python App Sync

I have created an ArgoCD folder and defined the ArgoCD application.

![Step 4, point 1 and 2: successfully defined the ArgoCD application](./img/lab13/lab13_task1_7.png)

After that, I applied the configuration and verified sync:

![Step 4, point 3 and 4.1: successfully applied configuration and verified sync](./img/lab13/lab13_task1_8.png)
![Step 4, point 4.2: successfully got status](./img/lab13/lab13_task1_9.png)

### 5. Test Sync Workflow

I modified the `values.yaml` (changed the `replicaCount` from 1 to 3).
Then, I committed and pushed these changes to the target branch from the config (in my case, it is `feature/lab13`).
The commit hash is [f5cf33d](https://github.com/danmaninc/S25-core-course-labs/commit/f5cf33d94abd3fe2a03355ed5f20e3a8d08de46c).

![Step 5, point 1 and 2: successfully modified the values.yaml and pushed change to the repository](./img/lab13/lab13_task1_10.png)

Then I observed that ArgoCD auto-synced the update. You can notice, that `deployment.apps/python-app-app-python configured`, which means that ArgoCD auto-synced the update successfully.

![Step 5, point 3: successfully auto-synced the update](./img/lab13/lab13_task1_11.png)

Also, we can notice that the number of pods indeed was increased.

![Step 5, point 3: number of pods increased](./img/lab13/lab13_task1_12.png)

Therefore, the Task 1 was completed successfully.

## Task 2: Multi-Environment Deployment & Auto-Sync

### Set Up Multi-Environment Configurations

I have extended my Python app's Helm chart to support `dev` and `prod` environments by creating environment-specific values files (`values-dev.yaml`, `values-prod.yaml`).

![Step 1, point 1 and 2: successfully created environment-specifc values files](./img/lab13/lab13_task2_1.png)

### Create Namespaces

I have created `dev` and `prod` namespaces via `kubectl`.

![Step 2: successfully created namespaces via kubectl](./img/lab13/lab13_task2_2.png)

### Deploy Multi-Environment via ArgoCD

I have defined two ArgoCD applications with auto-sync: `argocd-python-dev.yaml` and `argocd-python-prod.yaml`.

![Step 3: successfully defined two ArgoCD applications with auto-sync](./img/lab13/lab13_task2_3.png)

### Enable Auto-Sync

Let's test auto-sync. Firstly, I will apply the `prod` configuration and verify auto-sync.
As we can see from the following screenshot, it works correctly.

![Step 4: successfully enabled auto-sync](./img/lab13/lab13_task2_4.png)

### Self-Heal Testing

#### Test 1: Manual Override of Replica Count

Let's modify the deployment's replica count manually:

![Step 1: Successfully changed the number of replicas](./img/lab13/lab13_task2_5.png)

Then, let's check if it is auto-synced:

![Step 2: Status changed to syncing](./img/lab13/lab13_task2_6.png)

![Step 2: Status changed to OK](./img/lab13/lab13_task2_7.png)

#### Test 2: Delete a Pod (Replica)

I have checked the number of pods before deletion.
After that, I deleted one pod, and retrieved the list of pods again with the watch mode. As you can see, the pod auto-created and became ready after 9 seconds.

Also, I runned `argocd app diff` to confirm that ArgoCD shows no drift.

![Proof that pod successfully auto-recreated after the deletion](./img/lab13/lab13_task2_8.png)

![Screenshot of ArgoCD UI showing sync status and the dashboard after test](./img/lab13/lab13_task2_9.png)

#### Explanation

ArgoCD handles the configuration drift by constantly comparing the defined application state from the Git repository with the actual state on the host machine. The configuration drift is eliminated after the sync process.

The pod was recreated automatically by Kubernetes, so that is why ArgoCD shows no drift (state was not affected, only the pod itself by deletion).
