# Lab 13

## Task 1

I decided to delete secrets and hooks from `k8s/app-python/templates/` because they were causing problems with ArgoCD.

### First sync

```bash
$ argocd app sync python-app
TIMESTAMP                  GROUP        KIND       NAMESPACE                  NAME     STATUS   HEALTH        HOOK  MESSAGE
2025-03-16T02:11:33+03:00          ConfigMap         default     app-python-config     Synced
2025-03-16T02:11:33+03:00            Service         default  python-app-app-python    Synced  Healthy
2025-03-16T02:11:33+03:00         ServiceAccount     default          app-python       Synced
2025-03-16T02:11:33+03:00   apps  Deployment         default  python-app-app-python    Synced  Healthy
2025-03-16T02:11:35+03:00          ConfigMap         default     app-python-config     Synced                       configmap/app-python-config unchanged
2025-03-16T02:11:35+03:00            Service         default  python-app-app-python    Synced  Healthy              service/python-app-app-python unchanged
2025-03-16T02:11:35+03:00   apps  Deployment         default  python-app-app-python    Synced  Healthy              deployment.apps/python-app-app-python unchanged
2025-03-16T02:11:35+03:00         ServiceAccount     default          app-python       Synced                       serviceaccount/app-python unchanged

Name:               argocd/python-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app
Source:
- Repo:             https://github.com/mihdenis85/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/app-python
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (4142cf2)
Health Status:      Healthy

Operation:          Sync
Sync Revision:      fc1b38e7d4a2f9d2c6e597b4f1c8d3a0e2a1b6e5
Phase:              Succeeded
Start:              2025-03-16 02:11:32 +0300 MSK
Finished:           2025-03-16 02:11:35 +0300 MSK
Duration:           3s
Message:            successfully synced (all tasks run)

GROUP  KIND            NAMESPACE  NAME                   STATUS  HEALTH   HOOK  MESSAGE
       ServiceAccount  default    app-python             Synced                 serviceaccount/app-python unchanged
       ConfigMap       default    app-python-config      Synced                 configmap/app-python-config unchanged
       Service         default    python-app-app-python  Synced  Healthy        service/python-app-app-python unchanged
apps   Deployment      default    python-app-app-python  Synced  Healthy        deployment.apps/python-app-app-python unchanged
```

```bash
$ argocd app get python-app
Name:               argocd/python-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app
Source:
- Repo:             https://github.com/mihdenis85/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/app-python
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (4142cf2)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                   STATUS  HEALTH   HOOK  MESSAGE
       ServiceAccount  default    app-python             Synced                 serviceaccount/app-python unchanged
       ConfigMap       default    app-python-config      Synced                 configmap/app-python-config unchanged
       Service         default    python-app-app-python  Synced  Healthy        service/python-app-app-python unchanged
apps   Deployment      default    python-app-app-python  Synced  Healthy        deployment.apps/python-app-app-python unchanged
```

### After update in Git

Commit hash now is different:

```bash
$ argocd app get python-app
Name:               argocd/python-app
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app
Source:
- Repo:             https://github.com/mihdenis85/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/app-python
  Helm Values:      values.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (dd7cc71)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                   STATUS  HEALTH   HOOK  MESSAGE
       ServiceAccount  default    app-python             Synced                 serviceaccount/app-python unchanged
       ConfigMap       default    app-python-config      Synced                 configmap/app-python-config unchanged
       Service         default    python-app-app-python  Synced  Healthy        service/python-app-app-python unchanged
apps   Deployment      default    python-app-app-python  Synced  Healthy        deployment.apps/python-app-app-python configured
```

## Task 2

### Dev and Prod

```bash
$ argocd app get python-app-dev
Name:               argocd/python-app-dev
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app-dev
Source:
- Repo:             https://github.com/mihdenis85/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/app-python
  Helm Values:      values-dev.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        OutOfSync from lab13 (0f6218f)
Health Status:      Healthy

CONDITION              MESSAGE                                                                                   LAST TRANSITION
SharedResourceWarning  ConfigMap/app-python-config is part of applications argocd/python-app-dev and python-app  2025-03-16 02:20:22 +0300 MSK
SharedResourceWarning  ServiceAccount/app-python is part of applications argocd/python-app-dev and python-app    2025-03-16 02:20:21 +0300 MSK


GROUP  KIND            NAMESPACE  NAME                       STATUS     HEALTH   HOOK  MESSAGE
       ServiceAccount  default    app-python                 OutOfSync                 serviceaccount/app-python configured
       ConfigMap       default    app-python-config          OutOfSync                 configmap/app-python-config configured
       Service         default    python-app-dev-app-python  Synced     Healthy        service/python-app-dev-app-python created
apps   Deployment      default    python-app-dev-app-python  Synced     Healthy        deployment.apps/python-app-dev-app-python created
```

```bash
$ argocd app get python-app-prod
Name:               argocd/python-app-prod
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app-prod
Source:
- Repo:             https://github.com/mihdenis85/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/app-python
  Helm Values:      values-prod.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (0f6218f)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                        STATUS  HEALTH   HOOK  MESSAGE
       ServiceAccount  default    app-python                  Synced                 serviceaccount/app-python configured
       ConfigMap       default    app-python-config           Synced                 configmap/app-python-config configured
       Service         default    python-app-prod-app-python  Synced  Healthy        service/python-app-prod-app-python created
apps   Deployment      default    python-app-prod-app-python  Synced  Healthy        deployment.apps/python-app-prod-app-python created
```

### Prod after values-prod.yaml update

```bash
$ argocd app get python-app-prod
Name:               argocd/python-app-prod
Project:            default
Server:             https://kubernetes.default.svc
Namespace:          default
URL:                https://argocd.example.com/applications/python-app-prod
Source:
- Repo:             https://github.com/mihdenis85/S25-core-course-labs.git
  Target:           lab13
  Path:             k8s/app-python
  Helm Values:      values-prod.yaml
SyncWindow:         Sync Allowed
Sync Policy:        Automated
Sync Status:        Synced to lab13 (53782e6)
Health Status:      Healthy

GROUP  KIND            NAMESPACE  NAME                        STATUS  HEALTH   HOOK  MESSAGE
       ServiceAccount  default    app-python                  Synced                 serviceaccount/app-python configured
       ConfigMap       default    app-python-config           Synced                 configmap/app-python-config configured
       Service         default    python-app-prod-app-python  Synced  Healthy        service/python-app-prod-app-python unchanged
apps   Deployment      default    python-app-prod-app-python  Synced  Healthy        deployment.apps/python-app-prod-app-python unchanged
```
