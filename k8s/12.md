# Kubernetes ConfigMaps Implementation

This document details the implementation of ConfigMaps in our Kubernetes deployment to decouple configuration from application code.

## Implementation Overview

1. Created a configuration file `config.json` in the `files` folder with application settings
2. Created a ConfigMap manifest in the Helm chart to load this configuration
3. Updated the deployment to mount the ConfigMap as a volume

## File Structure

```
python-app-chart/
├── files/
│   └── config.json         # Application configuration in JSON format
├── templates/
│   ├── configmap.yaml      # ConfigMap manifest
│   └── deployment.yaml     # Updated with volume mounts
└── values.yaml             # Helm values
```

## ConfigMap Implementation

### 1. Configuration File

The `config.json` file contains application configuration in JSON format:

```json
{
  "app_name": "Moscow Time App",
  "version": "1.0.0",
  "timezone": "Europe/Moscow",
  "features": {
    "visit_counter": true,
    "timezone_display": true,
    "metrics_enabled": true
  },
  "display": {
    "show_seconds": true,
    "show_date": true,
    "date_format": "%A, %B %d, %Y"
  },
  "monitoring": {
    "prometheus_enabled": true,
    "log_level": "INFO"
  }
}
```

### 2. ConfigMap Manifest

Created a ConfigMap manifest that extracts data from the JSON file:

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "python-app-chart.fullname" . }}-config
  labels:
    {{- include "python-app-chart.labels" . | nindent 4 }}
data:
  config.json: |-
{{ .Files.Get "files/config.json" | indent 4 }}
```

### 3. Deployment Updates

Updated the deployment to mount the ConfigMap as a volume:

```yaml
volumeMounts:
  - name: config-volume
    mountPath: /app/config

volumes:
  - name: config-volume
    configMap:
      name: {{ include "python-app-chart.fullname" . }}-config
```

## Verification Steps

After deploying the application:

1. Get the list of running pods:
   ```
   $ kubectl get pods
   NAME                           READY   STATUS    RESTARTS   AGE
   python-app-758cc4d7c4-cxnrn    1/1     Running   0          2m
   ```

2. Verify the ConfigMap is mounted inside the pod:
   ```
   $ kubectl exec python-app-758cc4d7c4-cxnrn -- cat /app/config/config.json
   {
     "app_name": "Moscow Time App",
     "version": "1.0.0",
     "timezone": "Europe/Moscow",
     "features": {
       "visit_counter": true,
       "timezone_display": true,
       "metrics_enabled": true
     },
     "display": {
       "show_seconds": true,
       "show_date": true,
       "date_format": "%A, %B %d, %Y"
     },
     "monitoring": {
       "prometheus_enabled": true,
       "log_level": "INFO"
     }
   }
   ```

## Benefits of Using ConfigMaps

1. **Separation of configuration from application code** - Follows the 12-factor app methodology
2. **Configuration management without rebuilding containers** - Updates to configuration don't require new container builds
3. **Environment-specific configurations** - Different environments can use different ConfigMaps
4. **Centralized configuration management** - All config in one place, easier to track changes 