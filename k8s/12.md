# Upgrade Application for Persistence

curl http://localhost:8000/visits
```
Visit count: 6
```
![alt text](https://github.com/DoryShibkova/S25-core-course-labs/blob/lab12/k8s/lab12_1.jpg)
![alt text](https://github.com/DoryShibkova/S25-core-course-labs/blob/lab12/k8s/lab12_2.jpg)

# ConfigMap Implementation

kubectl get pods
```
NAME                                    READY   STATUS      RESTARTS      AGE
my-app-myapp-864b694d66-wngtz           1/1     Running     0             42s
post-install-job-2nqj4                  0/1     Completed   0             22h
preinstall-hook                         0/1     Completed   0             87s
vault-0                                 1/1     Running     1 (38m ago)   21h
vault-agent-injector-66f45b5fd5-jpqjb   1/1     Running     2 (42s ago)   21h
```

kubectl exec my-app-myapp-864b694d66-wngtz -- cat /config.json
```
{
    "setting": "updated_value"
}
```

# ConfigMap via Environment Variables

kubectl get pods
```
NAME                                    READY   STATUS      RESTARTS       AGE
my-app-myapp-864b694d66-5579x           1/1     Running     0              15s
post-install-job-2nqj4                  0/1     Completed   0              22h
preinstall-hook                         0/1     Completed   0              38s
vault-0                                 1/1     Running     1 (47m ago)    21h
vault-agent-injector-66f45b5fd5-jpqjb   1/1     Running     2 (9m4s ago)   21h
```

kubectl exec my-app-myapp-864b694d66-5579x -- env
```
PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=my-app-myapp-864b694d66-5579x
config.json=
VAULT_PORT_8200_TCP_PROTO=tcp
VAULT_PORT_8200_TCP_ADDR=10.102.108.138
VAULT_PORT_8201_TCP_PORT=8201
VAULT_PORT_8201_TCP_ADDR=10.102.108.138
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PROTO=tcp
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_ADDR=10.99.59.53
MY_APP_MYAPP_PORT_8000_TCP_PROTO=tcp
VAULT_SERVICE_PORT_HTTP=8200
VAULT_PORT_8200_TCP_PORT=8200
VAULT_PORT_8201_TCP_PROTO=tcp
MY_APP_MYAPP_SERVICE_HOST=10.101.1.208
VAULT_SERVICE_HOST=10.102.108.138
KUBERNETES_SERVICE_PORT=443
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_PORT_443_TCP_PROTO=tcp
KUBERNETES_PORT_443_TCP_PORT=443
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
MY_APP_MYAPP_SERVICE_PORT_HTTP=8000
VAULT_SERVICE_PORT_HTTPS_INTERNAL=8201
VAULT_PORT=tcp://10.102.108.138:8200
VAULT_AGENT_INJECTOR_SVC_PORT=tcp://10.99.59.53:443
VAULT_AGENT_INJECTOR_SVC_SERVICE_HOST=10.99.59.53
KUBERNETES_SERVICE_HOST=10.96.0.1
MY_APP_MYAPP_PORT_8000_TCP_PORT=8000
VAULT_SERVICE_PORT=8200
VAULT_PORT_8201_TCP=tcp://10.102.108.138:8201
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PORT=443
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
MY_APP_MYAPP_PORT=tcp://10.101.1.208:8000
MY_APP_MYAPP_PORT_8000_TCP_ADDR=10.101.1.208
MY_APP_MYAPP_SERVICE_PORT=8000
VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT=443
VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT_HTTPS=443
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP=tcp://10.99.59.53:443
KUBERNETES_PORT=tcp://10.96.0.1:443
MY_APP_MYAPP_PORT_8000_TCP=tcp://10.101.1.208:8000
VAULT_PORT_8200_TCP=tcp://10.102.108.138:8200
LANG=C.UTF-8
GPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696D
PYTHON_VERSION=3.11.11
PYTHON_SHA256=2a9920c7a0cd236de33644ed980a13cbbc21058bfdc528febb6081575ed73be3
HOME=/root
```
