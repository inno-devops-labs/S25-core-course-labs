# 12.md

## Task 1: Counter DOcker Compose

### 1. docker-compose.yml

```yaml
version: "3.8"

services:
    fastapi-app:
    build:
      context: ../app_python
      dockerfile: Dockerfile
    ports:
      - "80:80"
    logging: *default-logging
    deploy:
      resources:
        limits:
          memory: 512M
    volumes:
       - ./data:/app/data
```
Mapping the host’s ./data folder to /app/data

## Task 2: ConfigMap Env Vars
### 1. `files/config.json`
```
{
  "stand": "dev",
  "isFalse": true
}
```
### 2. `templates/configmap.yaml`
```
apiVersion: v1
kind: ConfigMap
metadata:
  name: python-app-config
data:
  config.json: |
    {{ .Files.Get "files/config.json" | nindent 4 }}
```
### 3. Deployment Configuration
**deployment.yaml**
  ```
  envFrom:
    - configMapRef:
        name: python-app-config
  ```
**values.yaml**
```
volumes:
   - name: config
     configMap:
       name: python-app-config

volumeMounts:
   - name: config
     mountPath: /config.json
     subPath: config.json
```
This ensures the same `config.json` is available as a file at `/config.json`.
### 3. Verification Commands and Outputs
1. **Environment Variables**  

```commandline
PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
HOSTNAME=python-app-7cc758f6d7-rshw8
config.json=
{
  "stand": "dev",
  "isFalse": true
}

MY_SECRET=my--secret
APP_AUTHOR=Nikoali01
APP_DEBUG=false
APP_COURSE=devops
PYTHON_APP_SERVICE_HOST=10.110.147.38
PYTHON_APP_SERVICE_PORT=80
PYTHON_APP_PORT_80_TCP_ADDR=10.110.147.38
VAULT_SERVICE_PORT_HTTP=8200
VAULT_SERVICE_PORT_HTTPS_INTERNAL=8201
GOLANG_APP_PORT_8080_TCP_ADDR=10.108.251.123
KUBERNETES_SERVICE_PORT_HTTPS=443
KUBERNETES_PORT_443_TCP_PROTO=tcp
VAULT_PORT_8200_TCP=tcp://10.104.110.68:8200
VAULT_PORT_8200_TCP_PROTO=tcp
VAULT_PORT_8201_TCP_PORT=8201
GOLANG_APP_SERVICE_HOST=10.108.251.123
GOLANG_APP_SERVICE_PORT=8080
PYTHON_APP_PORT_80_TCP_PORT=80
VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT=443
VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT_HTTPS=443
VAULT_PORT=tcp://10.104.110.68:8200
VAULT_PORT_8201_TCP=tcp://10.104.110.68:8201
VAULT_PORT_8201_TCP_ADDR=10.104.110.68
GOLANG_APP_PORT_8080_TCP_PROTO=tcp
KUBERNETES_SERVICE_PORT=443
PYTHON_APP_PORT=tcp://10.110.147.38:80
PYTHON_APP_SERVICE_PORT_HTTP=80
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_ADDR=10.110.10.101
GOLANG_APP_PORT_8080_TCP_PORT=8080
KUBERNETES_SERVICE_HOST=10.96.0.1
KUBERNETES_PORT_443_TCP_PORT=443
VAULT_SERVICE_HOST=10.104.110.68
GOLANG_APP_SERVICE_PORT_HTTP=8080
VAULT_AGENT_INJECTOR_SVC_PORT=tcp://10.110.10.101:443
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP=tcp://10.110.10.101:443
KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
PYTHON_APP_PORT_80_TCP=tcp://10.110.147.38:80
PYTHON_APP_PORT_80_TCP_PROTO=tcp
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PROTO=tcp
VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PORT=443
VAULT_SERVICE_PORT=8200
KUBERNETES_PORT=tcp://10.96.0.1:443
KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
VAULT_PORT_8201_TCP_PROTO=tcp
VAULT_PORT_8200_TCP_ADDR=10.104.110.68
GOLANG_APP_PORT=tcp://10.108.251.123:8080
GOLANG_APP_PORT_8080_TCP=tcp://10.108.251.123:8080
VAULT_AGENT_INJECTOR_SVC_SERVICE_HOST=10.110.10.101
VAULT_PORT_8200_TCP_PORT=8200
LANG=C.UTF-8
GPG_KEY=E3FF2839C048B25C084DEBE9B26995E310250568
PYTHON_VERSION=3.9.21
PYTHON_SHA256=3126f59592c9b0d798584755f2bf7b081fa1ca35ce7a6fea980108d752a05bb1
NAME=RegionTimeAPI
HOME=/root
```
2. **Mounted File**  
```commandline
kubectl exec python-app-7cc758f6d7-rshw8 -- cat /config.json


{
  "stand": "dev",
  "isFalse": true
}
```
   JSON content is available in the container’s filesystem
3. **Bonus Application**
  ```
      PATH=/usr/local/openjdk-17/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      HOSTNAME=java-app-6f7d9d6ddf-hz8ls
      config.json=
      {
        "stand": "dev",
        "isFalse": true
      }
      VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PORT=443
      JAVA_APP_SERVICE_PORT_HTTP=8081
      JAVA_APP_PORT_8081_TCP_PROTO=tcp
      JAVA_APP_PORT_8081_TCP_ADDR=10.106.123.223
      KUBERNETES_SERVICE_PORT_HTTPS=443
      PYTHON_APP_PORT_80_TCP_ADDR=10.110.147.38
      VAULT_PORT_8200_TCP_ADDR=10.104.110.68
      VAULT_PORT_8201_TCP_PROTO=tcp
      KUBERNETES_PORT_443_TCP_PROTO=tcp
      KUBERNETES_PORT_443_TCP_PORT=443
      PYTHON_APP_PORT=tcp://10.110.147.38:80
      VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PROTO=tcp
      JAVA_APP_PORT_8081_TCP=tcp://10.106.123.223:8081
      KUBERNETES_PORT=tcp://10.96.0.1:443
      PYTHON_APP_PORT_80_TCP=tcp://10.110.147.38:80
      VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT=443
      VAULT_PORT_8200_TCP_PROTO=tcp
      JAVA_APP_PORT=tcp://10.106.123.223:8081
      KUBERNETES_SERVICE_PORT=443
      PYTHON_APP_SERVICE_PORT_HTTP=80
      JAVA_APP_PORT_8081_TCP_PORT=8081
      KUBERNETES_SERVICE_HOST=10.96.0.1
      PYTHON_APP_PORT_80_TCP_PROTO=tcp
      VAULT_AGENT_INJECTOR_SVC_SERVICE_HOST=10.110.10.101
      VAULT_AGENT_INJECTOR_SVC_PORT=tcp://10.110.10.101:443
      VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP=tcp://10.110.10.101:443
      VAULT_PORT_8201_TCP=tcp://10.104.110.68:8201
      JAVA_APP_SERVICE_PORT=8081
      PYTHON_APP_PORT_80_TCP_PORT=80
      VAULT_SERVICE_PORT_HTTP=8200
      VAULT_PORT=tcp://10.104.110.68:8200
      VAULT_PORT_8200_TCP_PORT=8200
      VAULT_PORT_8201_TCP_PORT=8201
      KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
      VAULT_SERVICE_PORT_HTTPS_INTERNAL=8201
      VAULT_PORT_8200_TCP=tcp://10.104.110.68:8200
      VAULT_PORT_8201_TCP_ADDR=10.104.110.68
      KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
      PYTHON_APP_SERVICE_PORT=80
      PYTHON_APP_SERVICE_HOST=10.110.147.38
      VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT_HTTPS=443
      VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_ADDR=10.110.10.101
      VAULT_SERVICE_HOST=10.104.110.68
      VAULT_SERVICE_PORT=8200
      JAVA_APP_SERVICE_HOST=10.106.123.223
      JAVA_HOME=/usr/local/openjdk-17
      LANG=C.UTF-8
      JAVA_VERSION=17.0.2
      HOME=/root
```