# Kubernetes ConfigMaps

`/visits` endpoint is added for both, python and kotlin apps.

Logs of running python container with /visits:

```text
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\app_python> Invoke-WebRequest -Uri "http://localhost:5000/visits" -Method Get


StatusCode        : 200
StatusDescription : OK
Content           : Total visits: 63
RawContent        : HTTP/1.1 200 OK
                    Connection: close
                    Content-Length: 16
                    Content-Type: text/html; charset=utf-8
                    Date: Sat, 08 Mar 2025 17:12:05 GMT
                    Server: Werkzeug/3.1.3 Python/3.11.2

                    Total visits: 63
Forms             : {}
Headers           : {[Connection, close], [Content-Length, 16], [Content-Type, text/html; charset=utf-8], [Date, Sat, 08 Mar 2025 17:12:05 GMT]...}
Images            : {}
InputFields       : {}
Links             : {}
ParsedHtml        : mshtml.HTMLDocumentClass
RawContentLength  : 16
```

## Configmaps

### Python Configmap

```text
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> helm install flask-release .\flask-app\
NAME: flask-release
LAST DEPLOYED: Sat Mar  8 22:33:58 2025
STATUS: deployed
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=flask-app,app.kubernetes.io/instance=flask-release" -o jsonpath="{.items[0].metadata.name}")    
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl get po
NAME                                      READY   STATUS    RESTARTS   AGE
flask-release-flask-app-d4c477878-27mln   1/1     Running   0          25s
flask-release-flask-app-d4c477878-q9kct   1/1     Running   0          25s
flask-release-flask-app-d4c477878-zsfc7   1/1     Running   0          25s
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl exec flask-release-flask-app-d4c477878-27mln -- ls /data/config.json
/data/config.json
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl exec flask-release-flask-app-d4c477878-27mln -- cat /data/config.json

{
  "timezone": "Europe/Moscow",
  "app_port": 5000
}
```

## Bonus Kotlin Ktor Configmap

```text
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl get configmaps                                                   
NAME               DATA   AGE
flask-app-config   1      17h
ktor-app-config    1      73s
kube-root-ca.crt   1      19h
```

```text
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> helm install ktor-release .\ktor-app\
NAME: ktor-release
LAST DEPLOYED: Sun Mar  9 15:35:28 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=ktor-app,app.kubernetes.io/instance=ktor-release" -o jsonpath="{.items[0].metadata.name}")      
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT

PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl get po
NAME                                      READY   STATUS              RESTARTS   AGE
flask-release-flask-app-d4c477878-27mln   1/1     Running             0          17h
flask-release-flask-app-d4c477878-q9kct   1/1     Running             0          17h
flask-release-flask-app-d4c477878-zsfc7   1/1     Running             0          17h
ktor-release-ktor-app-6f9b7dfd8d-gglkt    0/1     ContainerCreating   0          9s
ktor-release-ktor-app-6f9b7dfd8d-m74g4    0/1     ContainerCreating   0          9s
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl get configmaps                                                   
NAME               DATA   AGE
flask-app-config   1      17h
ktor-app-config    1      73s
kube-root-ca.crt   1      19h

PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl exec ktor-release-ktor-app-6f9b7dfd8d-gglkt -- cat /data/config.json
{
  "timezone": "UTC",
  "app_port": 8080
}
```

## Environment variables

```text
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> helm install ktor-release .\ktor-app\
NAME: ktor-release
LAST DEPLOYED: Sun Mar  9 15:50:01 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=ktor-app,app.kubernetes.io/instance=ktor-release" -o jsonpath="{.items[0].metadata.name}")      
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> helm install flask-release .\flask-app\
NAME: flask-release
LAST DEPLOYED: Sun Mar  9 15:50:09 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=flask-app,app.kubernetes.io/instance=flask-release" -o jsonpath="{.items[0].metadata.name}")    
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
NAME                                       READY   STATUS    RESTARTS   AGE
flask-release-flask-app-5867b4fcf9-4pkmr   1/1     Running   0          81s
flask-release-flask-app-5867b4fcf9-gnpf7   1/1     Running   0          81s
flask-release-flask-app-5867b4fcf9-wq5n9   1/1     Running   0          81s
ktor-release-ktor-app-644dbb9cc6-lq2s5     1/1     Running   0          2m
ktor-release-ktor-app-644dbb9cc6-lv6l4     1/1     Running   0          2m
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl exec flask-release-flask-app-5867b4fcf9-4pkmr -- printenv config.json

{
  "timezone": "Europe/Moscow",
  "app_port": 5000
}
PS C:\Users\egora\PycharmProjects\S25-core-course-labs\k8s> kubectl exec ktor-release-ktor-app-644dbb9cc6-lq2s5 -- printenv config.json
{
  "timezone": "UTC",
  "app_port": 8080
}
```
