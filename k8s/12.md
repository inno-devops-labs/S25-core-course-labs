# Kubernetes ConfigMap Lab 12

## Task 1

New endpoint: /visits was added to Python app. It returns number of visits to the app.
Visits info is stored in visits file (app_python/data/visits), which is mounted to the container as a volume. 
Also upgrade **monitoring/docker-compose.yml**:
```yml
app:
    image: vika123vika/app-python
    ports:
      - "8080:8080"
    volumes:
      - ../app-python/data:/app/data
```

## Task 2

Create **k8s/app_python/files/config.json**:
```json
{
  "app_name": "Moscow time app",
  "version": "1.0"
}
```

Create **k8s/app_python/templates/configmap.yaml**:
```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  config.json: |
    {{ .Files.Get "files/config.json" | nindent 4 }}
```

Update **k8s/app_python/templates/deployment.yaml** (add in volumeMounts and volumes):
```yaml
volumeMounts:
            - name: visits-storage
              mountPath: /app_python/data
              
volumes:
        - name: visits-storage
          persistentVolumeClaim:
            claimName: visits-pvc
```

### ConfigMap creation
Command and output:
```bash
➞ kubectl get configmap

NAME          DATA   AGE
app-config    1      21m
```

### Pods
Command and output:
```bash
➞ kubectl get po

NAME                                       READY     STATUS    RESTARTS        AGE
my-helm-release-python-app-34hd45sd3-fh4s2   2/2     Running   0               50s          
vault-0                                      1/1     Running   3 (95m ago)     48h
vault-agent-injector-84b987db6f-lgp8x        1/1     Running   3 (95m ago)     48h
```

### Checking mounted config.json
Command and output:
```bash
➞ kubectl exec my-helm-release-python-app-34hd45sd3-fh4s2 -- cat /config/config.json

Defaulted container "my-helm-release-python-app-34hd45sd3-fh4s2" out of: moscow-time-python, vault-agent

{
  "app_name": "Moscow time app",
  "version": "1.0"
}	
```
