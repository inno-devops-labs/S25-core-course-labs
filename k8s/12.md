# ConfigMaps

## Task 1

For this task I have added some code to the applications, and a couple of volumes to [docker-compose.yml](/monitoring/docker-compose.yml). As a proof of concept, I will not delete/gitignore the `visit.txt`-s from when I tested the apps.

## Task 2

For this task I had to add a `config.json` and a `config.yaml`, and edit the volumes section in `values.yaml` of the python app. Then I had to reinstall it in helm, and verify that everything is working as it is supposed to:

```bash
$ helm secrets install app-python app-python/ -n default -f secrets.yaml
NAME: app-python
LAST DEPLOYED: Sun Mar  9 22:06:06 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services app-python)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
removed 'secrets.yaml.dec'

$ kubectl get configmaps,pods,svc,serviceaccounts
NAME                          DATA   AGE
configmap/app-python-config   1      116s
configmap/kube-root-ca.crt    1      10h

NAME                                        READY   STATUS    RESTARTS   AGE
pod/app-go-79894d8d94-dtnxm                 1/1     Running   0          8h
pod/app-python-86dc86f978-vjg9m             2/2     Running   0          115s
pod/vault-0                                 1/1     Running   0          8h
pod/vault-agent-injector-66f45b5fd5-jxrfq   1/1     Running   0          8h

NAME                               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/app-go                     NodePort    10.111.227.159   <none>        8080:31030/TCP      8h
service/app-python                 NodePort    10.103.177.131   <none>        8081:32231/TCP      116s
service/kubernetes                 ClusterIP   10.96.0.1        <none>        443/TCP             10h
service/vault                      ClusterIP   10.97.106.234    <none>        8200/TCP,8201/TCP   8h
service/vault-agent-injector-svc   ClusterIP   10.111.221.151   <none>        443/TCP             8h
service/vault-internal             ClusterIP   None             <none>        8200/TCP,8201/TCP   8h

NAME                                  SECRETS   AGE
serviceaccount/app-go                 0         8h
serviceaccount/app-python             0         116s
serviceaccount/default                0         10h
serviceaccount/vault                  0         8h
serviceaccount/vault-agent-injector   0         8h

$ kubectl describe configmaps app-python-config 
Name:         app-python-config
Namespace:    default
Labels:       app.kubernetes.io/instance=app-python
              app.kubernetes.io/managed-by=Helm
              app.kubernetes.io/name=app-python
              app.kubernetes.io/version=latest
              helm.sh/chart=app-python-0.1.0
Annotations:  meta.helm.sh/release-name: app-python
              meta.helm.sh/release-namespace: default

Data
====
config.json:
----
{
    "foo": "bar"
}


BinaryData
====

Events:  <none>

$ kubectl exec app-python-86dc86f978-vjg9m -- printenv config.json
Defaulted container "app-python" out of: app-python, vault-agent, vault-agent-init (init)
{
    "foo": "bar"
}

$ kubectl exec app-python-86dc86f978-vjg9m -- cat /app/data/config.json
Defaulted container "app-python" out of: app-python, vault-agent, vault-agent-init (init)
{
    "foo": "bar"
}
```

## Bonus task

This task is mostly a repetition of previous steps for the go app with a slight modification of `deployment.yaml` for both applications. The output for the python app is above, and for go app is below:

```bash
$ helm install app-go app-go/
NAME: app-go
LAST DEPLOYED: Sun Mar  9 22:22:41 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services app-go)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT

$ kubectl get configmaps,pods,svc,serviceaccounts
NAME                          DATA   AGE
configmap/app-go-config       1      30s
configmap/app-python-config   1      17m
configmap/kube-root-ca.crt    1      10h

NAME                                        READY   STATUS    RESTARTS   AGE
pod/app-go-79bdf6b457-wwr22                 1/1     Running   0          30s
pod/app-python-86dc86f978-vjg9m             2/2     Running   0          17m
pod/vault-0                                 1/1     Running   0          8h
pod/vault-agent-injector-66f45b5fd5-jxrfq   1/1     Running   0          8h

NAME                               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/app-go                     NodePort    10.111.125.191   <none>        8080:32065/TCP      30s
service/app-python                 NodePort    10.103.177.131   <none>        8081:32231/TCP      17m
service/kubernetes                 ClusterIP   10.96.0.1        <none>        443/TCP             10h
service/vault                      ClusterIP   10.97.106.234    <none>        8200/TCP,8201/TCP   8h
service/vault-agent-injector-svc   ClusterIP   10.111.221.151   <none>        443/TCP             8h
service/vault-internal             ClusterIP   None             <none>        8200/TCP,8201/TCP   8h

NAME                                  SECRETS   AGE
serviceaccount/app-go                 0         30s
serviceaccount/app-python             0         17m
serviceaccount/default                0         10h
serviceaccount/vault                  0         8h
serviceaccount/vault-agent-injector   0         8h

$ kubectl describe configmaps app-go-config 
Name:         app-go-config
Namespace:    default
Labels:       app.kubernetes.io/instance=app-go
              app.kubernetes.io/managed-by=Helm
              app.kubernetes.io/name=app-go
              app.kubernetes.io/version=1.16.0
              helm.sh/chart=app-go-0.1.0
Annotations:  meta.helm.sh/release-name: app-go
              meta.helm.sh/release-namespace: default

Data
====
config.json:
----
{
    "dummy": "config"
}


BinaryData
====

Events:  <none>

$ kubectl exec app-go-79bdf6b457-wwr22 -- printenv config.json
{
    "dummy": "config"
}

$ kubectl exec app-go-79bdf6b457-wwr22 -- cat /app/data/config.json
{
    "dummy": "config"
}
```
