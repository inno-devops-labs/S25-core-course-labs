# ConfigMap and Persistence Implementation

## Overview
This document describes the implementation of persistence and ConfigMap in a Kubernetes environment. The application has been enhanced to track visit counts and store configuration data using Kubernetes ConfigMaps.

## Task 1: Application Persistence

### Application Changes
- Added visit counter functionality
- Implemented persistent storage using volumes
- Created new `/visits` endpoint
- Data stored in `/data/visits.txt`

### Application Update Verification
```bash
# Check pod status and get pod name
$ POD_NAME=$(kubectl get pod -l app=myapp -o jsonpath='{.items[0].metadata.name}')
$ kubectl get pods
NAME                                READY   STATUS    RESTARTS   AGE
myapp-deployment-7678fb9cc5-84mzx   1/1     Running   0          2m

# Test persistence functionality
$ curl localhost:8000/
Hello! Current time is 2025-03-09 18:01:55.182506

$ curl localhost:8000/visits
Total visits: 1

$ curl localhost:8000/
Hello! Current time is 2025-03-09 18:02:07.603195

$ curl localhost:8000/visits
Total visits: 2

# Verify data persistence
$ kubectl exec -it $POD_NAME -- ls -la /data
total 8
drwxrwxrwx    2 root     root          4096 Mar  9 17:42 .
drwxr-xr-x    1 root     root          4096 Mar  9 17:51 ..
```

### Volume Configuration
The application uses a PersistentVolume for data storage:
- Volume mounted at `/data`
- Persistence across pod restarts
- ReadWriteOnce access mode
- 1Gi storage capacity

## Task 2: ConfigMap Implementation

### Configuration Details
The application configuration is stored in a ConfigMap and includes:
- Application name and version
- Data path configuration
- Visit file location
- Port settings

### ConfigMap Structure
```json
{
  "app_name": "Flask Time App",
  "version": "1.0.0",
  "data_path": "/data",
  "visits_file": "visits.txt",
  "port": 8000
}
```

### ConfigMap Verification
```bash
# Check ConfigMap content in pod
$ kubectl exec -it $POD_NAME -- cat /app/config.json
{
  "app_name": "Flask Time App",
  "version": "1.0.0",
  "data_path": "/data",
  "visits_file": "visits.txt",
  "port": 8000
}

# Verify volume mounts
$ kubectl describe pod $POD_NAME | grep -A 2 Mounts:
    Mounts:
      /app/config.json from config-volume (rw,path="config.json")
      /data from data-volume (rw)
```

### Implementation Details
1. ConfigMap Creation:
   - Created from config.json file
   - Mounted as a file in the container
   - Used for application configuration

2. Volume Mounts:
   - ConfigMap mounted at `/app/config.json`
   - Persistent volume mounted at `/data`
   - Both mounts configured in deployment

## Helm Deployment

### Deployment Status
```bash
$ helm upgrade --install myapp ./k8s
Release "myapp" has been upgraded. Happy Helming!
NAME: myapp
LAST DEPLOYED: Sun Mar  9 20:57:56 2025
NAMESPACE: default
STATUS: deployed
REVISION: 5
TEST SUITE: None
```

### Key Components
1. Deployment Configuration:
   - 3 replicas for high availability
   - Resource limits configured
   - ConfigMap and volume mounts defined

2. Persistent Storage:
   - PersistentVolume for data storage
   - PersistentVolumeClaim for volume requests
   - HostPath storage on local node

3. Configuration Management:
   - ConfigMap for application settings
   - JSON configuration format
   - Mounted as a file in the container 