# Lab 12: Kubernetes ConfigMaps - Documentation

## Task 1: Upgrade Application for Persistence

### Steps Taken:
1. **Implemented Counter Logic**
   - Modified `app.py` to maintain a `visits` counter stored in `visits` file.
   - Introduced `/visits` endpoint to display the visit count.
2. **Tested Changes**
   - Verified counter persistence locally.
   - Updated `Dockerfile` to ensure the `visits` file is used correctly.
3. **Updated Deployment**
   - Created a PersistentVolumeClaim (PVC) named `visits-pvc`.
   - Mounted `visits` file to `/app/visits` inside the container.
---
## Task 2: ConfigMap Implementation

### Steps Taken:
1. **Created ConfigMap**
   - Created `config.json` inside the `files/` directory with sample configuration.
   - Defined a ConfigMap (`app-config`) using Helm’s `.Files.Get`.
2. **Updated Deployment**
   - Mounted `config.json` from ConfigMap to `/app/config.json` inside the pod.
3. **Installed and Verified Helm Chart**
   - Deployed the updated chart and checked pod logs and ConfigMap presence.

### Verification Commands:
```sh
> helm package .
Successfully packaged chart and saved it to: /Users/renatalatypova/PycharmProjects/S25-core-course-labs/k8s/app-python/app-python-0.1.0.tgz
(base) ┌─[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s/app-python] - [Sun Mar 09, 19:34]
└─[$] <git:(lab12*)> helm install app-python .
NAME: app-python
LAST DEPLOYED: Sun Mar  9 19:34:59 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=app-python,app.kubernetes.io/instance=app-python" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
(base) ┌─[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s/app-python] - [Sun Mar 09, 19:35]
└─[$] <git:(lab12*)> kubectl get pods
NAME                                    READY   STATUS    RESTARTS   AGE
app-python-5bb576c45-tl2jb              1/1     Running   0          118s

> kubectl get configmaps
NAME               DATA   AGE
app-config         1      4m13s

(base) ┌─[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s/app-python] - [Sun Mar 09, 19:37]
└─[$] <git:(lab12*)> kubectl exec -it app-python-5bb576c45-tl2jb  -- cat /app/config.json

{
  "app_name": "FlaskApp",
  "version": "1.0",
  "timezone": "Europe/Moscow"
}
```