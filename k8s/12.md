# ConfigMap usage

```
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ helm secrets install python-app ./python-app/ -n default -f ./python-app/secrets.yml
[helm-secrets] Decrypt: ./python-app/secrets.yml
NAME: python-app
LAST DEPLOYED: Sun Mar  9 18:56:40 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services python-app)
  export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
[helm-secrets] Removed: ./python-app/secrets.yml.dec
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ kubectl get pods
NAME                          READY   STATUS    RESTARTS      AGE
python-app-6c5c5c56c7-2mf9w   1/1     Running   1 (98s ago)   118s
python-app-6c5c5c56c7-9j28s   1/1     Running   1 (98s ago)   118s
python-app-6c5c5c56c7-lsqhl   1/1     Running   1 (98s ago)   118s
```

```
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ kubectl get configmaps
NAME                DATA   AGE
kube-root-ca.crt    1      45d
python-app-config   1      2m40s
```

Check that configmap is really mounted into pods:
```
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ kubectl exec -it python-app-6c5c5c56c7-2mf9w -- /bin/sh
/app $ cd ..
/ $ ls
app    data   etc    lib    mnt    proc   run    srv    tmp    var
bin    dev    home   media  opt    root   sbin   sys    usr
/ $ cd data
/data $ ls
config.json
/data $ cat config.json
{
  "name": "Nikita",
  "surname": "Bagrov",
  "language": "python"
}/data $ exit
```

Check pod variables:
```
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ kubectl describe pod python-app-6c5c5c56c7-2mf9w
Name:             python-app-6c5c5c56c7-2mf9w
Namespace:        default
Priority:         0
Service Account:  internal-app
Node:             laptop-dobkkts4/172.17.201.28
Start Time:       Sun, 09 Mar 2025 18:57:04 +0300
Labels:           app.kubernetes.io/instance=python-app
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/name=python-app
                  app.kubernetes.io/version=1.16.0
                  helm.sh/chart=python-app-0.1.0
                  pod-template-hash=6c5c5c56c7
Annotations:      vault.hashicorp.com/agent-inject: true
                  vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
                  vault.hashicorp.com/role: internal-app
Status:           Running
IP:               10.42.0.248
IPs:
  IP:           10.42.0.248
Controlled By:  ReplicaSet/python-app-6c5c5c56c7
Containers:
  python-app:
    Container ID:   containerd://be0ea2faf7e7471ae2aab69dd38f676ec4527798423abdbf319720efa870e170
    Image:          zerohalf/moscow-time-app:latest
    Image ID:       docker.io/zerohalf/moscow-time-app@sha256:57bab0c89b88e7123e14ba92ab076a8cd09fe23f8fb79687fe90a01fbb82fab2
    Port:           8000/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sun, 09 Mar 2025 18:57:24 +0300
    Last State:     Terminated
      Reason:       Completed
      Exit Code:    0
      Started:      Sun, 09 Mar 2025 18:57:06 +0300
      Finished:     Sun, 09 Mar 2025 18:57:24 +0300
    Ready:          True
    Restart Count:  1
    Limits:
      cpu:     100m
      memory:  128Mi
    Requests:
      cpu:      100m
      memory:   128Mi
    Liveness:   http-get http://:8000/ delay=3s timeout=1s period=5s #success=1 #failure=3
    Readiness:  http-get http://:8000/ delay=3s timeout=1s period=5s #success=1 #failure=3
    Environment Variables from:
      python-app-config  ConfigMap  Optional: false
    Environment:
      MY_PASS:  <set to the key 'password' in secret 'credentials'>  Optional: false
    Mounts:
      /data/config.json from config-volume (ro,path="config.json")
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-j7h9r (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True
  Initialized                 True
  Ready                       True
  ContainersReady             True
  PodScheduled                True
Volumes:
  config-volume:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      python-app-config
    Optional:  false
  kube-api-access-j7h9r:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   Guaranteed
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason     Age                    From               Message
  ----     ------     ----                   ----               -------
  Normal   Scheduled  6m52s                  default-scheduler  Successfully assigned default/python-app-6c5c5c56c7-2mf9w to laptop-dobkkts4
  Normal   Killing    6m37s                  kubelet            Container python-app failed liveness probe, will be restarted
  Normal   Pulled     6m32s (x2 over 6m51s)  kubelet            Container image "zerohalf/moscow-time-app:latest" already present on machine
  Normal   Created    6m32s (x2 over 6m51s)  kubelet            Created container python-app
  Normal   Started    6m32s (x2 over 6m50s)  kubelet            Started container python-app
```

Check all the same conditions for bonus app:
```
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ kubectl get pods
NAME                          READY   STATUS    RESTARTS        AGE
nodejs-app-6df4489bb4-247fn   1/1     Running   0               44s
nodejs-app-6df4489bb4-d8qkq   1/1     Running   0               44s
nodejs-app-6df4489bb4-l52sh   1/1     Running   0               44s
python-app-6c5c5c56c7-2mf9w   1/1     Running   1 (8m56s ago)   9m16s
python-app-6c5c5c56c7-9j28s   1/1     Running   1 (8m56s ago)   9m16s
python-app-6c5c5c56c7-lsqhl   1/1     Running   1 (8m56s ago)   9m16s
```

```
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ kubectl get configmaps
NAME                DATA   AGE
kube-root-ca.crt    1      45d
nodejs-app-config   1      65s
python-app-config   1      9m38s
```

```
nikita@LAPTOP-DOBKKTS4:~/S25-core-course-labs/k8s$ kubectl describe pod nodejs-app-6df4489bb4-247fn
Name:             nodejs-app-6df4489bb4-247fn
Namespace:        default
Priority:         0
Service Account:  nodejs-app
Node:             laptop-dobkkts4/172.17.201.28
Start Time:       Sun, 09 Mar 2025 19:05:36 +0300
Labels:           app.kubernetes.io/instance=nodejs-app
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/name=nodejs-app
                  app.kubernetes.io/version=1.16.0
                  helm.sh/chart=nodejs-app-0.1.0
                  pod-template-hash=6df4489bb4
Annotations:      <none>
Status:           Running
IP:               10.42.0.251
IPs:
  IP:           10.42.0.251
Controlled By:  ReplicaSet/nodejs-app-6df4489bb4
Containers:
  nodejs-app:
    Container ID:   containerd://7b153e341dc4f661c5f53654bad2502232d031b7b2c7eff83510ddf5e1c7c272
    Image:          zerohalf/app_nodejs:nonroot
    Image ID:       docker.io/zerohalf/app_nodejs@sha256:409734e5fbf6ca7d30e1f9b4361d74dca3113ef95ae8789a7499007781e3777e
    Port:           3000/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sun, 09 Mar 2025 19:05:37 +0300
    Ready:          True
    Restart Count:  0
    Limits:
      cpu:     100m
      memory:  128Mi
    Requests:
      cpu:      100m
      memory:   128Mi
    Liveness:   http-get http://:3000/ delay=3s timeout=1s period=5s #success=1 #failure=3
    Readiness:  http-get http://:3000/ delay=3s timeout=1s period=5s #success=1 #failure=3
    Environment Variables from:
      nodejs-app-config  ConfigMap  Optional: false
    Environment:         <none>
    Mounts:
      /data/config.json from config-volume (ro,path="config.json")
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-92c2j (ro)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True
  Initialized                 True
  Ready                       True
  ContainersReady             True
  PodScheduled                True
Volumes:
  config-volume:
    Type:      ConfigMap (a volume populated by a ConfigMap)
    Name:      python-app-config
    Optional:  false
  kube-api-access-92c2j:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   Guaranteed
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type    Reason     Age    From               Message
  ----    ------     ----   ----               -------
  Normal  Scheduled  2m28s  default-scheduler  Successfully assigned default/nodejs-app-6df4489bb4-247fn to laptop-dobkkts4
  Normal  Pulled     2m28s  kubelet            Container image "zerohalf/app_nodejs:nonroot" already present on machine
  Normal  Created    2m28s  kubelet            Created container nodejs-app
  Normal  Started    2m28s  kubelet            Started container nodejs-app
```