## `helm install --dry-run --debug time-app-py time-app-py`

```
install.go:225: 2025-03-16 20:25:41.032339554 +0300 MSK m=+0.103832633 [debug] Original chart version: ""
install.go:242: 2025-03-16 20:25:41.034799968 +0300 MSK m=+0.106293016 [debug] CHART PATH: /home/leonidm/S25-core-course-labs/k8s/time-app-py

NAME: time-app-py
LAST DEPLOYED: Sun Mar 16 20:25:41 2025
NAMESPACE: default
STATUS: pending-install
REVISION: 1
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
affinity: {}
autoscaling:
  enabled: false
  maxReplicas: 100
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
fullnameOverride: ""
image:
  pullPolicy: IfNotPresent
  repository: unileonid/time-app-py
  tag: latest
imagePullSecrets: []
ingress:
  annotations: {}
  className: ""
  enabled: false
  hosts:
  - host: chart-example.local
    paths:
    - path: /
      pathType: ImplementationSpecific
  tls: []
livenessProbe:
  httpGet:
    path: /
    port: http
nameOverride: ""
nodeSelector: {}
podAnnotations:
  vault.hashicorp.com/agent-inject: "true"
  vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
  vault.hashicorp.com/role: time-app-py
podLabels: {}
podSecurityContext: {}
readinessProbe:
  httpGet:
    path: /
    port: http
replicaCount: 3
resources:
  limits:
    cpu: 1
    memory: 128Mi
  requests:
    cpu: 1
    memory: 128Mi
securityContext: {}
service:
  port: 80
  type: ClusterIP
serviceAccount:
  annotations: {}
  automount: true
  create: true
  name: time-app-py
tolerations: []
volumeMounts: []
volumes: []

HOOKS:
---
# Source: time-app-py/templates/post-install-hook.yaml
apiVersion: v1
kind: Pod
metadata:
   name: postinstall-hook
   annotations:
       "helm.sh/hook": "post-install"
spec:
  containers:
  - name: post-install-container
    image: busybox
    imagePullPolicy: Always
    command: ['sh', '-c', 'echo The post-install hook is running && sleep 15' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: time-app-py/templates/pre-install-hook.yaml
apiVersion: v1
kind: Pod
metadata:
   name: preinstall-hook
   annotations:
       "helm.sh/hook": "pre-install"
spec:
  containers:
  - name: pre-install-container
    image: busybox
    imagePullPolicy: IfNotPresent
    command: ['sh', '-c', 'echo The pre-install hook is running && sleep 20' ]
  restartPolicy: Never
  terminationGracePeriodSeconds: 0
---
# Source: time-app-py/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "time-app-py-test-connection"
  labels:
    helm.sh/chart: time-app-py-0.1.0
    app.kubernetes.io/name: time-app-py
    app.kubernetes.io/instance: time-app-py
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['time-app-py:80']
  restartPolicy: Never
MANIFEST:
---
# Source: time-app-py/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: time-app-py
  labels:
    helm.sh/chart: time-app-py-0.1.0
    app.kubernetes.io/name: time-app-py
    app.kubernetes.io/instance: time-app-py
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
automountServiceAccountToken: true
---
# Source: time-app-py/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: time-app-py
  labels:
    helm.sh/chart: time-app-py-0.1.0
    app.kubernetes.io/name: time-app-py
    app.kubernetes.io/instance: time-app-py
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 80
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: time-app-py
    app.kubernetes.io/instance: time-app-py
---
# Source: time-app-py/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: time-app-py
  labels:
    helm.sh/chart: time-app-py-0.1.0
    app.kubernetes.io/name: time-app-py
    app.kubernetes.io/instance: time-app-py
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 3
  podManagementPolicy: "Parallel"
  selector:
    matchLabels:
      app.kubernetes.io/name: time-app-py
      app.kubernetes.io/instance: time-app-py
  template:
    metadata:
      annotations:
        vault.hashicorp.com/agent-inject: "true"
        vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
        vault.hashicorp.com/role: time-app-py
      labels:
        helm.sh/chart: time-app-py-0.1.0
        app.kubernetes.io/name: time-app-py
        app.kubernetes.io/instance: time-app-py
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: time-app-py
      containers:
        - name: time-app-py
          image: "unileonid/time-app-py:latest"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            limits:
              cpu: 1
              memory: 128Mi
            requests:
              cpu: 1
              memory: 128Mi
          env:
            - name: DB_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: db-user-pass
                  key: password
            
            - name: DB_USER
              value: "admin"
            - name: DB_HOST
              value: "http://localhost:5432"
  volumeClaimTemplates:
  - metadata:
      name: time-app-py-volume
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 1Gi

NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=time-app-py,app.kubernetes.io/instance=time-app-py" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
```

## `helm install time-app-py time-app-py`

```
NAME: time-app-py
LAST DEPLOYED: Sun Mar 16 20:27:07 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=time-app-py,app.kubernetes.io/instance=time-app-py" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
```

## `kubectl get po,sts,svc,pvc`

```
NAME                                          READY   STATUS             RESTARTS       AGE
pod/helm-hooks-time-app-py-576d5885f4-j8n8q   1/1     Running            3 (145m ago)   13d
pod/postinstall-hook                          0/1     ImagePullBackOff   0              4m38s
pod/preinstall-hook                           0/1     Completed          0              33s
pod/python-app-time-app-py-5bfc864946-k54lt   0/2     Init:0/1           0              97m
pod/time-app-py-0                             1/1     Running            0              11s
pod/time-app-py-1                             0/1     Pending            0              11s
pod/time-app-py-2                             0/1     Pending            0              11s
pod/vault-0                                   1/1     Running            1 (11d ago)    11d
pod/vault-agent-injector-66f45b5fd5-rbdtp     1/1     Running            1 (11d ago)    11d

NAME                           READY   AGE
statefulset.apps/time-app-py   1/3     11s
statefulset.apps/vault         1/1     11d

NAME                               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/helm-hooks-time-app-py     ClusterIP   10.97.79.114     <none>        80/TCP              13d
service/kubernetes                 ClusterIP   10.96.0.1        <none>        443/TCP             14d
service/python-app-time-app-py     ClusterIP   10.111.121.179   <none>        80/TCP              97m
service/time-app-py                ClusterIP   10.103.160.99    <none>        80/TCP              11s
service/vault                      ClusterIP   10.110.90.203    <none>        8200/TCP,8201/TCP   11d
service/vault-agent-injector-svc   ClusterIP   10.96.185.165    <none>        443/TCP             11d
service/vault-internal             ClusterIP   None             <none>        8200/TCP,8201/TCP   11d

NAME                                                     STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/time-app-py-volume-time-app-py-0   Bound    pvc-89dc2f91-ba39-4e38-a6c0-3a92c0c65039   1Gi        RWO            standard       <unset>                 24m
persistentvolumeclaim/time-app-py-volume-time-app-py-1   Bound    pvc-4e1afc94-3708-4ca2-83ac-22e1b08e7d9f   1Gi        RWO            standard       <unset>                 24m
persistentvolumeclaim/time-app-py-volume-time-app-py-2   Bound    pvc-8ba5e028-e0d5-42b3-a96d-b68ff2d6e522   1Gi        RWO            standard       <unset>                 24m
```
