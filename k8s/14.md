# Lab 14: Kubernetes StatefulSet Report

## Task 1: StatefulSet Implementation and Exploration

### 1. StatefulSet and Pod Status

- Output of kubectl get po,sts,svc,pvc

```bash
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs/k8s$ kubectl get po,sts,svc,pvc
NAME                                        READY   STATUS    RESTARTS      AGE
pod/app-go-59fc744f59-wlz4p                 1/1     Running   3 (10h ago)   7d3h
pod/app-python-0                            0/1     Running   0             76s
pod/app-python-1                            0/1     Running   0             76s
pod/app-python-7d68cbfc76-6hqj2             1/1     Running   0             107m
pod/app-python-7d68cbfc76-nsv2h             1/1     Running   0             107m
pod/go-app-app-go-cbb68c5f-xhwmn            1/1     Running   0             162m
pod/vault-0                                 1/1     Running   4 (10h ago)   7d8h
pod/vault-agent-injector-66f45b5fd5-brht5   1/1     Running   4 (10h ago)   7d8h
pod/vault-test                              1/1     Running   4 (47m ago)   4h47m

NAME                          READY   AGE
statefulset.apps/app-python   0/2     76s
statefulset.apps/vault        1/1     7d8h

NAME                               TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/app-go                     ClusterIP   10.102.156.131   <none>        80/TCP              7d3h
service/app-python                 ClusterIP   10.111.51.54     <none>        8000/TCP            76s
service/go-app-app-go              ClusterIP   10.99.36.131     <none>        80/TCP              162m
service/kubernetes                 ClusterIP   10.96.0.1        <none>        443/TCP             12d
service/vault                      ClusterIP   10.111.114.30    <none>        8200/TCP,8201/TCP   7d8h
service/vault-agent-injector-svc   ClusterIP   10.98.209.177    <none>        443/TCP             7d8h
service/vault-internal             ClusterIP   None             <none>        8200/TCP,8201/TCP   7d8h

NAME                                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/app-python-pvc-app-python-0   Bound    pvc-3923a0eb-0767-4c7b-af58-d28c0c92c0ff   512Mi      RWO            standard       <unset>                 76s
persistentvolumeclaim/app-python-pvc-app-python-1   Bound    pvc-691d38ac-78ee-4b0d-9e36-594a11e77e63   512Mi      RWO            standard       <unset>                 76s
```

## 2. Accessing the Application


```bash
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs$ kubectl exec pod/app-python-0 -- cat .data/visits
108saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs$ kubectl exec pod/app-python-1 -- cat .data/visits
106saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs$
```
The number of visits is different for each pod. This occurs because incoming requests are distributed across multiple pods, and each pod writes to its own visits file stored in its persistent volume. Since each replica maintains a separate counter, the visit counts vary across the pods.


## Task 2: Persistent Storage Validation

```bash
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs$ kubectl delete pod app-python-0
pod "app-python-0" deleted
```

## 2. Verifying Data Persistence

```bash
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs/k8s$ kubectl get pvc
NAME                          STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
app-python-pvc-app-python-0   Bound    pvc-3923a0eb-0767-4c7b-af58-d28c0c92c0ff   512Mi      RWO            standard       <unset>                 2m31s
app-python-pvc-app-python-1   Bound    pvc-691d38ac-78ee-4b0d-9e36-594a11e77e63   512Mi      RWO            standard       <unset>                 2m31s
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs/k8s$ kubectl exec app-python-0 -- cat ./data/visits
cat: can't open './data/visits': No such file or directory
command terminated with exit code 1
```
After the pod was recreated, the visit count was initially unavailable, displaying a "No such file or directory" error. This suggests that the application either failed to restore its previous state or reinitialized the file upon restart. After a few requests, the counter started from a low value (e.g., 8, then 1), indicating possible data loss or reinitialization.


## Task 3: Headless Service Access

```bash
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs/k8s$ kubectl exec app-python-0 -- nslookup app-python-1.app-python.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10:53


Name:   app-python-1.app-python.default.svc.cluster.local
Address: 10.244.0.119
```

## Task 4: Monitoring & Alerts
- Liveness & Readiness Probes ensure pod health:

- Liveness Probe restarts unresponsive pods.
- Readiness Probe ensures pods are ready before receiving traffic.
- Why Important? Prevents data corruption and maintains system stability by only routing traffic to healthy pods.

## Task 5: Ordering & Parallel Operations
- Ordering Guarantees Unnecessary since:
- 
- Pods function independently.
- No strict dependencies exist.
- Parallel creation/termination is supported.
- Parallel Pod Management:
- Setting podManagementPolicy: Parallel in the StatefulSet allows faster scaling and deployment.


## Bonus Task: Update Strategies


```bash
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs/k8s$ kubectl get po,sts,svc,pvc
NAME                                        READY   STATUS    RESTARTS      AGE
pod/app-go-0                                1/1     Running   0             8s
pod/app-python-0                            1/1     Running   0             10m
pod/app-python-1                            1/1     Running   0             12m
pod/app-python-7d68cbfc76-6hqj2             1/1     Running   0             118m
pod/app-python-7d68cbfc76-nsv2h             1/1     Running   0             118m
pod/go-app-app-go-cbb68c5f-xhwmn            1/1     Running   0             173m
pod/vault-0                                 1/1     Running   4 (10h ago)   7d9h
pod/vault-agent-injector-66f45b5fd5-brht5   1/1     Running   4 (10h ago)   7d9h
pod/vault-test                              1/1     Running   4 (58m ago)   4h58m

NAME                          READY   AGE
statefulset.apps/app-go       1/1     8s
statefulset.apps/app-python   2/2     12m
statefulset.apps/vault        1/1     7d9h

NAME                               TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE
service/app-go                     ClusterIP   10.103.43.127   <none>        80/TCP              8s
service/app-python                 ClusterIP   10.111.51.54    <none>        8000/TCP            12m
service/go-app-app-go              ClusterIP   10.99.36.131    <none>        80/TCP              173m
service/kubernetes                 ClusterIP   10.96.0.1       <none>        443/TCP             12d
service/vault                      ClusterIP   10.111.114.30   <none>        8200/TCP,8201/TCP   7d9h
service/vault-agent-injector-svc   ClusterIP   10.98.209.177   <none>        443/TCP             7d9h
service/vault-internal             ClusterIP   None            <none>        8200/TCP,8201/TCP   7d9h

NAME                                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/app-go-pvc-app-go-0           Bound    pvc-2f1467bf-8f0b-49d9-bf91-594a3156954e   512Mi      RWO            standard       <unset>                 8s
persistentvolumeclaim/app-python-pvc-app-python-0   Bound    pvc-3923a0eb-0767-4c7b-af58-d28c0c92c0ff   512Mi      RWO            standard       <unset>                 12m
persistentvolumeclaim/app-python-pvc-app-python-1   Bound    pvc-691d38ac-78ee-4b0d-9e36-594a11e77e63   512Mi      RWO            standard       <unset>                 12m
saleem@saleem-MCLF-XX:~/Documents/DevOps/S25-core-course-labs/k8s$ 
```


- OnDelete: Updates occur only when pods are manually deleted, offering control but requiring intervention.

- RollingUpdate: Pods update gradually, reducing downtime. The partition field controls update order.

### Comparison with Deployment Strategies
- Recreate (Deployments): All pods stop before new ones start, causing downtime.

- RollingUpdate (Deployments): Pods update gradually, ensuring service continuity.

- StatefulSets: Require RollingUpdate to ensure ordered updates and data consistency.