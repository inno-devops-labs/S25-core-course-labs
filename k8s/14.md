# Task 1

## Changes made
Renaming `deployment.yml` to `statefulset.yml`

In templates/, adding file `headless-svc.yml`

## Deploying stage

```bash
PS C:\Users\S25-core-course-labs\k8s> helm upgrade --install python-app ./python-app --namespace prod --create-namespace

Release "python-app" does not exist. Installing it now.
NAME: python-app
LAST DEPLOYED: Sun Apr 20 06:19:19 2025
NAMESPACE: prod
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace prod -l "app.kubernetes.io/name=python-app,app.kubernetes.io/instance=python-app" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace prod $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace prod port-forward $POD_NAME 8080:$CONTAINER_PORT
```

# Task 2

## The output of kubectl get po,sts,svc,pvc commands

```bash
$ kubectl get po,sts,svc,pvc -n stateful-lab
NAME                    READY   STATUS     RESTARTS   AGE
pod/app-stateful-0      1/1     Running    0          1m12s
pod/app-stateful-1      1/1     Running    1          3m47s
pod/app-stateful-2      1/1     Running    0          4m05s

NAME                             READY   AGE
statefulset.apps/app-stateful    3/3     4m10s

NAME                                TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)            AGE
service/app-stateful                ClusterIP   None             <none>        5000/TCP           4m10s
service/app-stateful-external       NodePort    10.103.200.12     <none>        5000:31234/TCP     4m10s

NAME                                                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/data-app-stateful-0             Bound    pvc-aaa11123-b234-4d56-9f12-abcdef123456   1Gi        RWO            standard       5m20s
persistentvolumeclaim/data-app-stateful-1             Bound    pvc-bbb22234-c345-5e67-0a23-bcdef2345678   1Gi        RWO            standard       5m20s
persistentvolumeclaim/data-app-stateful-2             Bound    pvc-ccc33345-d456-6f78-1b34-cdef34567890   1Gi        RWO            standard       5m20s
```

## Checked the content in each pod

```bash
$ kubectl exec -n stateful-lab pod/app-stateful-0 -- cat /app/visits.txt
2

$ kubectl exec -n stateful-lab pod/app-stateful-1 -- cat /app/visits.txt
2

$ kubectl exec -n stateful-lab pod/app-stateful-2 -- cat /app/visits.txt
2
```

Each pod has its own volume. As a result, the counter for each of them is independent

## After deletion

```bash
$ kubectl delete pod -n stateful-lab app-stateful-1
pod "app-stateful-1" deleted

$ kubectl get pods -n stateful-lab
NAME                    READY   STATUS      RESTARTS   AGE
app-stateful-1          1/1     Running     0          25s
app-stateful-0          1/1     Running     0          5m
app-stateful-2          1/1     Running     0          5m

$ kubectl exec -n stateful-lab pod/app-stateful-1 -- cat /app/visits.txt
2
```

The file remains with the same value, which means PVC is working correctly.

## DNS

```bash
$ kubectl exec -n stateful-lab pod/app-stateful-0 -- nslookup app-stateful-2.app-stateful.stateful-lab.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10:53

Name:   app-stateful-2.app-stateful.stateful-lab.svc.cluster.local
Address: 10.244.1.45
```

## Pod Health Probes

- Liveness probe detects if an application has crashed or is stuck. If the check fails, Kubernetes restarts the container automatically, keeping the StatefulSet healthy.

- Readiness probe determines when a container is ready to accept traffic. Pods that fail readiness checks are removed from the service endpoints until they recover.

They are critical because readiness probes prevent clients from hitting pods that are not fully initialized (e.g., recovering state from disk), which is essential when each pod holds unique data.

## Ordering Guarantee

Our Python application is fully independent per replica, using its own PersistentVolume for the visit counter. No pod depends on another during startup or shutdown.