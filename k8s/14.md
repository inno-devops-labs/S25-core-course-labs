# Lab 14 Report: Kubernetes StatefulSet

## Task 1: Implement StatefulSet in Helm Chart

### Command Outputs
#### `kubectl get po,sts,svc,pvc` Output:
```
NAME                   READY   STATUS      RESTARTS   AGE
pod/app-python-0       1/1     Running     0          79s
pod/app-python-1       1/1     Running     0          79s
pod/app-python-2       1/1     Running     0          79s
pod/postinstall-hook   0/1     Completed   0          4m2s

NAME                          READY   AGE
statefulset.apps/app-python   3/3     79s

NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE
service/app-python   ClusterIP   10.97.137.179   <none>        5000/TCP   79s
service/kubernetes   ClusterIP   10.96.0.1       <none>        443/TCP    16m

NAME                                                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/app-python-pvc-app-python-0   Bound    pvc-8d829ea6-5814-4b26-8ef5-46fe46fc0b68   512Mi      RWO            standard       <unset>                 4m3s
persistentvolumeclaim/app-python-pvc-app-python-1   Bound    pvc-b3258e50-d945-4524-8ac2-2c7aee53cf23   512Mi      RWO            standard       <unset>                 4m3s
persistentvolumeclaim/app-python-pvc-app-python-2   Bound    pvc-4205bf8c-b567-4184-aa91-c015f9328dcd   512Mi      RWO            standard       <unset>                 4m3s
```

### Observations:
- **StatefulSet**: `app-python` has 3 replicas (`app-python-0`, `app-python-1`, `app-python-2`).
- **Services**: The `app-python` service is a ClusterIP (not headless).
- **PVCs**: Each pod has a dedicated PVC bound to a unique volume.
![](/screnshoots/lab14/1.png)

---

## Task 2: StatefulSet Exploration and Optimization

### 1. Persistent Storage Validation
#### Delete Pod `app-python-0`:
```bash
kubectl delete pod app-python-0 --force --grace-period=0
```
#### Verify PVC and Data Persistence:
```bash
kubectl get pvc
```
**Output (truncated for brevity):**
```
NAME                              STATUS   VOLUME                                     CAPACITY   ACCESS MODES
app-python-pvc-app-python-0       Bound    pvc-8d829ea6-5814-4b26-8ef5-46fe46fc0b68   512Mi      RWO
```
![](/screnshoots/lab14/3.png)

#### Data persists in recreated pod:
```bash
kubectl exec -it app-python-0 -- sh
```
```bash
 cat visits
```
![](/screnshoots/lab14/2.png)   
![](/screnshoots/lab14/5.png)
**Explanation:**
- Deleting the pod (`app-python-0`) forces Kubernetes to recreate it.
- The PVC associated with `app-python-0` retains the data, so the visit count (418) remains unchanged after recreation.

---

### 2. Headless Service Access
#### DNS Resolution:
```bash
kubectl exec app-python-0 -- sh
```
```bash
nslookup app-python-1.app-python
```
**Output:**
```
Server:		10.96.0.10
Address:	10.96.0.10:53

Name:	app-python-1.app-python.default.svc.cluster.local
Address: 10.244.0.40
```
![](/screnshoots/lab14/4.png)

**Explanation:**
Each pod in the StatefulSet is resolvable via a stable DNS name:
```
<pod-name>.<service-name>.<namespace>.svc.cluster.local
```
This demonstrates stable network identities, a key feature of StatefulSets.

---

### 3. Monitoring & Alerts (Liveness/Readiness Probes)
#### Probe Configuration (Added to StatefulSet):


#### Why Probes Matter:
- **Liveness Probes**: Detect and restart unhealthy pods (e.g., app crashes).
- **Readiness Probes**: Ensure pods only receive traffic when fully initialized (critical for stateful apps to avoid data corruption).

---

### 4. Ordering Guarantee & Parallel Operations
#### Why Ordering Isn’t Needed:
- This app (visit counter) doesn’t require strict startup/termination order because each pod operates independently with its own PVC.
- There’s no dependency between pods.

#### Implementing Parallel Pod Management:
```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: app-python
spec:
  podManagementPolicy: Parallel  # Override default OrderedReady
  replicas: 3
  ...
```
**Explanation:**
- `podManagementPolicy: Parallel` allows all pods to be launched/terminated simultaneously, improving scalability for stateless components.

---





