```
meowal@meowal-1-2:~/S25-core-course-labs$ helm install --dry-run --debug app-stateful /home/meowal/S25-core-course-labs/k8s/time-app/charts/my-chart
install.go:178: [debug] Original chart version: ""
install.go:195: [debug] CHART PATH: /home/meowal/S25-core-course-labs/k8s/time-app/charts/my-chart

NAME: app-stateful
LAST DEPLOYED: Sun Mar 16 18:14:36 2025
NAMESPACE: default
STATUS: pending-install
REVISION: 1
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
autoscaling:
  enabled: false
  maxReplicas: 5
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
container:
  image: myregistry/app:v1
  name: app
  port: 5000
ingress:
  annotations: {}
  className: nginx
  enabled: false
  hosts:
  - host: app-stateful.local
    paths:
    - path: /
      pathType: ImplementationSpecific
  tls: []
name: app-stateful
replicas: 3
service:
  name: app-stateful
  port: 80
  type: ClusterIP
serviceAccount:
  create: true
  name: app-service-account
storage:
  accessModes:
  - ReadWriteOnce
  size: 1Gi

HOOKS:
---
# Source: my-chart/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "app-stateful-my-chart-test-connection"
  labels:
    helm.sh/chart: my-chart-0.1.0
    app.kubernetes.io/name: my-chart
    app.kubernetes.io/instance: app-stateful
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['app-stateful-my-chart:80']
  restartPolicy: Never
MANIFEST:
---
# Source: my-chart/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: app-service-account
  labels:
    helm.sh/chart: my-chart-0.1.0
    app.kubernetes.io/name: my-chart
    app.kubernetes.io/instance: app-stateful
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
---
# Source: my-chart/templates/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-secret
type: Opaque
data:
  MY_PASS: Y2hlcm51c2hrYQ==
---
# Source: my-chart/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: app-stateful-my-chart
  labels:
    helm.sh/chart: my-chart-0.1.0
    app.kubernetes.io/name: my-chart
    app.kubernetes.io/instance: app-stateful
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - protocol: TCP
      port: 5000
      targetPort: 5000
  selector:
    app.kubernetes.io/name: my-chart
    app.kubernetes.io/instance: app-stateful
---
# Source: my-chart/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: app-stateful
spec:
  serviceName: app-stateful
  replicas: 3
  podManagementPolicy: Parallel
  selector:
    matchLabels:
      app: app-stateful
  template:
    metadata:
      labels:
        app: app-stateful
    spec:
      containers:
      - name: app
        image: myregistry/app:v1
        ports:
        - containerPort: 5000
        volumeMounts:
        - name: data
          mountPath: /data
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: 
      - ReadWriteOnce
      resources:
        requests:
          storage: 1Gi

NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=my-chart,app.kubernetes.io/instance=app-stateful" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
meowal@meowal-1-2:~/S25-core-course-labs$ 
```

```
meowal@meowal-1-2:~/S25-core-course-labs$ helm install my-release /home/meowal/S25-core-course-labs/k8s/time-app/charts/my-chart
NAME: my-release
LAST DEPLOYED: Sun Mar 16 18:16:00 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=my-chart,app.kubernetes.io/instance=my-release" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
meowal@meowal-1-2:~/S25-core-course-labs$ 
```

```
meowal@meowal-1-2:~/S25-core-course-labs/k8s$ helm install app-stateful /home/meowal/S25-core-course-labs/k8s/time-app/charts/my-chart -f /home/meowal/S25-core-course-labs/k8s/time-app/charts/my-chart/values.yaml
NAME: app-stateful
LAST DEPLOYED: Sun Mar 16 18:23:10 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=my-chart,app.kubernetes.io/instance=app-stateful" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
meowal@meowal-1-2:~/S25-core-course-labs/k8s$ 
```

```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl get po,sts,svc,pvc
NAME                 READY   STATUS      RESTARTS   AGE
pod/app-stateful-0   1/1     Running     0          3m23s
pod/app-stateful-1   1/1     Running     0          3m58s
pod/app-stateful-2   1/1     Running     0          4m34s
pod/dns-test         0/1     Completed   0          24h

NAME                            READY   AGE
statefulset.apps/app-stateful   3/3     83m

NAME                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)          AGE
service/app-stateful-my-chart     NodePort    10.108.224.170   <none>        5000:30001/TCP   143m
service/kubernetes                ClusterIP   10.96.0.1        <none>        443/TCP          9d
service/my-new-release-my-chart   ClusterIP   10.98.150.180    <none>        5000/TCP         149m
service/my-release-my-chart       ClusterIP   10.101.243.123   <none>        5000/TCP         157m
service/python-app-my-chart       ClusterIP   10.101.250.142   <none>        5000/TCP         24h
service/release-name-my-chart     NodePort    10.101.83.186    <none>        5000:30000/TCP   83m

NAME                                        STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/data-app-stateful-0   Bound    pvc-28918bcd-8f3c-4f0a-a969-334f0482bdd1   1Gi        RWO            standard       <unset>                 157m
persistentvolumeclaim/data-app-stateful-1   Bound    pvc-91e6464a-b2d2-4277-9a5b-a43eed9e0e8c   1Gi        RWO            standard       <unset>                 157m
persistentvolumeclaim/data-app-stateful-2   Bound    pvc-36267274-3467-4ece-b38d-8757da9b5215   1Gi        RWO            standard       <unset>                 157m
```

```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ minikube service app-stateful-my-chart
|-----------|-----------------------|-------------|---------------------------|
| NAMESPACE |         NAME          | TARGET PORT |            URL            |
|-----------|-----------------------|-------------|---------------------------|
| default   | app-stateful-my-chart |        5000 | http://192.168.49.2:30001 |
|-----------|-----------------------|-------------|---------------------------|
ðŸŽ‰  Opening service default/app-stateful-my-chart in default browser...
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ Gtk-Message: 20:55:07.534: Not loading module "atk-bridge": The functionality is provided by GTK natively. Please try to not load it.

```


```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl get pvc
NAME                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
data-app-stateful-0   Bound    pvc-28918bcd-8f3c-4f0a-a969-334f0482bdd1   1Gi        RWO            standard       <unset>                 4h23m
data-app-stateful-1   Bound    pvc-91e6464a-b2d2-4277-9a5b-a43eed9e0e8c   1Gi        RWO            standard       <unset>                 4h23m
data-app-stateful-2   Bound    pvc-36267274-3467-4ece-b38d-8757da9b5215   1Gi        RWO            standard       <unset>                 4h23m
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ 
```

```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl exec app-stateful-0 -- sh -c "echo 'Initial visit' > /data/visits"
kubectl exec app-stateful-0 -- cat /data/visits
Initial visit
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ 
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl exec app-stateful-1 -- sh -c "echo 'Initial visit' > /data/visits"
kubectl exec app-stateful-1 -- cat /data/visits
Initial visit
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ 
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl exec app-stateful-2 -- sh -c "echo 'Initial visit' > /data/visits"
kubectl exec app-stateful-2 -- cat /data/visits
Initial visit
```

Verify Data Persistence

before pod deletion:
```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl exec app-stateful-0 -- cat /data/visits
Initial visit
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ 
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl exec app-stateful-1 -- cat /data/visits
Initial visit
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl exec app-stateful-2 -- cat /data/visits
Initial visit
```
```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl delete pod app-stateful-0
pod "app-stateful-0" deleted
```

after pod deletion:
```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl get pvc
kubectl exec app-stateful-0 -- cat /data/visits
NAME                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
data-app-stateful-0   Bound    pvc-28918bcd-8f3c-4f0a-a969-334f0482bdd1   1Gi        RWO            standard       <unset>                 4h30m
data-app-stateful-1   Bound    pvc-91e6464a-b2d2-4277-9a5b-a43eed9e0e8c   1Gi        RWO            standard       <unset>                 4h30m
data-app-stateful-2   Bound    pvc-36267274-3467-4ece-b38d-8757da9b5215   1Gi        RWO            standard       <unset>                 4h30m
Initial visit
```


Explanation of Results:
StatefulSet and PVCs: Each pod in the StatefulSet (app-stateful-0, app-stateful-1, app-stateful-2) has its own PersistentVolumeClaim (PVC). This ensures that the data in /data is unique to each pod and persists even if the pod is deleted and recreated.

Data Persistence: The /data/visits file is stored on the PersistentVolume (PV) associated with each pod's PVC. When a pod is recreated, it reattaches to the same PVC, ensuring that the data in /data/visits is preserved.

Access pods via DNS:
```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/charts/my-chart$ kubectl exec app-stateful-0 -- nslookup app-stateful-1.app-stateful.default.svc.cluster.local
Server:		10.96.0.10
Address:	10.96.0.10:53


Name:	app-stateful-1.app-stateful.default.svc.cluster.local
Address: 10.244.0.114
```

How Probes Ensure Pod Health
Liveness Probe: Checks if the container is running and healthy. If the probe fails, Kubernetes restarts the container to recover from failures (e.g., crashes or unresponsiveness).

Readiness Probe: Ensures the container is ready to serve traffic. If the probe fails, the pod is marked as "Not Ready" and removed from service endpoints, preventing traffic from being sent to an unprepared pod.

Why Probes Are Critical for Stateful Apps
Stateful Applications (e.g., databases, message queues) often have complex startup and shutdown procedures. Probes ensure the application is fully initialized and ready before serving traffic.

Data Consistency: Probes prevent traffic from being sent to a pod that is still initializing or in an inconsistent state, reducing the risk of data corruption.

High Availability: Probes detect and recover from runtime failures, ensuring the application remains available and responsive.

Ordering Guarantee and Parallel Operations
Why Ordering Guarantees Are Unnecessary for Your App:

Your app (msk-time-app) is stateless and does not rely on a specific startup or shutdown sequence.

Each pod operates independently, and there is no dependency between pods (e.g., no leader election or shared state).

Parallel pod management (podManagementPolicy: Parallel) is sufficient, as the app does not require sequential initialization or termination.


