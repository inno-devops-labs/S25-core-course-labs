## StatefulSet Exploration and Optimization

```bash
> kubectl get po,sts,svc,pvc
```
```bash
NAME                                         READY   STATUS    RESTARTS       AGE
pod/app-python-0                             1/1     Running   0              30s
pod/app-python-1                             1/1     Running   0              30s
pod/helm-hooks-app-python-5b7575787d-8k97x   1/1     Running   4 (3m3s ago)   2d22h
pod/python-app-app-python-67f77f58f8-hj279   1/1     Running   2 (3m3s ago)   7h51m
pod/python-app-app-python-67f77f58f8-q5l6z   1/1     Running   2 (3m3s ago)   7h51m

NAME                          READY   AGE
statefulset.apps/app-python   2/2     30s

NAME                            TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)    AGE
service/app-python              ClusterIP   10.98.41.101     <none>        5000/TCP   30s
service/helm-hooks-app-python   ClusterIP   10.102.161.156   <none>        5000/TCP   14d
service/kubernetes              ClusterIP   10.96.0.1        <none>        443/TCP    14d
service/python-app-app-python   ClusterIP   10.103.20.160    <none>        5000/TCP   28h

NAME                                                 STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/app-python-data-app-python-0   Bound    pvc-ef4064c4-3d80-4a72-9f5c-28e597a8ffa1   1Gi        RWO            standard       <unset>                 30s
persistentvolumeclaim/app-python-data-app-python-1   Bound    pvc-91bf9a46-18d4-40cc-9215-66e0a984e720   1Gi        RWO            standard       <unset>                 30s
```

```bash
> kubectl exec pod/app-python-0 -- cat visits/visits.txt
```
```bash
16
```
```bash
> kubectl exec pod/app-python-1 -- cat visits/visits.txt
```
```bash
20
```

The values vary because each pod uses its own persistent volume to store its visits file, and these volumes aren't 
synchronized with one another. Therefore, app-python-0 and app-python-1 each track their own counter independently, 
resulting in different numbers.

```bash
> kubectl delete pod app-python-0
```
```bash
pod "app-python-0" deleted
```

```bash
> kubectl get pvc
```
```bash
NAME                           STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
app-python-data-app-python-0   Bound    pvc-ef4064c4-3d80-4a72-9f5c-28e597a8ffa1   1Gi        RWO            standard       <unset>                 23m
app-python-data-app-python-1   Bound    pvc-91bf9a46-18d4-40cc-9215-66e0a984e720   1Gi        RWO            standard       <unset>                 23m
```

```bash
> kubectl exec pod/app-python-0 -- cat visits/visits.txt
```
```bash
16
```

### Headless Service Access

```bash
> kubectl apply -f https://k8s.io/examples/admin/dns/dnsutils.yaml
pod/dnsutils created
```
```bash

> kubectl get pods dnsutils
NAME       READY   STATUS    RESTARTS   AGE
dnsutils   1/1     Running   0          90s
```
```bash
> kubectl exec -i -t dnsutils -- nslookup app-python-0.app-python.default.svc.cluster.local
```
```bash
Server:         10.96.0.10
Address:        10.96.0.10#53

Name:   app-python-0.app-python.default.svc.cluster.local
Address: 10.244.0.220
```
```bash
> kubectl exec -i -t dnsutils -- nslookup app-python-1.app-python.default.svc.cluster.local
```
```bash
Server:         10.96.0.10
Address:        10.96.0.10#53

Name:   app-python-1.app-python.default.svc.cluster.local
Address: 10.244.0.218
```

## How probes ensure pod health

Both probes send an `HTTP GET` request to the application's `/` endpoint to check if it is alive.
If they donâ€™t receive an OK response:
- **Liveness Probe:** Kubernetes restarts the pod automatically.
- **Readiness Probe:** The pod is temporarily removed from the service until it becomes ready again.

## Why probes are critical for stateful applications

- Probes ensure that pods only serve traffic when they are capable of properly managing their state.
- Readiness probes make sure that operations like scaling and updates occur only when the pods are genuinely ready.

## Ordering Guarantee and Parallel Operations

### Why ordering guarantees are unnecessary for my application

- Each pod has its own independent visit counter, there is no data dependency between them.
- There is no hierarchical relationship between the pods, and the readiness of one pod does not depend on another.