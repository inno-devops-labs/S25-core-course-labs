# Kubernetes StatefulSet

## Task 1

```bash
ubuntu@fhmhd8tturtcnb6bcjnt:~/S25-DevOps-labs/k8s/python-app$ helm install python-app . --dry-run --debug
install.go:225: 2025-03-16 20:46:47.947135919 +0000 UTC m=+0.042637162 [debug] Original chart version: ""
install.go:242: 2025-03-16 20:46:47.947201817 +0000 UTC m=+0.042703040 [debug] CHART PATH: /home/ubuntu/S25-DevOps-labs/k8s/python-app

NAME: python-app
LAST DEPLOYED: Sun Mar 16 20:46:47 2025
NAMESPACE: default
STATUS: pending-install
REVISION: 1
USER-SUPPLIED VALUES:
{}

COMPUTED VALUES:
affinity: {}
autoscaling:
  enabled: false
  maxReplicas: 100
  minReplicas: 1
  targetCPUUtilizationPercentage: 80
fullnameOverride: ""
image:
  pullPolicy: IfNotPresent
  repository: jodak628286/python_app
  tag: latest
imagePullSecrets: []
ingress:
  annotations: {}
  className: ""
  enabled: false
  hosts:
  - host: chart-example.local
    paths:
    - path: /
      pathType: ImplementationSpecific
  tls: []
livenessProbe:
  httpGet:
    path: /
    port: http
nameOverride: ""
nodeSelector: {}
persistence:
  size: 124Mi
podAnnotations: {}
podLabels: {}
podSecurityContext: {}
readinessProbe:
  httpGet:
    path: /
    port: http
replicaCount: 3
resources:
  limits:
    cpu: 100m
    memory: 128Mi
  requests:
    cpu: 100m
    memory: 128Mi
secrets:
  Password: toor
  User: root
securityContext: {}
service:
  port: 8080
  type: LoadBalancer
serviceAccount:
  annotations: {}
  automount: true
  create: true
  name: internal-app
tolerations: []
vault:
  annotations:
    vault.hashicorp.com/agent-inject: "true"
    vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/database/config
    vault.hashicorp.com/agent-inject-status: update
    vault.hashicorp.com/agent-inject-template-database-config.txt: |
      {{- with secret "internal/data/database/config" -}}
      export DB_USERNAME="{{ .Data.data.username }}"
      export DB_PASSWORD="{{ .Data.data.password }}"
      {{- end -}}
    vault.hashicorp.com/role: internal-app
  enabled: false
volumeMounts:
- mountPath: /app
  name: data
- mountPath: /config.json
  name: config-volume
  subPath: config.json
volumes:
- configMap:
    name: test-config
  name: config-volume

HOOKS:
---
# Source: python-app/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "python-app-test-connection"
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ['wget']
      args: ['python-app:8080']
  restartPolicy: Never
MANIFEST:
---
# Source: python-app/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: python-app-internal-app
  namespace: default
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    meta.helm.sh/release-name: python-app
    meta.helm.sh/release-namespace: default
automountServiceAccountToken: true
---
# Source: python-app/templates/secrets.yaml
apiVersion: v1
kind: Secret
metadata:
  name: secrets
  annotations:
    "meta.helm.sh/release-name": "python-app"
    "meta.helm.sh/release-namespace": "default"
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
type: Opaque
data:
  USER: cm9vdA==
  PASSWORD: dG9vcg==
---
# Source: python-app/templates/configmap.yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: test-config
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
data:
  config.json: |
    {
      "app_name": "Python Counter App",
      "version": "1.0.0",
      "visits_file_path": "/app/visits",
      "server": {
        "host": "0.0.0.0",
        "port": 8080
      }
    }
---
# Source: python-app/templates/service.yaml
apiVersion: v1
kind: Service
metadata:
  name: python-app
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: LoadBalancer
  ports:
    - port: 8080
      targetPort: http
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: python-app
---
# Source: python-app/templates/statefulset.yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: python-app
  labels:
    helm.sh/chart: python-app-0.1.0
    app.kubernetes.io/name: python-app
    app.kubernetes.io/instance: python-app
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  serviceName: python-app
  replicas: 3
  selector:
    matchLabels:
      app.kubernetes.io/name: python-app
      app.kubernetes.io/instance: python-app
  template:
    metadata:
      labels:
        helm.sh/chart: python-app-0.1.0
        app.kubernetes.io/name: python-app
        app.kubernetes.io/instance: python-app
        app.kubernetes.io/version: "1.16.0"
        app.kubernetes.io/managed-by: Helm
    spec:
      serviceAccountName: python-app-internal-app
      containers:
        - name: python-app
          image: "jodak628286/python_app:latest"
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
          livenessProbe:
            httpGet:
              path: /
              port: http
          readinessProbe:
            httpGet:
              path: /
              port: http
          resources:
            limits:
              cpu: 100m
              memory: 128Mi
            requests:
              cpu: 100m
              memory: 128Mi
          volumeMounts:
            - mountPath: /data
              name: data
            - mountPath: /config.json
              name: config-volume
              subPath: config.json
          env:
            - name: USER
              valueFrom:
                secretKeyRef:
                  name: secrets
                  key: USER
            - name: PASSWORD
              valueFrom:
                secretKeyRef:
                  name: secrets
                  key: PASSWORD
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
      volumes:
        - configMap:
            name: test-config
          name: config-volume
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      storageClassName: "standard"
      resources:
        requests:
          storage: 1Gi

NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch its status by running 'kubectl get --namespace default svc -w python-app'
  export SERVICE_IP=$(kubectl get svc --namespace default python-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8080

ubuntu@fhmhd8tturtcnb6bcjnt:~/S25-DevOps-labs/k8s/python-app$ helm install python-app .
NAME: python-app
LAST DEPLOYED: Sun Mar 16 20:46:52 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch its status by running 'kubectl get --namespace default svc -w python-app'
  export SERVICE_IP=$(kubectl get svc --namespace default python-app --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8080
  ```
