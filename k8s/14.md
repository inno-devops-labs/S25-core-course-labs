# Kubernetes StatefulSet

## Task 1

Done in the project files.

## Task 2

### Research

```bash
❯ kubectl get po,sts,svc,pvc
NAME                                        READY   STATUS    RESTARTS      AGE
pod/app-javascript-dbf5cd648-jsk66          1/1     Running   0             42m
pod/app-javascript-dbf5cd648-nd8qb          1/1     Running   0             42m
pod/app-javascript-dbf5cd648-zmxfk          1/1     Running   0             42m
pod/app-python-0                            1/1     Running   0             37s
pod/app-python-1                            1/1     Running   0             23s
pod/vault-0                                 1/1     Running   6 (54m ago)   7d2h
pod/vault-agent-injector-66f45b5fd5-kdlvj   1/1     Running   6 (54m ago)   7d2h

NAME                          READY   AGE
statefulset.apps/app-python   2/2     37s
statefulset.apps/vault        1/1     7d2h

NAME                               TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)             AGE
service/app-javascript             ClusterIP      10.100.225.50   <none>        3000/TCP            42m
service/app-python                 LoadBalancer   10.110.138.46   <pending>     8000:30626/TCP      37s
service/kubernetes                 ClusterIP      10.96.0.1       <none>        443/TCP             18d
service/vault                      ClusterIP      10.98.236.213   <none>        8200/TCP,8201/TCP   7d2h
service/vault-agent-injector-svc   ClusterIP      10.96.115.38    <none>        443/TCP             7d2h
service/vault-internal             ClusterIP      None            <none>        8200/TCP,8201/TCP   7d2h

NAME                                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/data-app-python-0   Bound    pvc-e4d88241-9f46-4237-bcf2-6da624691291   1Gi        RWO            standard       <unset>                 37s
persistentvolumeclaim/data-app-python-1   Bound    pvc-a54b392b-32bf-4d7d-9650-f0139550c7e6   1Gi        RWO            standard       <unset>                 23s
```

```bash
❯ kubectl exec pod/app-python-0 -- cat /app/data/visits.txt
5
❯ kubectl exec pod/app-python-1 -- cat /app/data/visits.txt
0
```

### Persistant Storage

```bash
❯ kubectl delete pod/app-python-0
pod "app-python-0" deleted
❯ kubectl get pvc
NAME                STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
data-app-python-0   Bound    pvc-e4d88241-9f46-4237-bcf2-6da624691291   1Gi        RWO            standard       <unset>                 23m
data-app-python-1   Bound    pvc-a54b392b-32bf-4d7d-9650-f0139550c7e6   1Gi        RWO            standard       <unset>                 23m
❯ kubectl exec pod/app-python-0 -- cat /app/data/visits.txt
5
```

### Headless Service Access

```bash
❯ kubectl exec pod/app-python-0 -- nslookup app-python-0.app-python.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10:53


Name:   app-python-0.app-python.default.svc.cluster.local
Address: 10.244.1.33

❯ kubectl exec pod/app-python-1 -- nslookup app-python-1.app-python.default.svc.cluster.local
Server:         10.96.0.10
Address:        10.96.0.10:53


Name:   app-python-1.app-python.default.svc.cluster.local
Address: 10.244.1.34
```

### Monitoring & Alerts

The liveness/readiness probes already included in both apps. They are important because they help Kubernetes detect and manage pod health, ensuring unresponsive pods are restarted (liveness) and only healthy pods receive traffic (readiness).

### Ordering Guarantee and Parallel Operations

Ordering guarantees are unnecessary for my apps because they don’t rely on sequential pod startup or shutdown, such as for leader election or data replication, allowing all pods to operate independently. To instruct the StatefulSet controller to launch or terminate all pods in parallel, setting `podManagementPolicy: Parallel` in `statefulset.yaml` will do.

## Bonus Task

### Updating the javascript application

Here is the deployment after modifying the javascript app as well:

```bash
❯ kubectl get po,sts,svc,pvc
NAME                                        READY   STATUS    RESTARTS       AGE
pod/app-javascript-0                        1/1     Running   0              35s
pod/app-javascript-1                        1/1     Running   0              32s
pod/app-javascript-2                        1/1     Running   0              28s
pod/app-python-0                            1/1     Running   0              25m
pod/app-python-1                            1/1     Running   0              25m
pod/vault-0                                 1/1     Running   6 (115m ago)   7d3h
pod/vault-agent-injector-66f45b5fd5-kdlvj   1/1     Running   6 (115m ago)   7d3h

NAME                              READY   AGE
statefulset.apps/app-javascript   3/3     35s
statefulset.apps/app-python       2/2     25m
statefulset.apps/vault            1/1     7d3h

NAME                               TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
service/app-javascript             ClusterIP      10.101.82.77     <none>        3000/TCP            35s
service/app-python                 LoadBalancer   10.103.132.191   <pending>     8000:32022/TCP      25m
service/kubernetes                 ClusterIP      10.96.0.1        <none>        443/TCP             18d
service/vault                      ClusterIP      10.98.236.213    <none>        8200/TCP,8201/TCP   7d3h
service/vault-agent-injector-svc   ClusterIP      10.96.115.38     <none>        443/TCP             7d3h
service/vault-internal             ClusterIP      None             <none>        8200/TCP,8201/TCP   7d3h

NAME                                          STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/data-app-javascript-0   Bound    pvc-b7eaba69-a865-4687-97b3-4c1fe26af897   1Gi        RWO            standard       <unset>                 35s
persistentvolumeclaim/data-app-javascript-1   Bound    pvc-d14b7f4a-693f-4a6c-9359-0ac57ef37c4c   1Gi        RWO            standard       <unset>                 32s
persistentvolumeclaim/data-app-javascript-2   Bound    pvc-1a32cba3-838e-47e6-bed0-648452d041d8   1Gi        RWO            standard       <unset>                 28s
persistentvolumeclaim/data-app-python-0       Bound    pvc-e4d88241-9f46-4237-bcf2-6da624691291   1Gi        RWO            standard       <unset>                 62m
persistentvolumeclaim/data-app-python-1       Bound    pvc-a54b392b-32bf-4d7d-9650-f0139550c7e6   1Gi        RWO            standard       <unset>                 61
```

### Update strategies

In a StatefulSet, OnDelete requires manual pod deletion to apply updates in order, ideal for stateful apps like databases needing controlled migrations, while RollingUpdate automatically updates pods in reverse order (optionally with a partition), suited for minimizing downtime in replicated stateful systems. Deployment’s RollingUpdate (default) updates stateless pods gradually without order, perfect for web servers, and Recreate kills all pods before recreating them, useful for stateless apps requiring version isolation. StatefulSet strategies prioritize pod identity and sequence for stateful needs, unlike Deployment’s focus on stateless flexibility and automation.


