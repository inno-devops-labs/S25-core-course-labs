# Statefulsets

## Listing resources

```bash
➜  ~ kubectl get po,sts,svc,pvc
NAME           READY   STATUS    RESTARTS   AGE
pod/dnsutils   1/1     Running   0          22m
pod/py-app-0   1/1     Running   0          3m32s
pod/py-app-1   1/1     Running   0          3m31s
pod/py-app-2   1/1     Running   0          3m30s

NAME                      READY   AGE
statefulset.apps/py-app   3/3     3m32s

NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE
service/kubernetes   ClusterIP   10.96.0.1      <none>        443/TCP    29m
service/py-app       ClusterIP   10.96.48.233   <none>        8000/TCP   3m32s

NAME                                        STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS       VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/py-app-pvc-py-app-0   Bound    my-pv     500Mi      RWO            my-storage-class   <unset>                 26m
persistentvolumeclaim/py-app-pvc-py-app-1   Bound    my-pv-1   500Mi      RWO            my-storage-class   <unset>                 8m10s
persistentvolumeclaim/py-app-pvc-py-app-2   Bound    my-pv-2   500Mi      RWO            my-storage-class   <unset>                 5m8s
```

## Content of visits

```bash
➜  ~ k exec py-app-0 -- cat visits
19%
➜  ~ k exec py-app-1 -- cat visits
cat: visits: No such file or directory
command terminated with exit code 1
➜  ~ k exec py-app-2 -- cat visits
cat: visits: No such file or directory
command terminated with exit code 1
```

Only first pod has visits since all traffic goes to it because of headless service.

## Pod deletion

```bash
➜  ~ k delete po py-app-0
pod "py-app-0" deleted
➜  ~ k get pvc
NAME                  STATUS   VOLUME    CAPACITY   ACCESS MODES   STORAGECLASS       VOLUMEATTRIBUTESCLASS   AGE
py-app-pvc-py-app-0   Bound    my-pv     100Mi      RWO            my-storage-class   <unset>                 30m
py-app-pvc-py-app-1   Bound    my-pv-1   500Mi      RWO            my-storage-class   <unset>                 12m
py-app-pvc-py-app-2   Bound    my-pv-2   500Mi      RWO            my-storage-class   <unset>                 9m7s
➜  ~ k exec py-app-0 -- cat visits
19%
```

## DNS lookups

```bash
➜  ~ k exec dnsutils -- nslookup py-app-0.py-app
Server:		10.96.0.10
Address:	10.96.0.10#53

Name:	py-app-0.py-app.default.svc.cluster.local
Address: 10.244.0.40

➜  ~ k exec dnsutils -- nslookup py-app-1.py-app
Server:		10.96.0.10
Address:	10.96.0.10#53

Name:	py-app-1.py-app.default.svc.cluster.local
Address: 10.244.0.38

➜  ~ k exec dnsutils -- nslookup py-app-2.py-app
Server:		10.96.0.10
Address:	10.96.0.10#53

Name:	py-app-2.py-app.default.svc.cluster.local
Address: 10.244.0.39
```
