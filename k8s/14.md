# Lab 14: Kubernetes StatefulSet Report

## Task 1: Implement StatefulSet in Helm Chart

I have rewritten codes of values.yaml and statefulset.yaml.
### StatefulSet Deployment Output
```bash
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:30]
‚îî‚îÄ[$] <git:(lab14*)> helm install app-python ./app-python
NAME: app-python
LAST DEPLOYED: Sun Mar 16 23:30:13 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=app-python,app.kubernetes.io/instance=app-python" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
```
---

## Task 2: StatefulSet Exploration and Optimization

### Kubernetes Resource Status
```bash
kubectl get po,sts,svc,pvc
```
```
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:30]
‚îî‚îÄ[$] <git:(lab14*)> kubectl get po,sts,svc,pvc                                               

NAME                                         READY   STATUS    RESTARTS      AGE
pod/app-python-0                             1/1     Running   0             40s
pod/app-python-1                             1/1     Running   0             36s

NAME                          READY   AGE
statefulset.apps/app-python   2/2     40s

NAME                     TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)          AGE
service/app-javascript   NodePort    10.96.103.17   <none>        4000:31726/TCP   28h
service/app-python       ClusterIP   10.104.210.6   <none>        80/TCP           40s
service/kubernetes       ClusterIP   10.96.0.1      <none>        443/TCP          9d

NAME                               STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/visits-pvc   Bound    pvc-5d3ca093-4a26-483b-825c-0def54de9e95   1Gi        RWO            standard       <unset>                 7d4h
```

### Application Access
```bash
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:31]
‚îî‚îÄ[$] <git:(lab14*)> minikube service app-python                                              
|-----------|------------|-------------|--------------|
| NAMESPACE |    NAME    | TARGET PORT |     URL      |
|-----------|------------|-------------|--------------|
| default   | app-python |             | No node port |
|-----------|------------|-------------|--------------|
üòø  service default/app-python has no node port
‚ùó  Services [default/app-python] have type "ClusterIP" not meant to be exposed, however for local development minikube allows you to access this !
üèÉ  Starting tunnel for service app-python.
|-----------|------------|-------------|------------------------|
| NAMESPACE |    NAME    | TARGET PORT |          URL           |
|-----------|------------|-------------|------------------------|
| default   | app-python |             | http://127.0.0.1:61971 |
|-----------|------------|-------------|------------------------|
üéâ  Opening service default/app-python in default browser...
```

### File Content Check in Each Pod
```bash
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:33]
‚îî‚îÄ[$] <git:(lab14*)> kubectl exec app-python-0 -- cat /visits    
103
> kubectl exec app-python-0 -- cat /visits
98
```

### Persistent Storage Validation
```bash
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:35]
‚îî‚îÄ[$] <git:(lab14*)> kubectl delete pod app-python-0  
pod "app-python-0" deleted
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:36]
‚îî‚îÄ[$] <git:(lab14*)> kubectl exec app-stateful-0 -- cat /data/visits
115
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:35]
‚îî‚îÄ[$] <git:(lab14*)> kubectl get pvc

NAME         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
visits-pvc   Bound    pvc-5d3ca093-4a26-483b-825c-0def54de9e95   1Gi        RWO            standard       <unset>                 10m
kubectl exec app-stateful-0 -- cat /data/visits
```

### Headless Service Access
```bash
kubectl exec app-python-0 -- nslookup app-python-1.app-python
```
```
(base) ‚îå‚îÄ[renatalatypova@MacBook-Pro-Renata] - [~/PycharmProjects/S25-core-course-labs/k8s] - [Sun Mar 16, 23:49]
‚îî‚îÄ[$] <git:(lab14*)> kubectl exec app-python-0 -- nslookup app-python-1.app-python
Server:         10.96.0.10
Address:        10.96.0.10:53


Name:   app-python-1.app-python.default.svc.cluster.local
Address: 10.244.1.3
```

### Liveness and Readiness Probes
```yaml
livenessProbe:
  httpGet:
    path: /
    port: 80
  initialDelaySeconds: 3
  periodSeconds: 10

readinessProbe:
  httpGet:
    path: /
    port: 80
  initialDelaySeconds: 3
  periodSeconds: 10
```

**Probes Explanation:**
- Liveness probes ensure the pod is restarted if it becomes unresponsive.
- Readiness probes ensure traffic is only sent to healthy pods.

### Parallel Pod Management
```yaml
spec:
  podManagementPolicy: Parallel
```

---

## Bonus Task: Update Strategies

### Rolling Update Strategy Implementation
```yaml
spec:
  updateStrategy:
    type: RollingUpdate
    rollingUpdate:
      partition: 1
```

### Update Strategy Comparison
- **OnDelete**: Pods are only updated when manually deleted.
- **RollingUpdate**: Pods update gradually, ensuring availability.
- **Deployment vs StatefulSet Updates**: Deployments prioritize stateless applications, while StatefulSets preserve pod identity and storage.

