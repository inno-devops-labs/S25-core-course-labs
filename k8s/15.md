# Kubernetes Monitoring with Kube Prometheus Stack

## Kube Prometheus Stack Components

### Prometheus Operator
Manages Prometheus instances declaratively using CRDs. Simplifies deployment, configuration, and lifecycle management.

### Prometheus
A time-series database that scrapes and stores metrics. Used for querying system/app metrics and evaluating alerting rules.

### Alertmanager
Receives alerts from Prometheus and handles deduplication, silencing, and routing (e.g., email, Slack).

### Grafana
Dashboards for visualizing metrics stored in Prometheus. Allows creating custom views for nodes, pods, and applications.

### Node Exporter
Runs on each node to expose OS-level and hardware metrics like CPU, memory, disk I/O, etc.

### Kube State Metrics
Exposes metrics about the state of Kubernetes objects (e.g., Pods, Deployments, Nodes).

### Custom Resource Definitions (CRDs)
Defines Kubernetes-native configurations for managing Prometheus, Alertmanager, ServiceMonitors, etc.

### ServiceMonitors & PodMonitors
Custom resources that tell Prometheus which endpoints to scrape for metrics.

## Cluster Resources Overview

### `kubectl get po` - Active Pods
Lists running pods from monitoring stack and app deployments:

```
NAME                                                         READY   STATUS    RESTARTS       AGE
pod/alertmanager-monitoring-kube-prometheus-alertmanager-0   2/2     Running   0              42s
pod/app-my-app-0                                             1/1     Running   1              12d
pod/app-my-app-1                                             1/1     Running   1              12d
pod/app-my-app-2                                             1/1     Running   1              12d
pod/monitoring-grafana-8df5cd697-8p8lz                       3/3     Running   0              64s
pod/monitoring-kube-prometheus-operator-56d9c87df7-l7pl7     1/1     Running   0              64s
pod/monitoring-kube-state-metrics-5c4748cd88-v6kk9           1/1     Running   0              64s
pod/monitoring-prometheus-node-exporter-2plz8                1/1     Running   0              64s
pod/prometheus-monitoring-kube-prometheus-prometheus-0       1/2     Running   0              42s
pod/python-app-my-app-89777cfc5-jbv7h                        0/1     Running   54 (16s ago)   12d
```

### `kubectl get sts` - StatefulSets
Shows persistent application and monitoring components:

```
NAME                                                                    READY   AGE
statefulset.apps/alertmanager-monitoring-kube-prometheus-alertmanager   1/1     42s
statefulset.apps/app-my-app                                             3/3     12d
statefulset.apps/prometheus-monitoring-kube-prometheus-prometheus       0/1     42s
```

### `kubectl get svc` - Services
Internal services for exposing Prometheus, Grafana, Alertmanager, and app endpoints:

```
NAME                                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP   42s
service/app-my-app                                ClusterIP   10.106.118.233   <none>        80/TCP                       12d
service/app-my-app-headless                       ClusterIP   None             <none>        80/TCP                       12d
service/kubernetes                                ClusterIP   10.96.0.1        <none>        443/TCP                      26d
service/monitoring-grafana                        ClusterIP   10.96.107.144    <none>        80/TCP                       64s
service/monitoring-kube-prometheus-alertmanager   ClusterIP   10.108.39.158    <none>        9093/TCP,8080/TCP            64s
service/monitoring-kube-prometheus-operator       ClusterIP   10.102.214.105   <none>        443/TCP                      64s
service/monitoring-kube-prometheus-prometheus     ClusterIP   10.99.220.229    <none>        9090/TCP,8080/TCP            64s
service/monitoring-kube-state-metrics             ClusterIP   10.104.142.158   <none>        8080/TCP                     64s
service/monitoring-prometheus-node-exporter       ClusterIP   10.108.68.185    <none>        9100/TCP                     64s
service/prometheus-operated                       ClusterIP   None             <none>        9090/TCP                     42s
service/python-app-my-app                         ClusterIP   10.109.53.228    <none>        80/TCP                       13d
```

### `kubectl get pvc` - Persistent Volumes
Lists PVCs used by StatefulSets (e.g., `app-my-app`):

```NAME                                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/data-app-my-app-0   Bound    pvc-58c0ff82-90f6-4ca2-b803-a82ac6b6c92a   1Gi        RWO            standard       <unset>                 12d
persistentvolumeclaim/data-app-my-app-1   Bound    pvc-4bf57afa-90bd-4ab6-9d9f-1582a7a4631c   1Gi        RWO            standard       <unset>                 12d
persistentvolumeclaim/data-app-my-app-2   Bound    pvc-329515f5-b650-4922-93b9-affa77dade68   1Gi        RWO            standard       <unset>                 12d
```

### `kubectl get cm` - ConfigMaps
Includes dashboard configs, alert rules, Prometheus configs, etc.:

```
NAME                                                                     DATA   AGE
configmap/kube-root-ca.crt                                               1      26d
configmap/monitoring-grafana                                             1      65s
configmap/monitoring-grafana-config-dashboards                           1      65s
configmap/monitoring-kube-prometheus-alertmanager-overview               1      65s
configmap/monitoring-kube-prometheus-apiserver                           1      65s
configmap/monitoring-kube-prometheus-cluster-total                       1      65s
configmap/monitoring-kube-prometheus-controller-manager                  1      65s
configmap/monitoring-kube-prometheus-etcd                                1      65s
configmap/monitoring-kube-prometheus-grafana-datasource                  1      65s
configmap/monitoring-kube-prometheus-grafana-overview                    1      65s
configmap/monitoring-kube-prometheus-k8s-coredns                         1      65s
configmap/monitoring-kube-prometheus-k8s-resources-cluster               1      65s
configmap/monitoring-kube-prometheus-k8s-resources-multicluster          1      65s
configmap/monitoring-kube-prometheus-k8s-resources-namespace             1      65s
configmap/monitoring-kube-prometheus-k8s-resources-node                  1      65s
configmap/monitoring-kube-prometheus-k8s-resources-pod                   1      65s
configmap/monitoring-kube-prometheus-k8s-resources-workload              1      65s
configmap/monitoring-kube-prometheus-k8s-resources-workloads-namespace   1      65s
configmap/monitoring-kube-prometheus-kubelet                             1      65s
configmap/monitoring-kube-prometheus-namespace-by-pod                    1      65s
configmap/monitoring-kube-prometheus-namespace-by-workload               1      65s
configmap/monitoring-kube-prometheus-node-cluster-rsrc-use               1      65s
configmap/monitoring-kube-prometheus-node-rsrc-use                       1      65s
configmap/monitoring-kube-prometheus-nodes                               1      65s
configmap/monitoring-kube-prometheus-nodes-darwin                        1      65s
configmap/monitoring-kube-prometheus-persistentvolumesusage              1      65s
configmap/monitoring-kube-prometheus-pod-total                           1      65s
configmap/monitoring-kube-prometheus-prometheus                          1      65s
configmap/monitoring-kube-prometheus-proxy                               1      65s
configmap/monitoring-kube-prometheus-scheduler                           1      65s
configmap/monitoring-kube-prometheus-workload-total                      1      65s
configmap/my-app-config                                                  1      17d
configmap/prometheus-monitoring-kube-prometheus-prometheus-rulefiles-0   35     42s
```

## Grafana Dashboard Insights

1. **StatefulSet CPU & Memory Usage:**

This Grafana dashboard visualizes CPU usage across all namespaces. The `default` namespace—where the StatefulSet `app-my-app` is running—shows moderate, consistent CPU usage. The `kube-system` namespace has the highest overall usage, as expected from core system components. This confirms that the `app-my-app` StatefulSet is running efficiently without CPU spikes.

   ![Screenshot From 2025-03-23 10-55-47](https://github.com/user-attachments/assets/f66f9179-6af5-42f8-94cd-95540f7b57f6)

2. **Pods with Highest/Lowest CPU:**

This graph shows CPU usage by individual Pods in the `default` namespace. The Pod with the highest sustained CPU usage is `argo-argocd-notifications-controller`, while Pods like `argo-argocd-dex-server` and `argo-argocd-application-controller` use significantly less CPU. The chart provides clear visibility into resource distribution within the namespace, helping identify potential performance bottlenecks.

    ![Screenshot From 2025-03-23 10-58-38](https://github.com/user-attachments/assets/6091c5ae-062f-429e-bc7e-8b855a5b94a5)

3. **Node Memory Usage:**

This chart displays the memory usage (Working Set Size - WSS) of the `application-controller` pod over time. The usage stays fairly consistent between **95 MiB and 135 MiB**, indicating stable memory consumption. This data is useful for confirming that node memory usage is within expected limits and there are no memory leaks or spikes.

   ![Screenshot From 2025-03-23 11-00-34](https://github.com/user-attachments/assets/1f9c00d9-caef-4869-83d8-1beb50e373d8)

4. **Total Pods & Containers Managed by Kubelet:**

This Grafana panel provides a summary of the resources managed by the Kubelet on the node. It shows:
- **1 running Kubelet**
- **31 running Pods**
- **42 running Containers**

   ![Screenshot From 2025-03-23 11-01-36](https://github.com/user-attachments/assets/c4922144-0915-4626-a50d-e9e4cfe111da)

5. **Pod Network Usage:**

This dashboard shows the rate of received and transmitted packets per second for Pods in the `default` namespace. Key system components such as `coredns`, `kube-apiserver`, and `etcd` display consistent network activity, with `coredns` leading both in incoming and outgoing packet rates. The data indicates healthy communication between Kubernetes components within the default namespace.

   ![Screenshot From 2025-03-23 11-04-00](https://github.com/user-attachments/assets/1813b902-de54-44eb-bde3-8757f1724d0a)

6. **Active Alerts:**

This panel shows the number of active alerts over time. At peak, there were **15 active alerts**, with a brief drop and later rise to **4 current alerts**. This information helps track system health and identify when issues were triggered. For further investigation or silencing, alerts can be viewed and managed via the Alertmanager UI.

![Screenshot From 2025-03-23 11-04-38](https://github.com/user-attachments/assets/cbd88e44-822c-4c35-a7a3-9d7ef05bdc0b)

### Access Alertmanager Web UI:

```bash
minikube service monitoring-kube-prometheus-alertmanager -n monitoring
```

![Screenshot From 2025-03-23 11-05-30](https://github.com/user-attachments/assets/fd733254-b229-4693-902c-7fdb0d075513)

## Init Container Implementation

![Screenshot From 2025-03-23 11-11-57](https://github.com/user-attachments/assets/4d2b4718-5276-40c5-897a-e71916fd2058)
