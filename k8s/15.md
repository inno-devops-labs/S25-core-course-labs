15.md â€” Kube Prometheus Stack Components

Prometheus Operator:
Manages Prometheus instances and their configuration in a declarative way. It automates setup, configuration, and management of Prometheus.

Prometheus:
Time-series database that scrapes metrics from various components and stores them. Used for querying metrics and alerting.

Alertmanager:
Handles alerts sent by Prometheus and routes them to email, Slack, etc., based on configured rules.

Grafana:
Visualization tool that connects to Prometheus to display dashboards with cluster metrics.

Node Exporter:
Runs on each node and exposes hardware and OS metrics (CPU, memory, disk, etc.).

Kube State Metrics:
Exposes high-level Kubernetes object metrics like pod status, deployments, etc.

Custom Resource Definitions (CRDs):
Used by the Prometheus Operator to define services, alerting rules, etc.

Service Monitors and Pod Monitors:
Custom resources that tell Prometheus which services or pods to scrape for metrics.

```
kubectl get po,sts,svc,pvc,cm
```

```kubectl get po``` lists active pods from the Kube Prometheus Stack and app deployments:

```
NAME                                                         READY   STATUS    RESTARTS       AGE
pod/alertmanager-monitoring-kube-prometheus-alertmanager-0   2/2     Running   0              42s
pod/app-my-app-0                                             1/1     Running   1              12d
pod/app-my-app-1                                             1/1     Running   1              12d
pod/app-my-app-2                                             1/1     Running   1              12d
pod/monitoring-grafana-8df5cd697-8p8lz                       3/3     Running   0              64s
pod/monitoring-kube-prometheus-operator-56d9c87df7-l7pl7     1/1     Running   0              64s
pod/monitoring-kube-state-metrics-5c4748cd88-v6kk9           1/1     Running   0              64s
pod/monitoring-prometheus-node-exporter-2plz8                1/1     Running   0              64s
pod/prometheus-monitoring-kube-prometheus-prometheus-0       1/2     Running   0              42s
pod/python-app-my-app-89777cfc5-jbv7h                        0/1     Running   54 (16s ago)   12d
```

```kubectl get sts``` displays StatefulSets for the monitoring stack and application:

```
NAME                                                                    READY   AGE
statefulset.apps/alertmanager-monitoring-kube-prometheus-alertmanager   1/1     42s
statefulset.apps/app-my-app                                             3/3     12d
statefulset.apps/prometheus-monitoring-kube-prometheus-prometheus       0/1     42s
```

```kubectl get svc``` lists services exposing Grafana, Prometheus, Alertmanager, and apps:

```
NAME                                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP   42s
service/app-my-app                                ClusterIP   10.106.118.233   <none>        80/TCP                       12d
service/app-my-app-headless                       ClusterIP   None             <none>        80/TCP                       12d
service/kubernetes                                ClusterIP   10.96.0.1        <none>        443/TCP                      26d
service/monitoring-grafana                        ClusterIP   10.96.107.144    <none>        80/TCP                       64s
service/monitoring-kube-prometheus-alertmanager   ClusterIP   10.108.39.158    <none>        9093/TCP,8080/TCP            64s
service/monitoring-kube-prometheus-operator       ClusterIP   10.102.214.105   <none>        443/TCP                      64s
service/monitoring-kube-prometheus-prometheus     ClusterIP   10.99.220.229    <none>        9090/TCP,8080/TCP            64s
service/monitoring-kube-state-metrics             ClusterIP   10.104.142.158   <none>        8080/TCP                     64s
service/monitoring-prometheus-node-exporter       ClusterIP   10.108.68.185    <none>        9100/TCP                     64s
service/prometheus-operated                       ClusterIP   None             <none>        9090/TCP                     42s
service/python-app-my-app                         ClusterIP   10.109.53.228    <none>        80/TCP                       13d
```

```kubectl get pvc``` shows volume claims used by the app-my-app StatefulSet:

```
NAME                                      STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   VOLUMEATTRIBUTESCLASS   AGE
persistentvolumeclaim/data-app-my-app-0   Bound    pvc-58c0ff82-90f6-4ca2-b803-a82ac6b6c92a   1Gi        RWO            standard       <unset>                 12d
persistentvolumeclaim/data-app-my-app-1   Bound    pvc-4bf57afa-90bd-4ab6-9d9f-1582a7a4631c   1Gi        RWO            standard       <unset>                 12d
persistentvolumeclaim/data-app-my-app-2   Bound    pvc-329515f5-b650-4922-93b9-affa77dade68   1Gi        RWO            standard       <unset>                 12d
```

```kubectl get cm``` lists config maps for dashboards, alert rules, and app configs:

```
NAME                                                                     DATA   AGE
configmap/kube-root-ca.crt                                               1      26d
configmap/monitoring-grafana                                             1      65s
configmap/monitoring-grafana-config-dashboards                           1      65s
configmap/monitoring-kube-prometheus-alertmanager-overview               1      65s
configmap/monitoring-kube-prometheus-apiserver                           1      65s
configmap/monitoring-kube-prometheus-cluster-total                       1      65s
configmap/monitoring-kube-prometheus-controller-manager                  1      65s
configmap/monitoring-kube-prometheus-etcd                                1      65s
configmap/monitoring-kube-prometheus-grafana-datasource                  1      65s
configmap/monitoring-kube-prometheus-grafana-overview                    1      65s
configmap/monitoring-kube-prometheus-k8s-coredns                         1      65s
configmap/monitoring-kube-prometheus-k8s-resources-cluster               1      65s
configmap/monitoring-kube-prometheus-k8s-resources-multicluster          1      65s
configmap/monitoring-kube-prometheus-k8s-resources-namespace             1      65s
configmap/monitoring-kube-prometheus-k8s-resources-node                  1      65s
configmap/monitoring-kube-prometheus-k8s-resources-pod                   1      65s
configmap/monitoring-kube-prometheus-k8s-resources-workload              1      65s
configmap/monitoring-kube-prometheus-k8s-resources-workloads-namespace   1      65s
configmap/monitoring-kube-prometheus-kubelet                             1      65s
configmap/monitoring-kube-prometheus-namespace-by-pod                    1      65s
configmap/monitoring-kube-prometheus-namespace-by-workload               1      65s
configmap/monitoring-kube-prometheus-node-cluster-rsrc-use               1      65s
configmap/monitoring-kube-prometheus-node-rsrc-use                       1      65s
configmap/monitoring-kube-prometheus-nodes                               1      65s
configmap/monitoring-kube-prometheus-nodes-darwin                        1      65s
configmap/monitoring-kube-prometheus-persistentvolumesusage              1      65s
configmap/monitoring-kube-prometheus-pod-total                           1      65s
configmap/monitoring-kube-prometheus-prometheus                          1      65s
configmap/monitoring-kube-prometheus-proxy                               1      65s
configmap/monitoring-kube-prometheus-scheduler                           1      65s
configmap/monitoring-kube-prometheus-workload-total                      1      65s
configmap/my-app-config                                                  1      17d
configmap/prometheus-monitoring-kube-prometheus-prometheus-rulefiles-0   35     42s
```


    Check CPU and Memory consumption of your StatefulSet.
    Identify Pods with higher and lower CPU usage in the default namespace.
    Monitor node memory usage in percentage and megabytes.
    Count the number of pods and containers managed by the Kubelet service.
    Evaluate network usage of Pods in the default namespace.
    Determine the number of active alerts; also check the Web UI with minikube service monitoring-kube-prometheus-alertmanager.

