## Secrets

### 1 Task

My tests k8s secrets that are created by following the provided tutorial
```bash
$ kubectl get secrets

NAME                               TYPE                 DATA   AGE
db-user-pass                       Opaque               2      92s
sh.helm.release.v1.helm-hooks.v1   helm.sh/release.v1   1      7d20h
sh.helm.release.v1.my-release.v1   helm.sh/release.v1   1      7d22h

$ kubectl get secret db-user-pass -o jsonpath='{.data}'

{"password":"UyFCXCpkJHpEc2I9","username":"YWRtaW4="}%

$ kubectl get secret db-user-pass -o jsonpath='{.data.password}' | base64 --decode

S!B\*d$zDsb=

$ kubectl get secret db-user-pass -o jsonpath='{.data.username}' | base64 --decode

admin
```

Secrets that are created using the helm plugin.
The output ot the commands:
```bash
$ kubectl get po
NAME                                        READY   STATUS    RESTARTS        AGE
helm-hooks-moscow-time-5bb6b97b5b-lz4d6     1/1     Running   1 (7d22h ago)   7d22h
helm-hooks-moscow-time-5bb6b97b5b-vgkph     1/1     Running   1 (7d22h ago)   7d22h
helm-hooks-moscow-time-5bb6b97b5b-xmksx     1/1     Running   1 (7d22h ago)   7d22h
moscow-time-deployment-6bcbb8d58c-7nw7n     1/1     Running   2 (7d22h ago)   8d
moscow-time-deployment-6bcbb8d58c-jcsp7     1/1     Running   2 (7d22h ago)   8d
moscow-time-deployment-6bcbb8d58c-pqcnv     1/1     Running   2 (7d22h ago)   8d
my-release-2-moscow-time-54b6575c68-cdh66   1/1     Running   0               3m45s
my-release-2-moscow-time-54b6575c68-tbgld   1/1     Running   0               3m45s
my-release-2-moscow-time-54b6575c68-vxc7f   1/1     Running   0               3m45s

$ kubectl exec my-release-2-moscow-time-54b6575c68-vxc7f  -- printenv | grep MY_PASSWORD
MY_PASSWORD=JSFzKGZsb2F0NjQ9MTIzNCk=
```

### 2 Task

The output of the commands inside pod:
```sh
$ cat /vault/secrets/database-config.txt 
data: map[password:db-secret-password username:db-readonly-username]
metadata: map[created_time:2025-03-09T16:41:46.813430281Z custom_metadata:<nil> deletion_time: destroyed:false version:1]

$ df -h
Filesystem                Size      Used Available Use% Mounted on
overlay                  32.8G     18.0G     13.3G  58% /
tmpfs                    64.0M         0     64.0M   0% /dev
shm                      64.0M         0     64.0M   0% /dev/shm
/dev/nvme0n1p6           32.8G     18.0G     13.3G  58% /dev/termination-log
tmpfs                     5.7G      4.0K      5.7G   0% /vault/secrets
/dev/nvme0n1p6           32.8G     18.0G     13.3G  58% /etc/resolv.conf
/dev/nvme0n1p6           32.8G     18.0G     13.3G  58% /etc/hostname
/dev/nvme0n1p6           32.8G     18.0G     13.3G  58% /etc/hosts
tmpfs                     5.7G     12.0K      5.7G   0% /run/secrets/kubernetes.io/serviceaccount
tmpfs                     2.8G         0      2.8G   0% /proc/asound
tmpfs                     2.8G         0      2.8G   0% /proc/acpi
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                    64.0M         0     64.0M   0% /proc/latency_stats
tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
tmpfs                     2.8G         0      2.8G   0% /proc/scsi
tmpfs                     2.8G         0      2.8G   0% /sys/firmware
tmpfs                     2.8G         0      2.8G   0% /sys/devices/virtual/powercap

$ kubectl describe pod my-release-3-moscow-time-7dfd5cdb5-vv6mc
Name:             my-release-3-moscow-time-7dfd5cdb5-vv6mc
Namespace:        default
Priority:         0
Service Account:  moscow-time-service-account
Node:             minikube/192.168.49.2
Start Time:       Sun, 09 Mar 2025 20:21:17 +0300
Labels:           app.kubernetes.io/instance=my-release-3
                  app.kubernetes.io/managed-by=Helm
                  app.kubernetes.io/name=moscow-time
                  app.kubernetes.io/version=1.16.0
                  helm.sh/chart=moscow-time-0.1.0
                  pod-template-hash=7dfd5cdb5
Annotations:      vault.hashicorp.com/agent-inject: true
                  vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
                  vault.hashicorp.com/agent-inject-status: injected
                  vault.hashicorp.com/role: my-role
Status:           Running
IP:               10.244.0.84
IPs:
  IP:           10.244.0.84
Controlled By:  ReplicaSet/my-release-3-moscow-time-7dfd5cdb5
Init Containers:
  vault-agent-init:
    Container ID:  docker://0c205f1cfb231c25ceb9e731ac9d32944ecb68d115961c75a54975033617b686
    Image:         hashicorp/vault:1.18.1
    Image ID:      docker-pullable://hashicorp/vault@sha256:3580fa352195aa7e76449cb8fadeef6d2f90a454c38982d30cf094e9013be786
    Port:          <none>
    Host Port:     <none>
    Command:
      /bin/sh
      -ec
    Args:
      echo ${VAULT_CONFIG?} | base64 -d > /home/vault/config.json && vault agent -config=/home/vault/config.json
    State:          Terminated
      Reason:       Completed
      Exit Code:    0
      Started:      Sun, 09 Mar 2025 20:21:17 +0300
      Finished:     Sun, 09 Mar 2025 20:21:18 +0300
    Ready:          True
    Restart Count:  0
    Limits:
      cpu:     500m
      memory:  128Mi
    Requests:
      cpu:     250m
      memory:  64Mi
    Environment:
      NAMESPACE:         default (v1:metadata.namespace)
      HOST_IP:            (v1:status.hostIP)
      POD_IP:             (v1:status.podIP)
      VAULT_LOG_LEVEL:   info
      VAULT_LOG_FORMAT:  standard
      VAULT_CONFIG:      eyJhdXRvX2F1dGgiOnsibWV0aG9kIjp7InR5cGUiOiJrdWJlcm5ldGVzIiwibW91bnRfcGF0aCI6ImF1dGgva3ViZXJuZXRlcyIsImNvbmZpZyI6eyJyb2xlIjoibXktcm9sZSIsInRva2VuX3BhdGgiOiIvdmFyL3J1bi9zZWNyZXRzL2t1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvdG9rZW4ifX0sInNpbmsiOlt7InR5cGUiOiJmaWxlIiwiY29uZmlnIjp7InBhdGgiOiIvaG9tZS92YXVsdC8udmF1bHQtdG9rZW4ifX1dfSwiZXhpdF9hZnRlcl9hdXRoIjp0cnVlLCJwaWRfZmlsZSI6Ii9ob21lL3ZhdWx0Ly5waWQiLCJ2YXVsdCI6eyJhZGRyZXNzIjoiaHR0cDovL3ZhdWx0LmRlZmF1bHQuc3ZjOjgyMDAifSwidGVtcGxhdGUiOlt7ImRlc3RpbmF0aW9uIjoiL3ZhdWx0L3NlY3JldHMvZGF0YWJhc2UtY29uZmlnLnR4dCIsImNvbnRlbnRzIjoie3sgd2l0aCBzZWNyZXQgXCJpbnRlcm5hbC9kYXRhL2RhdGFiYXNlL2NvbmZpZ1wiIH19e3sgcmFuZ2UgJGssICR2IDo9IC5EYXRhIH19e3sgJGsgfX06IHt7ICR2IH19XG57eyBlbmQgfX17eyBlbmQgfX0iLCJsZWZ0X2RlbGltaXRlciI6Int7IiwicmlnaHRfZGVsaW1pdGVyIjoifX0ifV0sInRlbXBsYXRlX2NvbmZpZyI6eyJleGl0X29uX3JldHJ5X2ZhaWx1cmUiOnRydWV9fQ==
    Mounts:
      /home/vault from home-init (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-lltp2 (ro)
      /vault/secrets from vault-secrets (rw)
Containers:
  moscow-time:
    Container ID:   docker://9412e8174d9187e1c06b02ec2f09086317005cd050c9f24bc6afb1e35b29fc4b
    Image:          macoyshev/moscow-time:latest
    Image ID:       docker-pullable://macoyshev/moscow-time@sha256:aaeaf2d6fcd37c5dfc7097650510a987d03c4c60f719e2a5a8ad2dd010f45962
    Port:           8000/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Sun, 09 Mar 2025 20:21:19 +0300
    Ready:          True
    Restart Count:  0
    Liveness:       http-get http://:8000/ delay=0s timeout=1s period=10s #success=1 #failure=3
    Readiness:      http-get http://:8000/ delay=0s timeout=1s period=10s #success=1 #failure=3
    Environment:
      MY_PASSWORD:  <set to the key 'password' in secret 'secret'>  Optional: false
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-lltp2 (ro)
      /vault/secrets from vault-secrets (rw)
  vault-agent:
    Container ID:  docker://a780bc457d48954a33eb2b0ee80ecdc5a6cceff32900586ea88289606374d0d1
    Image:         hashicorp/vault:1.18.1
    Image ID:      docker-pullable://hashicorp/vault@sha256:3580fa352195aa7e76449cb8fadeef6d2f90a454c38982d30cf094e9013be786
    Port:          <none>
    Host Port:     <none>
    Command:
      /bin/sh
      -ec
    Args:
      echo ${VAULT_CONFIG?} | base64 -d > /home/vault/config.json && vault agent -config=/home/vault/config.json
    State:          Running
      Started:      Sun, 09 Mar 2025 20:21:19 +0300
    Ready:          True
    Restart Count:  0
    Limits:
      cpu:     500m
      memory:  128Mi
    Requests:
      cpu:     250m
      memory:  64Mi
    Environment:
      NAMESPACE:         default (v1:metadata.namespace)
      HOST_IP:            (v1:status.hostIP)
      POD_IP:             (v1:status.podIP)
      VAULT_LOG_LEVEL:   info
      VAULT_LOG_FORMAT:  standard
      VAULT_CONFIG:      eyJhdXRvX2F1dGgiOnsibWV0aG9kIjp7InR5cGUiOiJrdWJlcm5ldGVzIiwibW91bnRfcGF0aCI6ImF1dGgva3ViZXJuZXRlcyIsImNvbmZpZyI6eyJyb2xlIjoibXktcm9sZSIsInRva2VuX3BhdGgiOiIvdmFyL3J1bi9zZWNyZXRzL2t1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvdG9rZW4ifX0sInNpbmsiOlt7InR5cGUiOiJmaWxlIiwiY29uZmlnIjp7InBhdGgiOiIvaG9tZS92YXVsdC8udmF1bHQtdG9rZW4ifX1dfSwiZXhpdF9hZnRlcl9hdXRoIjpmYWxzZSwicGlkX2ZpbGUiOiIvaG9tZS92YXVsdC8ucGlkIiwidmF1bHQiOnsiYWRkcmVzcyI6Imh0dHA6Ly92YXVsdC5kZWZhdWx0LnN2Yzo4MjAwIn0sInRlbXBsYXRlIjpbeyJkZXN0aW5hdGlvbiI6Ii92YXVsdC9zZWNyZXRzL2RhdGFiYXNlLWNvbmZpZy50eHQiLCJjb250ZW50cyI6Int7IHdpdGggc2VjcmV0IFwiaW50ZXJuYWwvZGF0YS9kYXRhYmFzZS9jb25maWdcIiB9fXt7IHJhbmdlICRrLCAkdiA6PSAuRGF0YSB9fXt7ICRrIH19OiB7eyAkdiB9fVxue3sgZW5kIH19e3sgZW5kIH19IiwibGVmdF9kZWxpbWl0ZXIiOiJ7eyIsInJpZ2h0X2RlbGltaXRlciI6In19In1dLCJ0ZW1wbGF0ZV9jb25maWciOnsiZXhpdF9vbl9yZXRyeV9mYWlsdXJlIjp0cnVlfX0=
    Mounts:
      /home/vault from home-sidecar (rw)
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-lltp2 (ro)
      /vault/secrets from vault-secrets (rw)
Conditions:
  Type                        Status
  PodReadyToStartContainers   True 
  Initialized                 True 
  Ready                       True 
  ContainersReady             True 
  PodScheduled                True 
Volumes:
  kube-api-access-lltp2:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
  home-init:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:     Memory
    SizeLimit:  <unset>
  home-sidecar:
    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:     Memory
    SizeLimit:  <unset>
  vault-secrets:
    Type:        EmptyDir (a temporary directory that shares a pod's lifetime)
    Medium:      Memory
    SizeLimit:   <unset>
QoS Class:       Burstable
Node-Selectors:  <none>
Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                 node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason     Age    From               Message
  ----     ------     ----   ----               -------
  Normal   Scheduled  6m36s  default-scheduler  Successfully assigned default/my-release-3-moscow-time-7dfd5cdb5-vv6mc to minikube
  Normal   Pulled     6m36s  kubelet            Container image "hashicorp/vault:1.18.1" already present on machine
  Normal   Created    6m36s  kubelet            Created container: vault-agent-init
  Normal   Started    6m35s  kubelet            Started container vault-agent-init
  Normal   Pulled     6m34s  kubelet            Container image "macoyshev/moscow-time:latest" already present on machine
  Normal   Created    6m34s  kubelet            Created container: moscow-time
  Normal   Started    6m34s  kubelet            Started container moscow-time
  Normal   Pulled     6m34s  kubelet            Container image "hashicorp/vault:1.18.1" already present on machine
  Normal   Created    6m34s  kubelet            Created container: vault-agent
  Normal   Started    6m34s  kubelet            Started container vault-agent
  Warning  Unhealthy  6m33s  kubelet            Readiness probe failed: Get "http://10.244.0.84:8000/": dial tcp 10.244.0.84:8000: connect: connection refused
```