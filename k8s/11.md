# Lab 11 Report

## Task 1 - Kubernetes Secrets and Resource Management

### Step 1 - Create a Secret Using kubectl
```
kubectl create secret generic my-secret --from-literal=MY_PASS='1221'
secret/my-secret created
```

### Step 2 - Verify and Decode Your Secret
```
kubectl get secret my-secret -o yaml
```
```yaml
apiVersion: v1
data:
  MY_PASS: MTIyMQ==
kind: Secret
metadata:
  creationTimestamp: "2025-03-09T20:19:17Z"
  name: my-secret
  namespace: default
  resourceVersion: "7597"
  uid: 1776af13-34d2-4efe-8366-bc30056fc7b5
type: Opaque
```
```
$encoded = kubectl get secret my-secret -o jsonpath="{.data.MY_PASS}"
[System.Text.Encoding]::UTF8.GetString([System.Convert]::FromBase64String($encoded))
1221
```

### Step 3 - Helm Upgrade with Secret Environment Variable
```
helm upgrade app-python ./app-python
Release "app-python" has been upgraded. Happy Helming!
NAME: app-python
LAST DEPLOYED: Sun Mar  9 23:24:15 2025
NAMESPACE: default
STATUS: deployed
REVISION: 4
```

### Step 4 - Verify Pod and Environment Variable
```
kubectl get po
```
```
NAME                                     READY   STATUS      RESTARTS   AGE
app-python-585d7dd56-pphxn               1/1     Running     0          36s
helm-hooks-app-python-8459dcdf7c-cfxjc   1/1     Running     0          16m
post-install-hook-d9zm7                  0/1     Completed   0          16m
preinstall-hook-hlkwh                    0/1     Completed   0          16m
```
```
kubectl exec app-python-585d7dd56-pphxn -- printenv | findstr MY_PASS
MY_PASS=1221
```

---

## Task 2 - Vault Secret Management System

### Step 1 - Install Vault Using Helm Chart
```
helm install vault hashicorp/vault --set "server.dev.enabled=true"
NAME: vault
LAST DEPLOYED: Sun Mar  9 23:27:16 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
```
```
kubectl get po -l app.kubernetes.io/name=vault
NAME      READY   STATUS    RESTARTS   AGE
vault-0   1/1     Running   0          8m20s
```

### Step 2 - Set a Secret in Vault
```
vault kv put secret/myapp MY_VAULT_PASS="1221"
== Secret Path ==
secret/data/myapp

======= Metadata =======
Key                Value
---                -----
created_time       2025-03-09T20:39:49.758298899Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            3
```

### Step 3 - Configure Kubernetes Authentication
```
vault write auth/kubernetes/config \
    token_reviewer_jwt="$saToken" \
    kubernetes_host="$kubeHost" \
    kubernetes_ca_cert="$kubeCA"
Success! Data written to: auth/kubernetes/config
```

### Step 4 - Upload Vault Policy
```
vault policy write myapp-policy myapp-policy.hcl
Success! Uploaded policy: myapp-policy
```

### Step 5 - Helm Upgrade with Vault Integration
```
helm upgrade app-python ./app-python
Release "app-python" has been upgraded. Happy Helming!
NAME: app-python
LAST DEPLOYED: Sun Mar  9 23:46:26 2025
NAMESPACE: default
STATUS: deployed
REVISION: 5
```

### Step 6 - Verify Pod and Vault Secret Environment Variable
```
kubectl get po
```
```
NAME                                     READY   STATUS        RESTARTS   AGE
app-python-585d7dd56-pphxn               1/1     Terminating   0          22m
app-python-8757cdcd8-44gg5               1/1     Running       0          3s
helm-hooks-app-python-8459dcdf7c-cfxjc   1/1     Running       0          37m
post-install-hook-d9zm7                  0/1     Completed     0          37m
preinstall-hook-hlkwh                    0/1     Completed     0          38m
vault-0                                  1/1     Running       0          19m
vault-agent-injector-66f45b5fd5-j28p5    1/1     Running       0          19m
```
```
kubectl exec -it app-python-8757cdcd8-44gg5 -- printenv | findstr MY_VAULT_PASS
MY_VAULT_PASS=1221
```

---

## Files and Configurations

### secrets.yaml
```yaml
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "app-python.fullname" . }}-secret
type: Opaque
data:
  MY_PASS: {{ .Values.secret.myPass | b64enc | quote }}
```

### values.yaml - Resource requests and limits
```yaml
resources:
  requests:
    memory: "64Mi"
    cpu: "250m"
  limits:
    memory: "128Mi"
    cpu: "500m"
```

---