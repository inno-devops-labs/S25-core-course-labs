# Task 1: Kubernetes Secrets and Resource Management

## Create a Secret Using kubectl

```bash
kubectl create secret generic app-python-secret --from-literal=app-python=secret
secret/app-python-secret created
```

```bash
kubectl get secrets
NAME                               TYPE                 DATA   AGE
app-python-secret                  Opaque               1      26s
```

```bash
kubectl get secret app-python-secret -o jsonpath='{.data}'
{"app-python":"c2VjcmV0"}
```

```bash
echo 'c2VjcmV0' | base64 -d
secret
```

## Update Helm deployment

```bash
kubectl get po
NAME                                     READY   STATUS    RESTARTS       AGE
app-python-648449cc74-mc77t              1/1     Running   0              40s
```
### Verify secrets inside the pod

```bash
kubectl exec app-python-648449cc74-mc77t -- printenv | grep USERNAME
USERNAME=ahmetovaa
```
```bash
kubectl exec app-python-648449cc74-mc77t -- printenv | grep PASSWORD
PASSWORD=qwerty
```

# Task 2: Vault Secret Management System

## Install Vault Using Helm Chart

```bash
kubectl get pods
NAME                                     READY   STATUS    RESTARTS        AGE
app-python-648449cc74-mc77t              1/1     Running   1 (8m45s ago)   5d21h
helm-hooks-app-python-845844f4d9-glnpr   1/1     Running   2 (8m45s ago)   6d17h
vault-0                                  1/1     Running   0               7m50s
vault-agent-injector-66f45b5fd5-hd7xf    1/1     Running   0               7m50s
```

## Follow the Tutorial with Your Helm Chart

### Set a Secret in Vault

```bash
vault secrets enable -path=internal kv-v2
Success! Enabled the kv-v2 secrets engine at: internal/
```

```bash
vault kv put internal/database/config username="angelika2707"
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2025-03-08T16:20:11.936216784Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
```

```bash
vault kv get internal/database/config
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2025-03-08T16:20:11.936216784Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1

====== Data ======
Key         Value
---         -----
username    angelika2707
```

### Configure Kubernetes Authentication

```bash
vault auth enable kubernetes
Success! Enabled kubernetes auth method at: kubernetes/
```

```bash
vault write auth/kubernetes/config \
>        kubernetes_host="https://$KUBERNETES_PORT_443_TCP_ADDR:443"
Success! Data written to: auth/kubernetes/config
```

```bash
vault policy write internal-app - <<EOF
> path "internal/data/database/config" {
>    capabilities = ["read"]
> }
> EOF
Success! Uploaded policy: internal-app
```
```bash
vault write auth/kubernetes/role/internal-app \
>        bound_service_account_names=internal-app \
>        bound_service_account_namespaces=default \
>        policies=internal-app \
>        ttl=24h
Success! Data written to: auth/kubernetes/role/internal-app
```

### Define a Kubernetes Service Account

```bash
 kubectl get serviceaccounts
NAME                    SECRETS   AGE
app-python              0         5d21h
default                 0         8d
helm-hooks-app-python   0         6d18h
vault                   0         52m
vault-agent-injector    0         52m
```

```bash
kubectl create sa internal-app
serviceaccount/internal-app created
```

```bash
kubectl get serviceaccounts
NAME                    SECRETS   AGE
app-python              0         5d22h
default                 0         8d
helm-hooks-app-python   0         6d18h
internal-app            0         32s
vault                   0         64m
vault-agent-injector    0         64m
```
## Implement Vault Secrets in Your Helm Chart

```bash
kubectl patch deployment app-python --patch-file=k8s/app-python/patch-inject-secrets.yaml 
deployment.apps/app-python patched
```