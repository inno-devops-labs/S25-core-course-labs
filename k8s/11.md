# 11.md

## Task 1: Kubernetes Secrets and Resource Management

### 1. Create a Secret Using `kubectl`

1. **Create a Secret:**
   ```bash
   kubectl create secret generic super-secret --from-literal=CHATGPT_KEY=hahahuman
   ```
   **Output:**
   ```
   andrew@Andrews-MacBook-Pro S25-devops % kubectl create secret generic super-secret --from-literal=CHATGPT_KEY=hahahuman
    
   secret/super-secret created
   ```
2. **Verify and Decode:**
   ```bash
   kubectl get secrets
   kubectl describe secret super-secret
   kubectl get secret super-secret -o yaml
   ```
   **Output:**
   ```
   andrew@Andrews-MacBook-Pro S25-devops % kubectl get secrets
   NAME           TYPE     DATA   AGE
   super-secret   Opaque   1      20s
   andrew@Andrews-MacBook-Pro S25-devops % kubectl describe secret super-secret
   Name:         super-secret
   Namespace:    default
   Labels:       <none>
   Annotations:  <none>
   
   Type:  Opaque
   
   Data
   ====
   CHATGPT_KEY:  9 bytes
   andrew@Andrews-MacBook-Pro S25-devops % kubectl get secret super-secret -o yaml
   apiVersion: v1
   data:
     CHATGPT_KEY: aGFoYWh1bWFu
   kind: Secret
   metadata:
     creationTimestamp: "2025-03-08T20:16:28Z"
     name: super-secret
     namespace: default
     resourceVersion: "71521"
     uid: a9c6ba57-b489-44f5-8c3f-00cd77a331c6
   type: Opaque
   ```
   - **To decode the base64 value:**
     `echo "aGFoYWh1bWFu" | base64 --decode`  
     **Output:**
     ```
     andrew@Andrews-MacBook-Pro S25-devops % echo "aGFoYWh1bWFu" | base64 --decode
     hahahuman
     ```

### 2. Manage Secrets with Helm. Prerequisites & Setup

1. **Install Required Tools**  
   ```bash
   brew install gnu-getopt
   brew install gpg
   brew install sops
   ```
2. **Generate a GPG key**
   ```bash
   gpg --gen-key
   gpg --list-keys
   ```
   - Note the Public Key (e.g., 89A3EEA37B910C265DA55671C905554B8016AE57) for later use
   - DO NOT FORGET a passphrase
3. **Set Environment Variable (for GPG TTY):**  
   `export GPG_TTY=$(tty)`
### 3. Encrypting a Secrets File with SOPS

1. **Create a YAML File**  
   `sops -p 89A3EEA37B910C265DA55671C905554B8016AE57 secrets.yaml`
   - This opens an editor. Inside, define secret key:
     `CHATGPT_KEY: hahahuman`
   - Save and exit. SOPS automatically encrypts it using your GPG key.
2. **Verify Decryption**  
   `sops -d ./python-app/secrets.yaml`  
   You should see your data (`CHATGPT_KEY: hahahuman`).
   ```
   andrew@Andrews-MacBook-Pro k8s % sops -d ./python-app/secrets.yaml
   CHATGPT_KEY: hahahuman
   ```
   You will be asked to enter a passphrase, if while creating GPG key you texted it.

### 3. Installing with Helm Secrets

1. **Install/Upgrade Chart**  
   `helm secrets install python-app ./python-app -n default -f ./python-app/secrets.yaml`
   - The helm-secrets plugin automatically decrypts secrets.yaml before applying it to the cluster, then removes the temporary decrypted file.
   **Output:**
   ```
    andrew@Andrews-MacBook-Pro k8s % helm secrets install python-app ./python-app -n default -f ./python-app/secrets.yaml
    [helm-secrets] Decrypt: ./python-app/secrets.yaml
     NAME: python-app
    LAST DEPLOYED: Sat Mar  8 23:58:48 2025
    NAMESPACE: default
    STATUS: deployed
    REVISION: 1
    NOTES:
    1. Get the application URL by running these commands:
      export NODE_PORT=$(kubectl get --namespace default -o jsonpath="{.spec.ports[0].nodePort}" services python-app)
      export NODE_IP=$(kubectl get nodes --namespace default -o jsonpath="{.items[0].status.addresses[0].address}")
      echo http://$NODE_IP:$NODE_PORT
    [helm-secrets] Removed: ./python-app/secrets.yaml.dec
   ```
2. **Check the Release**  
   `helm ls`  
   **Output:**
   ```
   andrew@Andrews-MacBook-Pro k8s %  helm ls
   NAME      	NAMESPACE	REVISION	UPDATED                           	STATUS  	CHART           	APP VERSION
   python-app	default  	1       	2025-03-08 23:58:48.6068 +0300 MSK	deployed	python-app-0.1.0	1.16.0 
   ```
3. **Inspect the Kubernetes Secret**
   `kubectl get secret credentials -o yaml`  
   Output:
   ```
    andrew@Andrews-MacBook-Pro k8s % kubectl get secret credentials -o yaml
    apiVersion: v1
    data:
      CHATGPT_KEY: aGFoYWh1bWFu
    kind: Secret
    metadata:
      annotations:
        meta.helm.sh/release-name: python-app
        meta.helm.sh/release-namespace: default
      creationTimestamp: "2025-03-08T20:59:11Z"
      labels:
        app.kubernetes.io/managed-by: Helm
      name: credentials
      namespace: default
      resourceVersion: "73936"
      uid: 3af6a5f0-dcac-4201-a7af-a4d80b7a201e
    type: Opaque
   ```
   - Youâ€™ll see a base64-encoded key (e.g., `aGFoYWh1bWFu`), which decodes to `hahahuman`.


### 4. Verifying the Secret in the Pod
1. **Get Pods**  
   `kubectl get po`  
   **Output:**
   ```
   andrew@Andrews-MacBook-Pro k8s % kubectl get po
   NAME                          READY   STATUS    RESTARTS   AGE
   python-app-7bfd7b4474-fkkvv   1/1     Running   0          106s
   ```
2. **Check the Environment Variable**  
   `kubectl exec python-app-7bfd7b4474-fkkvv -- printenv | grep "gpt_key"`  
   Output:
   ```
   andrew@Andrews-MacBook-Pro k8s % kubectl exec python-app-7bfd7b4474-fkkvv -- printenv | grep "gpt_key"
   gpt_key=hahahuman
   ```
   - Confirms the secret is injected into the container as an environment variable.

## Task 2: Vault Secret Management System

### 1. Install Vault with Helm

1. **Add HashiCorp Repo & Update**
   ```bash
   helm repo add hashicorp https://helm.releases.hashicorp.com
   helm repo update
   ```
2. **Install Vault**  
   `helm install vault hashicorp/vault --set "server.dev.enabled=true"`  

### 2. Enable KV Secrets & Configure Kubernetes Auth
1. **Access the Vault Pod:**  
   `kubectl exec -it vault-0 -- /bin/sh`  
2. **Enable KV-v2 Secrets:**  
   `vault secrets enable -path=internal kv-v2`  
   Output:
   ```
   / $ vault secrets enable -path=internal kv-v2
   Success! Enabled the kv-v2 secrets engine at: internal/
   ```
3. **Add a Test Secret:**  
   `vault kv put internal/database/config username="azaki"`  
   Output:
   ```
   / $ vault kv put internal/database/config username="azaki"
   ======== Secret Path ========
   internal/data/database/config
   
   ======= Metadata =======
   Key                Value
   ---                -----
   created_time       2025-03-08T21:30:59.89976073Z
   custom_metadata    <nil>
   deletion_time      n/a
   destroyed          false
   version            1
   ```
   - Confirm by running:
   ```
   / $ vault kv get internal/database/config
   ======== Secret Path ========
   internal/data/database/config
   
   ======= Metadata =======
   Key                Value
   ---                -----
   created_time       2025-03-08T21:30:59.89976073Z
   custom_metadata    <nil>
   deletion_time      n/a
   destroyed          false
   version            1
   
   ====== Data ======
   Key         Value
   ---         -----
   username    azaki
   ```
4. **Enable Kubernetes Auth:**  
   ```
   vault auth enable kubernetes
   vault write auth/kubernetes/config \
     kubernetes_host="https://$KUBERNETES_PORT_443_TCP_ADDR:443"
   ```
   Output:
   ```
   / $ vault auth enable kubernetes
   Success! Enabled kubernetes auth method at: kubernetes/
   / $ vault write auth/kubernetes/config \
   >       kubernetes_host="https://$KUBERNETES_PORT_443_TCP_ADDR:443"
   Success! Data written to: auth/kubernetes/config
   ```
5. **Create a Policy that grants read access to the secret:**  
   ```
   vault policy write internal-app - <<EOF
   path "internal/data/database/config" {
      capabilities = ["read"]
   }
   EOF
   ```
   Output:
   ```
   / $ vault policy write internal-app - <<EOF
   > path "internal/data/database/config" {
   >    capabilities = ["read"]
   > }
   > EOF
   Success! Uploaded policy: internal-app
   ```
6. **Create a Vault Role that binds the policy to a ServiceAccount::**  
   ```
   vault write auth/kubernetes/role/internal-app \
     bound_service_account_names=internal-app \
     bound_service_account_namespaces=default \
     policies=internal-app \
     ttl=24h
   ```
   Output:
   ```
   / $ vault write auth/kubernetes/role/internal-app \
   >       bound_service_account_names=internal-app \
   >       bound_service_account_namespaces=default \
   >       policies=internal-app \
   >       ttl=24h
   Success! Data written to: auth/kubernetes/role/internal-app
   ```
   - This means any Pod using the `internal-app` ServiceAccount in the `default` namespace has permission to read `internal/data/database/config`.

### 3. Create a ServiceAccount and Patch Your App
1. **Create ServiceAccount:**  
   `kubectl create sa internal-app`  
   `kubectl get serviceaccounts`
   ```
   andrew@Andrews-MacBook-Pro k8s % kubectl get serviceaccounts
   NAME                   SECRETS   AGE
   default                0         10d
   internal-app           0         5s
   python-app             0         33m
   vault                  0         7m47s
   vault-agent-injector   0         7m47s
   ```
2. **Patch Deployment:**  
   `kubectl patch deployment python-app --patch-file=patch-inject-secrets.yaml`  
   **Output:**
   ```
   andrew@Andrews-MacBook-Pro python-app % kubectl patch deployment python-app --patch-file=patch-inject-secrets.yaml                                        
   deployment.apps/python-app patched
   ```
3. **Upgrade/Install Helm Chart:**  
   `helm upgrade --install python-app .`  

### 4. Verify Vault Secrets Injection
1. **Exec into container:**  
   `kubectl exec -it python-app-6cb89c8bb8-hcc7h --container python-app -- /bin/sh`
   - Inside the container, list files or environment variables injected by Vault:
     ```
      cat /vault/secrets/database-config.txt
      df -h
     ```
     Output:
     ```
      / $ cat vault/secrets/database-config.txt 
      data: map[username:azaki]
      metadata: map[created_time:2025-03-08T21:30:59.89976073Z custom_metadata:<nil> deletion_time: destroyed:false version:1]
      / $ df -h
      Filesystem                Size      Used Available Use% Mounted on
      overlay                 293.5G     65.5G    228.1G  22% /
      tmpfs                    64.0M         0     64.0M   0% /dev
      shm                      64.0M         0     64.0M   0% /dev/shm
      tmpfs                    19.6G      4.0K     19.6G   0% /vault/secrets
      /dev/vdb1               293.5G     65.5G    228.1G  22% /dev/termination-log
      /dev/vdb1               293.5G     65.5G    228.1G  22% /etc/resolv.conf
      /dev/vdb1               293.5G     65.5G    228.1G  22% /etc/hostname
      /dev/vdb1               293.5G     65.5G    228.1G  22% /etc/hosts
      tmpfs                    19.6G     12.0K     19.6G   0% /run/secrets/kubernetes.io/serviceaccount
      tmpfs                    64.0M         0     64.0M   0% /proc/keys
      tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
      tmpfs                     9.8G         0      9.8G   0% /sys/firmware

     ```

## Bonus Task: Resource Management & Environment Variables

### 1. Resource Management

1. **Define** resource requests and limits in each chartâ€™s `values.yaml`:
   ```yaml
   resources:
      limits:
        cpu: 100m
        memory: 128Mi
      requests:
        cpu: 100m
        memory: 128Mi
   ```
2. **Apply changes:**
   ```
   helm upgrade --install python-app ./python-app
   helm upgrade --install golang-app ./golang-app
   ```
3. **Verify via `kubectl describe pod`:**
   ```
   kubectl describe pod python-app-7df675cd66-5h65b
   ```
   **Output:**
   ```
   andrew@Andrews-MacBook-Pro python-app % kubectl describe pod python-app-7df675cd66-5h65b
   Name:             python-app-7df675cd66-5h65b
   Namespace:        default
   Priority:         0
   Service Account:  internal-app
   Node:             minikube/192.168.49.2
   Start Time:       Sun, 09 Mar 2025 01:47:13 +0300
   Labels:           app.kubernetes.io/instance=python-app
                     app.kubernetes.io/managed-by=Helm
                     app.kubernetes.io/name=python-app
                     app.kubernetes.io/part-of=my-shared-library
                     app.kubernetes.io/version=0.1.0
                     helm.sh/chart=python-app-0.1.0
                     pod-template-hash=7df675cd66
   Annotations:      vault.hashicorp.com/agent-inject: true
                     vault.hashicorp.com/agent-inject-secret-database-config.txt: internal/data/database/config
                     vault.hashicorp.com/agent-inject-status: injected
                     vault.hashicorp.com/role: internal-app
   Status:           Running
   IP:               10.244.0.79
   IPs:
     IP:           10.244.0.79
   Controlled By:  ReplicaSet/python-app-7df675cd66
   Init Containers:
     vault-agent-init:
       Container ID:  docker://b64594375f217d16259a92b2b5a6eb4ac88882ab6273e6675a445d34afb3500e
       Image:         hashicorp/vault:1.18.1
       Image ID:      docker-pullable://hashicorp/vault@sha256:3580fa352195aa7e76449cb8fadeef6d2f90a454c38982d30cf094e9013be786
       Port:          <none>
       Host Port:     <none>
       Command:
         /bin/sh
         -ec
       Args:
         echo ${VAULT_CONFIG?} | base64 -d > /home/vault/config.json && vault agent -config=/home/vault/config.json
       State:          Terminated
         Reason:       Completed
         Exit Code:    0
         Started:      Sun, 09 Mar 2025 01:47:14 +0300
         Finished:     Sun, 09 Mar 2025 01:47:14 +0300
       Ready:          True
       Restart Count:  0
       Limits:
         cpu:     500m
         memory:  128Mi
       Requests:
         cpu:     250m
         memory:  64Mi
       Environment:
         NAMESPACE:         default (v1:metadata.namespace)
         HOST_IP:            (v1:status.hostIP)
         POD_IP:             (v1:status.podIP)
         VAULT_LOG_LEVEL:   info
         VAULT_LOG_FORMAT:  standard
         VAULT_CONFIG:      eyJhdXRvX2F1dGgiOnsibWV0aG9kIjp7InR5cGUiOiJrdWJlcm5ldGVzIiwibW91bnRfcGF0aCI6ImF1dGgva3ViZXJuZXRlcyIsImNvbmZpZyI6eyJyb2xlIjoiaW50ZXJuYWwtYXBwIiwidG9rZW5fcGF0aCI6Ii92YXIvcnVuL3NlY3JldHMva3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC90b2tlbiJ9fSwic2luayI6W3sidHlwZSI6ImZpbGUiLCJjb25maWciOnsicGF0aCI6Ii9ob21lL3ZhdWx0Ly52YXVsdC10b2tlbiJ9fV19LCJleGl0X2FmdGVyX2F1dGgiOnRydWUsInBpZF9maWxlIjoiL2hvbWUvdmF1bHQvLnBpZCIsInZhdWx0Ijp7ImFkZHJlc3MiOiJodHRwOi8vdmF1bHQuZGVmYXVsdC5zdmM6ODIwMCJ9LCJ0ZW1wbGF0ZSI6W3siZGVzdGluYXRpb24iOiIvdmF1bHQvc2VjcmV0cy9kYXRhYmFzZS1jb25maWcudHh0IiwiY29udGVudHMiOiJ7eyB3aXRoIHNlY3JldCBcImludGVybmFsL2RhdGEvZGF0YWJhc2UvY29uZmlnXCIgfX17eyByYW5nZSAkaywgJHYgOj0gLkRhdGEgfX17eyAkayB9fToge3sgJHYgfX1cbnt7IGVuZCB9fXt7IGVuZCB9fSIsImxlZnRfZGVsaW1pdGVyIjoie3siLCJyaWdodF9kZWxpbWl0ZXIiOiJ9fSJ9XSwidGVtcGxhdGVfY29uZmlnIjp7ImV4aXRfb25fcmV0cnlfZmFpbHVyZSI6dHJ1ZX19
       Mounts:
         /home/vault from home-init (rw)
         /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-t65c4 (ro)
         /vault/secrets from vault-secrets (rw)
   Containers:
     python-app:
       Container ID:   docker://f7d6457a1b3a04d0e40a182e1cf036653f486b4752fdf19f686d63dc021af84e
       Image:          azazaki/app_python:latest
       Image ID:       docker-pullable://azazaki/app_python@sha256:e2354bfddda7eb9d1892062fd079811a1a6eeb2d229233150e934aec2ac1d053
       Port:           5001/TCP
       Host Port:      0/TCP
       State:          Running
         Started:      Sun, 09 Mar 2025 01:47:14 +0300
       Ready:          True
       Restart Count:  0
       Limits:
         cpu:     100m
         memory:  128Mi
       Requests:
         cpu:     100m
         memory:  128Mi
       Environment:
         gpt_key:  <set to the key 'CHATGPT_KEY' in secret 'credentials'>  Optional: false
         my-pass:  supersecret123
         api-key:  nokia3310
         flight:   aviasales
       Mounts:
         /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-t65c4 (ro)
         /vault/secrets from vault-secrets (rw)
     vault-agent:
       Container ID:  docker://555268145ab89315a219d27dad030349fd77bc7639ef6a3b883f231f292ac5c0
       Image:         hashicorp/vault:1.18.1
       Image ID:      docker-pullable://hashicorp/vault@sha256:3580fa352195aa7e76449cb8fadeef6d2f90a454c38982d30cf094e9013be786
       Port:          <none>
       Host Port:     <none>
       Command:
         /bin/sh
         -ec
       Args:
         echo ${VAULT_CONFIG?} | base64 -d > /home/vault/config.json && vault agent -config=/home/vault/config.json
       State:          Running
         Started:      Sun, 09 Mar 2025 01:47:14 +0300
       Ready:          True
       Restart Count:  0
       Limits:
         cpu:     500m
         memory:  128Mi
       Requests:
         cpu:     250m
         memory:  64Mi
       Environment:
         NAMESPACE:         default (v1:metadata.namespace)
         HOST_IP:            (v1:status.hostIP)
         POD_IP:             (v1:status.podIP)
         VAULT_LOG_LEVEL:   info
         VAULT_LOG_FORMAT:  standard
         VAULT_CONFIG:      eyJhdXRvX2F1dGgiOnsibWV0aG9kIjp7InR5cGUiOiJrdWJlcm5ldGVzIiwibW91bnRfcGF0aCI6ImF1dGgva3ViZXJuZXRlcyIsImNvbmZpZyI6eyJyb2xlIjoiaW50ZXJuYWwtYXBwIiwidG9rZW5fcGF0aCI6Ii92YXIvcnVuL3NlY3JldHMva3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC90b2tlbiJ9fSwic2luayI6W3sidHlwZSI6ImZpbGUiLCJjb25maWciOnsicGF0aCI6Ii9ob21lL3ZhdWx0Ly52YXVsdC10b2tlbiJ9fV19LCJleGl0X2FmdGVyX2F1dGgiOmZhbHNlLCJwaWRfZmlsZSI6Ii9ob21lL3ZhdWx0Ly5waWQiLCJ2YXVsdCI6eyJhZGRyZXNzIjoiaHR0cDovL3ZhdWx0LmRlZmF1bHQuc3ZjOjgyMDAifSwidGVtcGxhdGUiOlt7ImRlc3RpbmF0aW9uIjoiL3ZhdWx0L3NlY3JldHMvZGF0YWJhc2UtY29uZmlnLnR4dCIsImNvbnRlbnRzIjoie3sgd2l0aCBzZWNyZXQgXCJpbnRlcm5hbC9kYXRhL2RhdGFiYXNlL2NvbmZpZ1wiIH19e3sgcmFuZ2UgJGssICR2IDo9IC5EYXRhIH19e3sgJGsgfX06IHt7ICR2IH19XG57eyBlbmQgfX17eyBlbmQgfX0iLCJsZWZ0X2RlbGltaXRlciI6Int7IiwicmlnaHRfZGVsaW1pdGVyIjoifX0ifV0sInRlbXBsYXRlX2NvbmZpZyI6eyJleGl0X29uX3JldHJ5X2ZhaWx1cmUiOnRydWV9fQ==
       Mounts:
         /home/vault from home-sidecar (rw)
         /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-t65c4 (ro)
         /vault/secrets from vault-secrets (rw)
   Conditions:
     Type                        Status
     PodReadyToStartContainers   True 
     Initialized                 True 
     Ready                       True 
     ContainersReady             True 
     PodScheduled                True 
   Volumes:
     kube-api-access-t65c4:
       Type:                    Projected (a volume that contains injected data from multiple sources)
       TokenExpirationSeconds:  3607
       ConfigMapName:           kube-root-ca.crt
       ConfigMapOptional:       <nil>
       DownwardAPI:             true
     home-init:
       Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
       Medium:     Memory
       SizeLimit:  <unset>
     home-sidecar:
       Type:       EmptyDir (a temporary directory that shares a pod's lifetime)
       Medium:     Memory
       SizeLimit:  <unset>
     vault-secrets:
       Type:        EmptyDir (a temporary directory that shares a pod's lifetime)
       Medium:      Memory
       SizeLimit:   <unset>
   QoS Class:       Burstable
   Node-Selectors:  <none>
   Tolerations:     node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                    node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
   Events:
     Type    Reason     Age    From               Message
     ----    ------     ----   ----               -------
     Normal  Scheduled  3m37s  default-scheduler  Successfully assigned default/python-app-7df675cd66-5h65b to minikube
     Normal  Pulled     3m36s  kubelet            Container image "hashicorp/vault:1.18.1" already present on machine
     Normal  Created    3m36s  kubelet            Created container: vault-agent-init
     Normal  Started    3m36s  kubelet            Started container vault-agent-init
     Normal  Pulled     3m36s  kubelet            Container image "azazaki/app_python:latest" already present on machine
     Normal  Created    3m36s  kubelet            Created container: python-app
     Normal  Started    3m36s  kubelet            Started container python-app
     Normal  Pulled     3m36s  kubelet            Container image "hashicorp/vault:1.18.1" already present on machine
     Normal  Created    3m36s  kubelet            Created container: vault-agent
     Normal  Started    3m36s  kubelet            Started container vault-agent
   ```
   ```
   kubectl describe pod golang-app-b89b66974-8zgkb
   ```
   **Output:**
   ```
   andrew@Andrews-MacBook-Pro python-app % kubectl describe pod golang-app-b89b66974-8zgkb
   Name:             golang-app-b89b66974-8zgkb
   Namespace:        default
   Priority:         0
   Service Account:  golang-app
   Node:             minikube/192.168.49.2
   Start Time:       Sun, 09 Mar 2025 01:46:52 +0300
   Labels:           app.kubernetes.io/instance=golang-app
                     app.kubernetes.io/managed-by=Helm
                     app.kubernetes.io/name=golang-app
                     app.kubernetes.io/part-of=my-shared-library
                     app.kubernetes.io/version=0.1.0
                     helm.sh/chart=golang-app-0.1.0
                     pod-template-hash=b89b66974
   Annotations:      <none>
   Status:           Running
   IP:               10.244.0.78
   IPs:
     IP:           10.244.0.78
   Controlled By:  ReplicaSet/golang-app-b89b66974
   Containers:
     golang-app:
       Container ID:   docker://217c8664dad41e4578e34b8350701a66c6ceebc697ae530ebd3a4bab580c09e7
       Image:          azazaki/app_golang:latest
       Image ID:       docker-pullable://azazaki/app_golang@sha256:aa3576fd5b62b2bd95f3e5abc745afcf144fedd8a458e2d95b5a54a91567cfdd
       Port:           8080/TCP
       Host Port:      0/TCP
       State:          Running
         Started:      Sun, 09 Mar 2025 01:46:53 +0300
       Ready:          True
       Restart Count:  0
       Limits:
         cpu:     100m
         memory:  128Mi
       Requests:
         cpu:     100m
         memory:  128Mi
       Environment:
         my-pass:  supersecret123
         api-key:  nokia3310
         flight:   aviasales
       Mounts:
         /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-lw8k9 (ro)
   Conditions:
     Type                        Status
     PodReadyToStartContainers   True 
     Initialized                 True 
     Ready                       True 
     ContainersReady             True 
     PodScheduled                True 
   Volumes:
     kube-api-access-lw8k9:
       Type:                    Projected (a volume that contains injected data from multiple sources)
       TokenExpirationSeconds:  3607
       ConfigMapName:           kube-root-ca.crt
       ConfigMapOptional:       <nil>
       DownwardAPI:             true
   QoS Class:                   Guaranteed
   Node-Selectors:              <none>
   Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                                node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
   Events:
     Type    Reason     Age    From               Message
     ----    ------     ----   ----               -------
     Normal  Scheduled  5m20s  default-scheduler  Successfully assigned default/golang-app-b89b66974-8zgkb to minikube
     Normal  Pulled     5m19s  kubelet            Container image "azazaki/app_golang:latest" already present on machine
     Normal  Created    5m19s  kubelet            Created container: golang-app
     Normal  Started    5m19s  kubelet            Started container golang-app
   ```
   - Look under Containers â†’ Limits and Requests to confirm.

### 2. Environment Variables (Including a Secret)
1. **Include in `_helpers.tpl`:**
   ```
   {{- define "python-app.environmentVariables" -}}
   - name: my-pass
     value: {{ .Values.environment.MY_PASS | quote }}
   - name: api-key
     value: {{ .Values.environment.API_KEY | quote }}
   - name: flight
     value: {{ .Values.environment.FLIGHT | quote }}
   {{- end -}}
   ```
2. **Use this template in `deployment.yaml`:**
   ```
    imagePullPolicy: {{ .Values.image.pullPolicy }}
    env:
      - name: gpt_key
        valueFrom:
          secretKeyRef:
            name: credentials
            key: CHATGPT_KEY
      {{- include "python-app.environmentVariables" . | nindent 12 }}
   ```
3. **Define the variables in `values.yaml`:**
   ```
   environment:
     MY_PASS: "supersecret123"
     API_KEY: "nokia3310"
     FLIGHT: "aviasales"
   ```
4. **Verify by running:**
   ```
   andrew@Andrews-MacBook-Pro python-app % kubectl exec -it golang-app-b89b66974-8zgkb -- printenv
   
   PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
   HOSTNAME=golang-app-b89b66974-8zgkb
   TERM=xterm
   flight=aviasales
   my-pass=supersecret123
   api-key=nokia3310
   VAULT_PORT_8200_TCP_PROTO=tcp
   VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT=443
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PROTO=tcp
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PORT=443
   KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
   KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
   PYTHON_APP_PORT=tcp://10.103.252.154:5001
   PYTHON_APP_PORT_5001_TCP_PROTO=tcp
   VAULT_PORT_8201_TCP=tcp://10.104.110.68:8201
   VAULT_PORT_8201_TCP_PORT=8201
   GOLANG_APP_PORT=tcp://10.96.116.186:8080
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_ADDR=10.110.10.101
   GOLANG_APP_SERVICE_PORT_HTTP=8080
   GOLANG_APP_PORT_8080_TCP_PORT=8080
   KUBERNETES_PORT=tcp://10.96.0.1:443
   VAULT_SERVICE_HOST=10.104.110.68
   VAULT_PORT_8201_TCP_ADDR=10.104.110.68
   VAULT_AGENT_INJECTOR_SVC_SERVICE_HOST=10.110.10.101
   PYTHON_APP_PORT_5001_TCP_ADDR=10.103.252.154
   VAULT_SERVICE_PORT_HTTP=8200
   VAULT_AGENT_INJECTOR_SVC_PORT=tcp://10.110.10.101:443
   VAULT_PORT_8201_TCP_PROTO=tcp
   VAULT_SERVICE_PORT=8200
   VAULT_PORT=tcp://10.104.110.68:8200
   VAULT_PORT_8200_TCP=tcp://10.104.110.68:8200
   VAULT_PORT_8200_TCP_PORT=8200
   PYTHON_APP_SERVICE_PORT_HTTP=5001
   VAULT_SERVICE_PORT_HTTPS_INTERNAL=8201
   VAULT_PORT_8200_TCP_ADDR=10.104.110.68
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP=tcp://10.110.10.101:443
   KUBERNETES_SERVICE_PORT=443
   KUBERNETES_PORT_443_TCP_PROTO=tcp
   PYTHON_APP_SERVICE_HOST=10.103.252.154
   PYTHON_APP_SERVICE_PORT=5001
   GOLANG_APP_PORT_8080_TCP=tcp://10.96.116.186:8080
   GOLANG_APP_PORT_8080_TCP_PROTO=tcp
   KUBERNETES_PORT_443_TCP_PORT=443
   PYTHON_APP_PORT_5001_TCP=tcp://10.103.252.154:5001
   GOLANG_APP_PORT_8080_TCP_ADDR=10.96.116.186
   GOLANG_APP_SERVICE_HOST=10.96.116.186
   GOLANG_APP_SERVICE_PORT=8080
   KUBERNETES_SERVICE_HOST=10.96.0.1
   KUBERNETES_SERVICE_PORT_HTTPS=443
   PYTHON_APP_PORT_5001_TCP_PORT=5001
   VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT_HTTPS=443
   HOME=/home/appuser
   ```
   ```
   andrew@Andrews-MacBook-Pro python-app % kubectl exec -it python-app-7df675cd66-5h65b -- printenv
   
   Defaulted container "python-app" out of: python-app, vault-agent, vault-agent-init (init)
   PATH=/usr/local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
   HOSTNAME=python-app-7df675cd66-5h65b
   TERM=xterm
   gpt_key=hahahuman
   my-pass=supersecret123
   api-key=nokia3310
   flight=aviasales
   VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT=443
   GOLANG_APP_PORT_8080_TCP_PROTO=tcp
   PYTHON_APP_SERVICE_HOST=10.103.252.154
   VAULT_SERVICE_PORT=8200
   VAULT_PORT=tcp://10.104.110.68:8200
   VAULT_PORT_8200_TCP=tcp://10.104.110.68:8200
   VAULT_PORT_8200_TCP_PROTO=tcp
   KUBERNETES_SERVICE_PORT_HTTPS=443
   KUBERNETES_PORT_443_TCP=tcp://10.96.0.1:443
   VAULT_PORT_8201_TCP_PORT=8201
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP=tcp://10.110.10.101:443
   GOLANG_APP_SERVICE_PORT=8080
   GOLANG_APP_PORT=tcp://10.96.116.186:8080
   GOLANG_APP_PORT_8080_TCP=tcp://10.96.116.186:8080
   VAULT_SERVICE_PORT_HTTP=8200
   VAULT_SERVICE_PORT_HTTPS_INTERNAL=8201
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_ADDR=10.110.10.101
   KUBERNETES_PORT_443_TCP_PROTO=tcp
   GOLANG_APP_PORT_8080_TCP_ADDR=10.96.116.186
   KUBERNETES_PORT_443_TCP_PORT=443
   PYTHON_APP_PORT=tcp://10.103.252.154:5001
   VAULT_PORT_8200_TCP_PORT=8200
   VAULT_AGENT_INJECTOR_SVC_SERVICE_HOST=10.110.10.101
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PROTO=tcp
   GOLANG_APP_SERVICE_PORT_HTTP=8080
   KUBERNETES_PORT_443_TCP_ADDR=10.96.0.1
   VAULT_AGENT_INJECTOR_SVC_SERVICE_PORT_HTTPS=443
   VAULT_AGENT_INJECTOR_SVC_PORT=tcp://10.110.10.101:443
   VAULT_AGENT_INJECTOR_SVC_PORT_443_TCP_PORT=443
   GOLANG_APP_PORT_8080_TCP_PORT=8080
   KUBERNETES_SERVICE_HOST=10.96.0.1
   PYTHON_APP_PORT_5001_TCP_PORT=5001
   VAULT_SERVICE_HOST=10.104.110.68
   VAULT_PORT_8200_TCP_ADDR=10.104.110.68
   VAULT_PORT_8201_TCP=tcp://10.104.110.68:8201
   KUBERNETES_SERVICE_PORT=443
   VAULT_PORT_8201_TCP_PROTO=tcp
   VAULT_PORT_8201_TCP_ADDR=10.104.110.68
   KUBERNETES_PORT=tcp://10.96.0.1:443
   PYTHON_APP_SERVICE_PORT=5001
   PYTHON_APP_SERVICE_PORT_HTTP=5001
   PYTHON_APP_PORT_5001_TCP=tcp://10.103.252.154:5001
   PYTHON_APP_PORT_5001_TCP_PROTO=tcp
   PYTHON_APP_PORT_5001_TCP_ADDR=10.103.252.154
   GOLANG_APP_SERVICE_HOST=10.96.116.186
   LANG=C.UTF-8
   GPG_KEY=A035C8C19219BA821ECEA86B64E628F8D684696D
   PYTHON_VERSION=3.11.9
   PYTHON_PIP_VERSION=24.0
   PYTHON_SETUPTOOLS_VERSION=65.5.1
   PYTHON_GET_PIP_URL=https://github.com/pypa/get-pip/raw/dbf0c85f76fb6e1ab42aa672ffca6f0a675d9ee4/public/get-pip.py
   PYTHON_GET_PIP_SHA256=dfe9fd5c28dc98b5ac17979a953ea550cec37ae1b47a5116007395bfacff2ab9
   HOME=/home/appuser
   ```
   All three variables are here!! (`flight`, `my-pass`, `api-key`)
