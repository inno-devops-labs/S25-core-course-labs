# Lab 11: Kubernetes Secrets and Hashicorp Vault

## Task 1: Kubernetes Secrets and Resource Management

### Create a Secret Using `kubectl`

```bash
  > kubectl create secret generic my-secret --from-literal=username=admin --from-literal=password='S!B\*d$zDsb='  

  secret/my-secret created 
```

### Verify and Decode Your Secret

```bash
  > kubectl get secret my-secret -o yaml

  apiVersion: v1
  data:
    password: UyFCXCpkJHpEc2I9
    username: YWRtaW4=
  kind: Secret
  metadata:
    creationTimestamp: "2025-03-09T16:02:52Z"
    name: my-secret
    namespace: default
    resourceVersion: "27452"
    uid: 7dbcc1fa-77bb-4f8c-b028-8d3e59d5f27a
  type: Opaque
```

```bash
  > kubectl get secret my-secret -o jsonpath='{.data.username}' | python -m base64 -d
  admin

  > kubectl get secret my-secret -o jsonpath='{.data.password}' | python -m base64 -d
  S!B\*d$zDsb=
```

### Manage Secrets with Helm

1. Create a `secrets.yaml`
  
    ```yaml
      apiVersion: v1
      kind: Secret
      metadata:
        name: helm-secret
      type: Opaque
      data:
        username: {{ .Values.secrets.username | b64enc }}
        password: {{ .Values.secrets.password | b64enc }}
    ```

2. Add an `env` field to `deployment.yaml`
  
    ```yaml
      env:
        - name: USERNAME
          valueFrom:
            secretKeyRef:
              name: helm-secret
              key: username
        - name: PASSWORD
          valueFrom:
            secretKeyRef:
              name: helm-secret
              key: password
    ```

3. Add secrets to `values.yaml`

    ```yaml
      secrets:
        username: admin
        password: S!B\*d$zDsb=
    ```

4. Retrieve the list of pods

    ```bash
      > kubectl get po  
                                                          
      NAME                                         READY   STATUS      RESTARTS   AGE
      app-python-helm-776f799b7c-gkmqg             1/1     Running     0          108s
      app-python-helm-postinstall                  0/1     Completed   0          16m
      app-python-helm-preinstall                   0/1     Completed   0          16m
      helm-hooks-app-python-helm-6b964dfd8-s5ksb   1/1     Running     0          19m
    ```

5. Verify the secrets inside the pod

    ```bash
    > kubectl exec app-python-helm-776f799b7c-gkmqg -- env | Select-String "USERNAME"
    USERNAME=admin

    > kubectl exec app-python-helm-776f799b7c-gkmqg -- env | Select-String "PASSWORD"
    PASSWORD=S!B\*d$zDsb=
    ```

## Task 2: Vault Secret Management System

