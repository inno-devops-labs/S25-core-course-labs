create secret

```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/templates$ kubectl create secret generic mysecret \
  --from-literal=MY_PASS=SuperSecretPassword
secret/mysecret created
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/templates$ 

```

verify and decode

```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/templates$ kubectl get secret mysecret
NAME       TYPE     DATA   AGE
mysecret   Opaque   1      44s
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/templates$ 


kubectl get secret mysecret -o jsonpath='{.data.MY_PASS}' | base64 -d
SuperSecretPasswordmeowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app/templates$ 


```

deploy helm
```
helm upgrade --install time-app .
secret "mysecret" deleted
Release "time-app" does not exist. Installing it now.
NAME: time-app
LAST DEPLOYED: Tue Apr 29 02:05:09 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=time-app,app.kubernetes.io/instance=time-app" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app$ 


```

install vault

```
helm install vault hashicorp/vault --set "injector.enabled=true" --set "server.dev.enabled=true"
NAME: vault
LAST DEPLOYED: Tue Apr 29 02:34:33 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
Thank you for installing HashiCorp Vault!

Now that you have deployed Vault, you should look over the docs on using
Vault with Kubernetes available here:

https://developer.hashicorp.com/vault/docs


Your release is named vault. To learn more about the release, try:

  $ helm status vault
  $ helm get manifest vault
```

verify
```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app$ kubectl get pods
NAME                                    READY   STATUS    RESTARTS   AGE
time-app-8659dcb47c-rhls8               1/1     Running   0          39m
vault-0                                 1/1     Running   0          13m
vault-agent-injector-75f9dfc9c8-cz7bc   1/1     Running   0          13m
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app$ 
```

set a secret in vault
```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app$ kubectl exec -it vault-0 -- /bin/sh
/ $ vault secrets enable -path=internal kv-v2
Success! Enabled the kv-v2 secrets engine at: internal/
/ $ vault kv put internal/database/config username="dbuser" password="dbpass123"
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2025-04-28T23:50:03.42950238Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1
/ $ vault kv get internal/database/config
======== Secret Path ========
internal/data/database/config

======= Metadata =======
Key                Value
---                -----
created_time       2025-04-28T23:50:03.42950238Z
custom_metadata    <nil>
deletion_time      n/a
destroyed          false
version            1

====== Data ======
Key         Value
---         -----
password    dbpass123
username    dbuser
/ $ 

```

configure Kubernetes authentication
```

```

/ $ vault auth enable kubernetes
Success! Enabled kubernetes auth method at: kubernetes/
/ $ vault write auth/kubernetes/config \
>     token_reviewer_jwt="$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)" \
>     kubernetes_host="https://${KUBERNETES_PORT_443_TCP_ADDR}" \
>     kubernetes_ca_cert=@/var/run/secrets/kubernetes.io/serviceaccount/ca.crt
Success! Data written to: auth/kubernetes/config
/ $ vault policy write time-app-policy - <<EOF
> path "internal/data/database/config" {
>   capabilities = ["read"]
> }
> EOF
Success! Uploaded policy: time-app-policy
/ $ vault write auth/kubernetes/role/time-app-role \
>     bound_service_account_names=time-app \
>     bound_service_account_namespaces=default \
>     policies=time-app-policy \
>     ttl=24h
Success! Data written to: auth/kubernetes/role/time-app-role
```

Check Vault Secrets

```
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app$ kubectl exec -it time-app-65d7987665-9xzr9 --container time-app -- /bin/sh        
# cd ..
# ls
bin   dev  home  lib64	mnt  proc  run	 srv  tmp  var
boot  etc  lib	 media	opt  root  sbin  sys  usr  vault
# cat /vault/secrets/db-config
DB_USER=dbuser
DB_PASS=dbpass123
# 



meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app$ kubectl get po
NAME                                    READY   STATUS    RESTARTS   AGE
time-app-65d7987665-9xzr9               2/2     Running   0          16m
vault-0                                 1/1     Running   0          159m
vault-agent-injector-75f9dfc9c8-cz7bc   1/1     Running   0          159m
meowal@meowal-1-2:~/S25-core-course-labs/k8s/time-app$ 

```

### CPU and Memory Limits

Configured resource requests and limits:

```yaml
resources:
  requests:
    cpu: "100m"
    memory: "128Mi"
  limits:
    cpu: "250m"
    memory: "256Mi"
