# Lab 11: Kubernetes Secrets and Hashicorp Vault
### **1. Create a Secret Using `kubectl`**


#### Step 1: Create a Secret Using `kubectl`
Run the following command to create a secret named `my-secret` with a key-value pair:

```bash
kubectl create secret generic my-secret --from-literal=MY_PASS=supersecret
```

This command creates a secret with the key `MY_PASS` and the value `supersecret`.

---

### **2. Verify and Decode Your Secret**

#### Step 1: Verify the Secret
To verify the secret was created, run:

```bash
$ kubectl get secret my-secret
secret/my-secret created

```

## Verify and Decode Secret

1. Get the secret:
   ```bash
   kubectl get secret my-secret
   ```

   Output:
   ```
   NAME         TYPE     DATA   AGE
   my-secret   Opaque   1      21s
   ```

2. Decode the secret:
   ```bash
   kubectl get secret my-secret -o jsonpath="{.data.MY_PASS}" | base64 --decode
   ```

   Output:
   ```
   supersecret
   ```




### **3. Manage Secrets with Helm**

#### Step 1: Create a `secrets.yaml` File
In the `templates` folder of your Helm chart, create a `secrets.yaml` file and define a secret object:

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: my-helm-secret
type: Opaque
data:
  MY_PASS: {{ .Values.secrets.MY_PASS | b64enc | quote }}
```

#### Step 2: Add `env` Field to Deployment
Update your `deployment.yaml` file to include the secret as an environment variable:

```yaml
# templates/deployment.yaml
env:
- name: MY_PASS
    valueFrom:
    secretKeyRef:
        name: my-helm-secret
        key: MY_PASS
```

#### Step 3: Update Helm Values
Add the secret value to your `values.yaml` file:

```yaml
secrets:
  MY_PASS: supersecret
```

#### Step 4: Deploy the Helm Chart
Run the following command to deploy your Helm chart:

```bash
$ helm upgrade --install python-app ./python-app
Release "python-app" does not exist. Installing it now.
NAME: python-app
LAST DEPLOYED: Sun Mar  9 15:22:21 2025
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=python-app,app.kubernetes.io/instance=python-app" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT

```

---

### **4. Verify the Secret Inside the Pod**

#### Step 1: Retrieve the List of Pods
Run the following command to get the list of pods:

```bash
kubectl get po
```

Output:
```
NAME                         READY   STATUS    RESTARTS   AGE
python-app-c754c75b7-xhwnf   1/1     Running   0          69s
```

#### Step 2: Verify the Secret Inside the Pod
Use the pod name from the previous output to verify the secret:

```bash
kubectl exec it python-app-c754c75b7-xhwnf -- printenv | grep MY_PASS
```

Output:
```
MY_PASS=supersecret
```

