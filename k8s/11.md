# Lab 11

## Task 1
### 1. Verifying and Decoding Secret log

```bash
PS C:\Users\S25-core-course-labs\k8s> kubectl get secret my-secret -o yaml
apiVersion: v1
data:
  MY_PASS: bXlfc2VjdXJlX3Bhc3N3b3Jk
kind: Secret
metadata:
  creationTimestamp: "2025-03-09T18:16:33Z"
  name: my-secret
  namespace: default
  resourceVersion: "8539"
  uid: de87e1d7-8cf9-4a96-be23-9607508af225
type: Opaque

PS C:\Users\S25-core-course-labs\k8s> kubectl get secret my-secret -o jsonpath="{.data.MY_PASS}"
bXlfc2VjdXJlX3Bhc3N3b3Jk
```

### 2. Helm Usage

Helm setup
```bash
PS C:\Users\S25-core-course-labs\k8s> helm upgrade --install python-app ./python-app
Release "python-app" has been upgraded. Happy Helming!
NAME: python-app
LAST DEPLOYED: Sun Mar  9 21:27:45 2025
NAMESPACE: default
STATUS: deployed
REVISION: 2
NOTES:
1. Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace default -l "app.kubernetes.io/name=python-app,app.kubernetes.io/instance=python-app" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace default $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace default port-forward $POD_NAME 8080:$CONTAINER_PORT

```

Check if the secret is in the pod
```bash
PS C:\Users\S25-core-course-labs\k8s> kubectl get pods
NAME                          READY   STATUS      RESTARTS   AGE
post-install-job-bjslj        0/1     Completed   0          6d21h
pre-install-job-zkpn8         0/1     Completed   0          6d21h
python-app-54bbcb597f-b79jf   1/1     Running     0          3m30s
python-app-test-connection    0/1     Completed   0          6d21h
PS C:\Users\S25-core-course-labs\k8s> kubectl exec python-app-54bbcb597f-b79jf -- printenv | Select-String "MY_PASS"

MY_PASS=my_secure_password
```

## Task 2

With installed Vault, verify that it is running

```bash
PS C:\Users\S25-core-course-labs\k8s> kubectl get pods
NAME                                    READY   STATUS              RESTARTS   AGE
post-install-job-bjslj                  0/1     Completed           0          6d21h
pre-install-job-zkpn8                   0/1     Completed           0          6d21h
python-app-54bbcb597f-b79jf             1/1     Running             0          6m40s
python-app-test-connection              0/1     Completed           0          6d21h
vault-0                                 0/1     ContainerCreating   0          8s
vault-agent-injector-66f45b5fd5-jxhrx   0/1     ContainerCreating   0          8s
PS C:\Users\S25-core-course-labs\k8s> kubectl get services
NAME                       TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)             AGE
kubernetes                 ClusterIP   10.96.0.1        <none>        443/TCP             6d22h
python-app                 ClusterIP   10.103.174.51    <none>        5000/TCP            6d21h
vault                      ClusterIP   10.96.68.94      <none>        8200/TCP,8201/TCP   12s
vault-agent-injector-svc   ClusterIP   10.104.233.242   <none>        443/TCP             12s
vault-internal             ClusterIP   None             <none>        8200/TCP,8201/TCP   12s
```

Store and get the secrets using vault
```bash
PS C:\Users\S25-core-course-labs\k8s> kubectl exec -it vault-0 -- vault login
Token (will be hidden):
Success! You are now authenticated. The token information displayed below
is already stored in the token helper. You do NOT need to run "vault login"
again. Future Vault requests will automatically use this token.

Key                  Value
---                  -----
token                hvs.SPpONxRogMIvoddDSLi1q69x
token_accessor       iDQVMbH1PUpOejXOheci9Ybn
token_duration       âˆž
token_renewable      false
token_policies       ["root"]
identity_policies    []
policies             ["root"]

PS C:\Users\S25-core-course-labs\k8s> kubectl exec -it vault-0 -- vault secrets enable -path=secret kv
Success! Enabled the kv secrets engine at: secret/

PS C:\Users\S25-core-course-labs\k8s> kubectl exec -it vault-0 -- vault kv put secret/myapp MY_PASS=my_secure_password
Success! Data written to: secret/myapp

PS C:\Users\S25-core-course-labs\k8s> kubectl exec -it vault-0 -- vault kv get secret/myapp
===== Data =====
Key        Value
---        -----
MY_PASS    my_secure_password
```

Kubernetes
```bash
PS C:\Users\S25-core-course-labs\k8s> kubectl exec -it vault-0 -- vault auth enable kubernetes
Success! Enabled kubernetes auth method at: kubernetes/

PS C:\Users\S25-core-course-labs\k8s> kubectl exec python-app-54bbcb597f-b79jf -- printenv | Select-String MY_PASS

MY_PASS=my_secure_password
```