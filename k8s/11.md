
# Kubernetes Secrets

## Secrets

### Inline Secret

We can create an inline secret in our terminal by running:

```bash
$ kubectl create secret generic my-secret --from-literal=username='NOTadmin' --from-literal=password='1q2w3e4r'
```
![alt text](image.png)

Checking secrets created:

```bash
$ kubectl get secrets
```
![alt text](image-1.png)
```bash
$ kubectl describe secrets secret
```
![alt text](image-2.png)
Checking the contant of the secret:

```bash
$ kubectl get secret my-secret -o jsonpath='{.data}'
```
![alt text](image-3.png)
The data is encoded in base64:

```bash
$ kubectl get secret my-secret -o jsonpath='{.data.username}' | base64 --decode
```

```bash
$ kubectl get secret my-secret -o jsonpath='{.data.password}' | base64 --decode
```
![alt text](image-4.png)
### Helm Secrets


Installing the app after deleting the old secrets:

```bash
$ helm upgrade --install web-app ./web-app/
```
![alt text](image-5.png)
Checking pods:

```bash
$ kubectl get po
```
![alt text](image-6.png)
Checking password:

```bash
$ kubectl exec web-app-788b6d446c-fbgx8 -- printenv | grep APP_
```
![alt text](image-7.png)
## Vault - HashiCorp


To verify the work after creating vault secrets:

We check our pod to see if the secrets are created:

```bash
$ kubectl exec -it web-app-788b6d446c-fbgx8 -- sh
Defaulted container "web-app" out of: web-app, vault-agent, vault-agent-init (init)
/app_python $ ls
__pycache__       main.py           requirements.txt  templates
```

```bash
/app_python $ cat /vault/secrets/database-config.txt 
data: map[password:1q2w3e4r username:NOTadmin]
metadata: map[created_time:2025-04-09T00:47:39.40433964Z custom_metadata:<nil> deletion_time: destroyed:false version:1]
```

disk space usage:

```bash
/app_python $ df -h
Filesystem                Size      Used Available Use% Mounted on
overlay                 468.1G       79G     366G    18% /
tmpfs                    64.0M         0     64.0M   0% /dev
shm                      64.0M         0     64.0M   0% /dev/shm
tmpfs                    15.5G      4.0K     15.5G   0% /vault/secrets
/dev/nvme0n1p2          468.1G       79G     366G    18% /dev/termination-log
/dev/nvme0n1p2          468.1G       79G     366G    18% /etc/resolv.conf
/dev/nvme0n1p2          468.1G       79G     366G    18% /etc/hostname
/dev/nvme0n1p2          468.1G       79G     366G    18% /etc/hosts
tmpfs                    15.5G     12.0K     15.5G   0% /run/secrets/kubernetes.io/serviceaccount
tmpfs                     7.7G         0      7.7G   0% /proc/asound
tmpfs                     7.7G         0      7.7G   0% /proc/acpi
tmpfs                    64.0M         0     64.0M   0% /proc/kcore
tmpfs                    64.0M         0     64.0M   0% /proc/keys
tmpfs                    64.0M         0     64.0M   0% /proc/timer_list
tmpfs                     7.7G         0      7.7G   0% /proc/scsi
tmpfs                     7.7G         0      7.7G   0% /sys/firmware
tmpfs                     7.7G         0      7.7G   0% /sys/devices/virtual/powercap
```

We can change the template of the secret we have:
In `web-app/values.yaml:[42-45]`

```yaml
{{- with secret "internal/data/database/config" -}}
    Lab 11: Vault Agent Injector DB secret
    The username is: {{ .Data.data.username }} and the Password is:{{ .Data.data.password }}
{{- end -}}
```

We can check our pod:

```bash
$ kubectl exec -it web-app-769f8977f-hqmsj -- sh
Defaulted container "web-app" out of: web-app, vault-agent, vault-agent-init (init)
/app_python $ cat /vault/secrets/database-config.txt 
Lab 11: Vault Agent Injector DB secret
The username is: NOTadmin and the Password is:1q2w3e4r
```