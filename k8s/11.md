# Lab 11: Kubernetes Secrets and Hashicorp Vault

## Task 1: Kubernetes Secrets and Resource Management

### Creating and Managing Secrets with kubectl

First, I'll create a secret that will store database credentials for my web application:

```bash
dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl create secret generic db-credentials \
  --from-literal=username=admin \
  --from-literal=password=S3cure_P@ssw0rd
secret/db-credentials created

dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl get secrets
NAME                            TYPE                 DATA   AGE
db-credentials                  Opaque               2      13s
sh.helm.release.v1.web-app.v1   helm.sh/release.v1   1      115m

dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl describe secret db-credentials
Name:         db-credentials
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  15 bytes
username:  5 bytes
```

### Decode the Secret

```bash
dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl get secret db-credentials -o yaml
apiVersion: v1
data:
  password: UzNjdXJlX1BAc3N3MHJk
  username: YWRtaW4=
kind: Secret
metadata:
  creationTimestamp: "2025-03-09T20:30:06Z"
  name: db-credentials
  namespace: default
  resourceVersion: "8469"
  uid: 84c7e91b-02da-4852-86f1-66dbf213b2b3
type: Opaque

dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl get secret db-credentials -o jsonpath='{.data.password}' | base64 --decode
S3cure_P@ssw0rd


dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl get secret db-credentials -o jsonpath='{.data.username}' | base64 --decode
admin
```

### Managing Secrets with Helm

After implementing the `secrets.yaml` and updating the deployment to use the secrets:

```bash
helm upgrade --install web-app ./k8s/web-app

dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl get pods -l app.kubernetes.io/name=web-app
NAME                       READY   STATUS              RESTARTS   AGE
web-app-5465df449-s7zbn    1/1     Running             0          9s
web-app-5465df449-zt2mq    0/1     ContainerCreating   0          2s
web-app-864476c85d-m84hp   1/1     Running             0          120m
web-app-864476c85d-rl26l   1/1     Terminating         0          120m
web-app-864476c85d-xbrrj   1/1     Running             0          120m

dpttk@codenv:~/uni/devops/S25-core-course-labs$ kubectl exec web-app-5465df449-s7zbn -- printenv | grep DB_
DB_USERNAME=admin
DB_PASSWORD=S3cure_P@ssw0rd
```
