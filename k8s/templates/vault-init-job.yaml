apiVersion: batch/v1
kind: Job
metadata:
  name: vault-init
spec:
  template:
    spec:
      containers:
      - name: vault-init
        image: vault:1.13.3
        command: ["/bin/sh", "-c"]
        args:
        - |
          sleep 10
          export VAULT_ADDR=http://vault:8200
          export VAULT_TOKEN=root
          export VAULT_SKIP_VERIFY=true
          vault status || vault operator init > /vault/data/init.txt
          vault secrets enable -path=secret kv-v2 || true
          echo "Vault initialized successfully"
        volumeMounts:
        - name: vault-data
          mountPath: /vault/data
      volumes:
      - name: vault-data
        persistentVolumeClaim:
          claimName: vault-pvc
      restartPolicy: Never 