# Lab 12: Kubernetes ConfigMaps


## Task 1: Upgrade Application for Persistence

### Overview

This application has been upgraded to include a persistent counter that tracks the number of times the main page (`/`) is accessed. The count is saved in a file named `visits`, and a new endpoint `/visits` has been added to display this count.

---

### Features

- **Persistent Visit Counter**  
  Tracks and saves the number of times the app has been accessed to a file named `visits`.

- **New Endpoint `/visits`**  
  Displays the current visit count saved in the `visits` file.

---

### How It Works

- Each time the root route `/` is accessed, the counter is incremented.
- The current counter value is stored and updated in a file named `visits`.
- The `/visits` endpoint reads from this file and returns the number of visits.

---

### Setup

#### 1. Clone the Repository

```bash
git clone -- branch lab12 <your-repo-url>
cd <project-directory>updated_lab12/monitoring
```
#### 2. Run with Docker Compose
Ensure Docker is installed, then run:

```bash
docker compose up
```
3. Access the Application
Visit the main page at: http://localhost:5000

View the visit count at: http://localhost:5000/visits

Docker Configuration
The docker-compose.yml file has been updated to mount a volume to persist the visits file:

```yaml
volumes:
  - ./visits:/app_python/visits
```
This allows the visit count to be visible and persistent on the host machine.

Validation
After accessing the app:

The visits file is updated correctly inside the container and is also visible on the host.

The /visits endpoint accurately reflects the visit count.

Verified using:

```bash
docker exec -it <container_id> cat /app_python/visits
```
Example Output
![](/scren/8.png)
![](/scren/9.png)
![](/scren/10.png)
![](/scren/11.png)



























---

## Task 2: ConfigMap Implementation

### Steps

1. **Created a ConfigMap:**
   - Created a `files` folder with a `config.json` file containing the following data:

     ```json
     {
         "first_name": "Yehia Sobeh",
     }
     ```

   - Used Helm to mount `config.json` into the application container.

2. **Helm Chart Updates:**
   - Created a `configMap` manifest using `.Files.Get` to retrieve data from `config.json`.
   - Updated `deployment.yaml` with `Volumes` and `VolumeMounts` to mount the ConfigMap.

3. **Deployed and Verified:**
   - Installed the updated Helm chart:

     ```bash
     helm upgrade --install app-python ./app-python/
     ```

     Output:
      ![](/scren/2.png)

   - Verified the deployment:

     ```bash
     kubectl get pod
     ```

     Output:

      ![](/scren/3.png)

   - Checked the ConfigMap:

     ```bash
     kubectl get configmaps
     ```

     Output:

      ![](/scren/4.png)

   - Described the ConfigMap:

     ```bash
     kubectl describe configmaps flask-config
     ```

     Output:

      ![](/scren/5.png)

   - Verified the ConfigMap inside the pod:

     ```bash
     kubectl exec app-python-6d4b676994-jkxxp -- cat /config/config.json
     ```

     Output:

        ![](/scren/6.png)

   - Described the pod:

     ```bash
      kubectl describe po app-python-6d4b676994-jkxxp
     ```

     Output:
    ![](/scren/7.png)

---
