---
- name: Wipe web application
  when: web_app_full_wipe | default(false) | bool
  block:
    - name: Stop and remove Docker containers
      community.docker.docker_compose:
        project_src: "{{ app_deploy_path }}"
        files:
          - "{{ docker_compose_file_path | basename }}"
        state: absent
      ignore_errors: yes

    - name: Remove application directory
      file:
        path: "{{ app_deploy_path }}"
        state: absent

    - name: Remove Docker images
      community.docker.docker_image:
        name: "{{ docker_image_name }}:{{ docker_image_tag }}"
        state: absent
        force_absent: yes
      when: docker_image_name is defined
  tags:
    - wipe 