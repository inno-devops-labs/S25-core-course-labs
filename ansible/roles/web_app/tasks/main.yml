- name: Wipe

  import_tasks: 0-wipe.yml


- name: Deploy

  when: web_app_full_wipe == false

  tags:
    - app
    - deploy
  
  block:
    - name: Create application dir
      file:
        path: "{{ app_dir }}"
        state: directory

    - name: Add Docker Compose template to application dir
      template:
        src: docker-compose.yml.j2
        dest: "{{ app_dir }}/docker-compose.yml"

    - name: Start services using Docker Compose
      community.docker.docker_compose_v2:
        project_src: "{{ app_dir }}"
        state: present
