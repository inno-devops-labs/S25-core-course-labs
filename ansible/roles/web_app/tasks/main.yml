---
- name: Pull Docker image for the application
  docker_image:
    name: "{{ docker_image }}"
    source: pull
  tags:
    - docker

- name: Start the application container
  docker_container:
    name: "{{ container_name }}"
    image: "{{ docker_image }}"
    state: started
    restart_policy: always
    published_ports:
      - "{{ app_port }}:80"
  tags:
    - docker

- name: Deploy docker-compose file template
  template:
    src: docker-compose.yml.j2
    dest: /home/{{ ansible_user }}/docker-compose.yml
  tags:
    - docker

- name: Execute wipe tasks if requested
  block:
    - include_tasks: 0-wipe.yml
  when: web_app_full_wipe | bool
  tags:
    - wipe