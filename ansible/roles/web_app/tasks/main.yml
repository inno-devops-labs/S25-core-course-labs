---
- name: Wipe previous deployment if enabled
  import_tasks: 0-wipe.yml
  when: web_app_full_wipe
  tags: [ "wipe" ]

- name: Pull Docker image
  docker_image:
    name: "{{ docker_image }}"
    source: pull
  tags: [ "docker" ]

- name: Deploy application using Docker Compose template
  template:
    src: docker-compose.yml.j2
    dest: /home/ubuntu/docker-compose.yml
  tags: [ "compose" ]

- name: Start application container using Docker Compose
  command: docker-compose -f /home/ubuntu/docker-compose.yml up -d
  tags: [ "compose" ]