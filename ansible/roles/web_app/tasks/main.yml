- name: Include wipe tasks if enabled
  include_tasks: 0-wipe.yml
  tags:
    - wipe

- name: Setup application environment
  block:
    - name: Create application directory
      file:
        path: "/opt/web_app"
        state: directory
        mode: '0755'
      tags:
        - setup

    - name: Template Docker Compose file
      template:
        src: docker-compose.yml.j2
        dest: "/opt/web_app/docker-compose.yml"
        mode: '0644'
      tags:
        - setup
        - docker

    - name: Start application with Docker Compose
      community.docker.docker_compose_v2:
        project_src: "/opt/web_app"
        state: present
      tags:
        - docker