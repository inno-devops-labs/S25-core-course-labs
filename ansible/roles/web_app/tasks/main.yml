- name: Deploy Web Application
  block:

    - name: Pull Docker image
      docker_image:
        name: "{{ docker_image }}"
        source: pull
      tags:
        - docker

    - name: Generate docker-compose file from template
      template:
        src: docker-compose.yml.j2
        dest: /home/ubuntu/docker-compose.yml
      tags:
        - compose

    - name: Start application using docker-compose
      command: docker-compose -f /home/ubuntu/docker-compose.yml up -d
      tags:
        - compose

  when: web_app_full_wipe | bool == false


- name: Execute wipe task
  import_tasks: 0-wipe.yml
  
  when: web_app_full_wipe | bool == true
