#SPDX-License-Identifier: MIT-0
---
# tasks file for roles/web_app
- name: Include wipe tasks if enabled
  include_tasks: 0-wipe.yml
  when: web_app_full_wipe | default(false)
  tags:
    - wipe

- name: Setup Application Environment
  block:
    - name: Create application directory
      file:
        path: "{{ deployment_folder }}"
        state: directory
        mode: '0755'

    - name: Template docker-compose file
      template:
        src: docker-compose.yml.j2
        dest: "{{ deployment_folder }}/docker-compose.yml"
      tags:
        - config
  tags:
    - setup

- name: Deploy with docker-compose
  community.docker.docker_compose_v2:
    project_src: "{{ deployment_folder }}"
    state: present
  tags:
    - deploy
